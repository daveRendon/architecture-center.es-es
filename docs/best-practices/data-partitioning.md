---
title: "Guía de creación de particiones de datos"
description: "Orientaciones sobre cómo separar las particiones para administrarlas y tener acceso a ellas por separado."
author: dragon119
ms.date: 07/13/2016
pnp.series.title: Best Practices
ms.openlocfilehash: c139fd1ef59ea94235cd9519dd064d0722cee3c9
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: es-ES
ms.lasthandoff: 11/14/2017
---
# <a name="data-partitioning"></a><span data-ttu-id="0b784-103">Creación de particiones de datos</span><span class="sxs-lookup"><span data-stu-id="0b784-103">Data partitioning</span></span>
[!INCLUDE [header](../_includes/header.md)]

<span data-ttu-id="0b784-104">En muchas soluciones a gran escala, los datos se dividen en particiones independientes que se pueden administrar y a las que se puede acceder por separado.</span><span class="sxs-lookup"><span data-stu-id="0b784-104">In many large-scale solutions, data is divided into separate partitions that can be managed and accessed separately.</span></span> <span data-ttu-id="0b784-105">Debe elegir cuidadosamente la estrategia de partición para maximizar los beneficios y minimizar los efectos adversos.</span><span class="sxs-lookup"><span data-stu-id="0b784-105">The partitioning strategy must be chosen carefully to maximize the benefits while minimizing adverse effects.</span></span> <span data-ttu-id="0b784-106">La creación de particiones puede ayudar a mejorar la escalabilidad, reducir la contención y optimizar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-106">Partitioning can help improve scalability, reduce contention, and optimize performance.</span></span> <span data-ttu-id="0b784-107">Otra ventaja de este proceso es que puede proporcionar un mecanismo para dividir los datos por el patrón de uso.</span><span class="sxs-lookup"><span data-stu-id="0b784-107">Another benefit of partitioning is that it can provide a mechanism for dividing data by the pattern of use.</span></span> <span data-ttu-id="0b784-108">Por ejemplo, puede archivar los datos más antiguos y menos activos en el nivel de almacenamiento de datos más barato.</span><span class="sxs-lookup"><span data-stu-id="0b784-108">For example, you can archive older, less active (cold) data in cheaper data storage.</span></span>

## <a name="why-partition-data"></a><span data-ttu-id="0b784-109">¿Por qué es recomendable crear particiones de datos?</span><span class="sxs-lookup"><span data-stu-id="0b784-109">Why partition data?</span></span>
<span data-ttu-id="0b784-110">La mayoría de los servicios y aplicaciones de nube almacenan y recuperan datos como parte de sus operaciones.</span><span class="sxs-lookup"><span data-stu-id="0b784-110">Most cloud applications and services store and retrieve data as part of their operations.</span></span> <span data-ttu-id="0b784-111">El diseño de los almacenes de datos que utiliza una aplicación puede tener una incidencia significativa en el rendimiento y la escalabilidad de un sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-111">The design of the data stores that an application uses can have a significant bearing on the performance, throughput, and scalability of a system.</span></span> <span data-ttu-id="0b784-112">Una técnica que se aplica normalmente en sistemas de gran escala es dividir los datos en particiones independientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-112">One technique that is commonly applied in large-scale systems is to divide the data into separate partitions.</span></span>

> <span data-ttu-id="0b784-113">En este artículo, el término *creación de particiones* hace referencia al proceso de dividir físicamente los datos en almacenes de datos independientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-113">In this article, the term *partitioning* means the process of physically dividing data into separate data stores.</span></span> <span data-ttu-id="0b784-114">No es lo mismo que la creación de particiones de tabla de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0b784-114">It is not the same as SQL Server table partitioning.</span></span>

<span data-ttu-id="0b784-115">Crear particiones de datos puede ofrecer una serie de ventajas.</span><span class="sxs-lookup"><span data-stu-id="0b784-115">Partitioning data can offer a number of benefits.</span></span> <span data-ttu-id="0b784-116">Por ejemplo, se puede aplicar para:</span><span class="sxs-lookup"><span data-stu-id="0b784-116">For example, it can be applied in order to:</span></span>

* <span data-ttu-id="0b784-117">**Mejorar la escalabilidad**.</span><span class="sxs-lookup"><span data-stu-id="0b784-117">**Improve scalability**.</span></span> <span data-ttu-id="0b784-118">Al escalar verticalmente un sistema de base de datos única, este podría alcanzar un límite de hardware físico.</span><span class="sxs-lookup"><span data-stu-id="0b784-118">When you scale up a single database system, it will eventually reach a physical hardware limit.</span></span> <span data-ttu-id="0b784-119">Si divide datos en varias particiones, cada una de las cuales se hospeda en un servidor independiente, tiene la posibilidad de escalar horizontalmente el sistema de manera casi indefinida.</span><span class="sxs-lookup"><span data-stu-id="0b784-119">If you divide data across multiple partitions, each of which is hosted on a separate server, you can scale out the system almost indefinitely.</span></span>
* <span data-ttu-id="0b784-120">**Mejorar el rendimiento**.</span><span class="sxs-lookup"><span data-stu-id="0b784-120">**Improve performance**.</span></span> <span data-ttu-id="0b784-121">Las operaciones de acceso a datos en cada partición se realizan en un volumen de datos menor.</span><span class="sxs-lookup"><span data-stu-id="0b784-121">Data access operations on each partition take place over a smaller volume of data.</span></span> <span data-ttu-id="0b784-122">Siempre que los datos se dividan de forma adecuada, las creación de particiones puede aumentar la eficiencia del sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-122">Provided that the data is partitioned in a suitable way, partitioning can make your system more efficient.</span></span> <span data-ttu-id="0b784-123">Las operaciones que afectan a más de una partición pueden ejecutarse en paralelo.</span><span class="sxs-lookup"><span data-stu-id="0b784-123">Operations that affect more than one partition can run in parallel.</span></span> <span data-ttu-id="0b784-124">Cada partición puede estar cerca de la aplicación que la utiliza para minimizar la latencia de red.</span><span class="sxs-lookup"><span data-stu-id="0b784-124">Each partition can be located near the application that uses it to minimize network latency.</span></span>
* <span data-ttu-id="0b784-125">**Mejorar la disponibilidad**.</span><span class="sxs-lookup"><span data-stu-id="0b784-125">**Improve availability**.</span></span> <span data-ttu-id="0b784-126">Separar los datos en varios servidores evita un punto único de error.</span><span class="sxs-lookup"><span data-stu-id="0b784-126">Separating data across multiple servers avoids a single point of failure.</span></span> <span data-ttu-id="0b784-127">Si se produce un error en un servidor o están realizando realizando tareas de mantenimiento planeada, solo estarán disponibles los datos de esa partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-127">If a server fails, or is undergoing planned maintenance, only the data in that partition is unavailable.</span></span> <span data-ttu-id="0b784-128">Las operaciones en otras particiones pueden continuar.</span><span class="sxs-lookup"><span data-stu-id="0b784-128">Operations on other partitions can continue.</span></span> <span data-ttu-id="0b784-129">Aumentar el número de particiones reduce el impacto relativo de un error de servidor único reduciendo el porcentaje de los datos que no van a estar disponibles.</span><span class="sxs-lookup"><span data-stu-id="0b784-129">Increasing the number of partitions reduces the relative impact of a single server failure by reducing the percentage of data that will be unavailable.</span></span> <span data-ttu-id="0b784-130">Replicar cada partición puede reducir todavía más la posibilidad de que se produzca un error en una única partición que afecte a las operaciones.</span><span class="sxs-lookup"><span data-stu-id="0b784-130">Replicating each partition can further reduce the chance of a single partition failure affecting operations.</span></span> <span data-ttu-id="0b784-131">También permite separar los datos críticos que deben estar disponibles continuamente de los datos menos valiosos que tienen requisitos de baja disponibilidad (por ejemplo, los archivos de registro).</span><span class="sxs-lookup"><span data-stu-id="0b784-131">It also makes it possible to separate critical data that must be continually and highly available from low-value data that has lower availability requirements (log files, for example).</span></span>
* <span data-ttu-id="0b784-132">**Mejorar la seguridad**.</span><span class="sxs-lookup"><span data-stu-id="0b784-132">**Improve security**.</span></span> <span data-ttu-id="0b784-133">Según la naturaleza de los datos y de cómo estén particionados, es posible separar los datos confidenciales y no confidenciales en particiones distintas y, por tanto, en diferentes servidores o almacenes de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-133">Depending on the nature of the data and how it is partitioned, it might be possible to separate sensitive and non-sensitive data into different partitions, and therefore into different servers or data stores.</span></span> <span data-ttu-id="0b784-134">Por lo tanto, es posible optimizar la seguridad de manera específica para los datos confidenciales.</span><span class="sxs-lookup"><span data-stu-id="0b784-134">Security can then be specifically optimized for the sensitive data.</span></span>
* <span data-ttu-id="0b784-135">**Proporcionan flexibilidad operativa**.</span><span class="sxs-lookup"><span data-stu-id="0b784-135">**Provide operational flexibility**.</span></span> <span data-ttu-id="0b784-136">La creación de particiones ofrece muchas oportunidades para ajustar con precisión las operaciones, maximizar la eficacia administrativa y minimizar los costes.</span><span class="sxs-lookup"><span data-stu-id="0b784-136">Partitioning offers many opportunities for fine tuning operations, maximizing administrative efficiency, and minimizing cost.</span></span> <span data-ttu-id="0b784-137">Por ejemplo, puede definir diferentes estrategias para la administración, la supervisión, la creación de copias de seguridad y la restauración, así como otras tareas administrativas, en función de la importancia de los datos de cada partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-137">For example, you can define different strategies for management, monitoring, backup and restore, and other administrative tasks based on the importance of the data in each partition.</span></span>
* <span data-ttu-id="0b784-138">**Adaptación del almacén de datos al patrón de uso**.</span><span class="sxs-lookup"><span data-stu-id="0b784-138">**Match the data store to the pattern of use**.</span></span> <span data-ttu-id="0b784-139">La creación de particiones permite la implementación de cada partición en un tipo de almacén de datos diferente en función de costo y las características integradas que ofrece el almacén de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-139">Partitioning allows each partition to be deployed on a different type of data store, based on cost and the built-in features that data store offers.</span></span> <span data-ttu-id="0b784-140">Por ejemplo, podrían almacenarse datos binarios de grandes dimensiones en un almacén de datos blob, aunque se podrían mantener datos más estructurados en una base de datos de documentos.</span><span class="sxs-lookup"><span data-stu-id="0b784-140">For example, large binary data can be stored in a blob data store, while more structured data can be held in a document database.</span></span> <span data-ttu-id="0b784-141">Para más información, consulte [Building a polyglot solution] (Creación de una solución de Polyglot) en la guía de patrones y prácticas y [Data access for highly-scalable solutions: Using SQL, NoSQL, and polyglot persistence] (Acceso a datos para soluciones altamente escalables: uso de SQL, NoSQL y persistencia de Polyglot) en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-141">For more information, see [Building a polyglot solution] in the patterns & practices guide and [Data access for highly-scalable solutions: Using SQL, NoSQL, and polyglot persistence] on the Microsoft website.</span></span>

<span data-ttu-id="0b784-142">Algunos sistemas no implementan la creación de particiones porque se considera un costo adicional en lugar de una ventaja.</span><span class="sxs-lookup"><span data-stu-id="0b784-142">Some systems do not implement partitioning because it is considered a cost rather than an advantage.</span></span> <span data-ttu-id="0b784-143">Entre las causas más comunes de este razonamiento se incluyen:</span><span class="sxs-lookup"><span data-stu-id="0b784-143">Common reasons for this rationale include:</span></span>

* <span data-ttu-id="0b784-144">Muchos sistemas de almacenamiento de datos no admiten combinaciones entre las particiones, y es posible que resulte difícil de mantener la integridad referencial en un sistema con particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-144">Many data storage systems do not support joins across partitions, and it can be difficult to maintain referential integrity in a partitioned system.</span></span> <span data-ttu-id="0b784-145">A menudo es necesario implementar combinaciones y comprobaciones de integridad en el código de la aplicación (en la capa de partición), que puede dar lugar a E/S adicionales y al aumento de la complejidad de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-145">It is frequently necessary to implement joins and integrity checks in application code (in the partitioning layer), which can result in additional I/O and application complexity.</span></span>
* <span data-ttu-id="0b784-146">El mantenimiento de las particiones no siempre es una tarea trivial.</span><span class="sxs-lookup"><span data-stu-id="0b784-146">Maintaining partitions is not always a trivial task.</span></span> <span data-ttu-id="0b784-147">En un sistema en el que los datos son volátiles, puede que necesite volver a equilibrar las particiones periódicamente para reducir la contención y las zonas demasiado activas.</span><span class="sxs-lookup"><span data-stu-id="0b784-147">In a system where the data is volatile, you might need to rebalance partitions periodically to reduce contention and hot spots.</span></span>
* <span data-ttu-id="0b784-148">Algunas herramientas comunes no funcionan de manera natural con datos con particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-148">Some common tools do not work naturally with partitioned data.</span></span>

## <a name="designing-partitions"></a><span data-ttu-id="0b784-149">Diseño de particiones</span><span class="sxs-lookup"><span data-stu-id="0b784-149">Designing partitions</span></span>
<span data-ttu-id="0b784-150">Los datos se pueden dividir en particiones de maneras diferentes: horizontal, vertical o funcionalmente.</span><span class="sxs-lookup"><span data-stu-id="0b784-150">Data can be partitioned in different ways: horizontally, vertically, or functionally.</span></span> <span data-ttu-id="0b784-151">La estrategia que elija depende de la razón por la que efectúa la partición de los datos y los requisitos de las aplicaciones y servicios que usarán los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-151">The strategy you choose depends on the reason for partitioning the data, and the requirements of the applications and services that will use the data.</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-152">Los esquemas de creación de particiones descritos en esta guía se explican de manera independiente a la tecnología de almacenamiento de datos subyacente.</span><span class="sxs-lookup"><span data-stu-id="0b784-152">The partitioning schemes described in this guidance are explained in a way that is independent of the underlying data storage technology.</span></span> <span data-ttu-id="0b784-153">Se pueden aplicar a muchos tipos de almacenes de datos, incluidas las bases de datos relacionales y NoSQL.</span><span class="sxs-lookup"><span data-stu-id="0b784-153">They can be applied to many types of data stores, including relational and NoSQL databases.</span></span>
>
>

### <a name="partitioning-strategies"></a><span data-ttu-id="0b784-154">Estrategias de creación de particiones</span><span class="sxs-lookup"><span data-stu-id="0b784-154">Partitioning strategies</span></span>
<span data-ttu-id="0b784-155">Las tres estrategias típicas de creación de particiones de datos son:</span><span class="sxs-lookup"><span data-stu-id="0b784-155">The three typical strategies for partitioning data are:</span></span>

* <span data-ttu-id="0b784-156">**Particiones horizontales** (a menudo denominadas *particionamiento*).</span><span class="sxs-lookup"><span data-stu-id="0b784-156">**Horizontal partitioning** (often called *sharding*).</span></span> <span data-ttu-id="0b784-157">En esta estrategia, cada partición es un almacén de datos por derecho propio, pero todas las particiones tienen el mismo esquema.</span><span class="sxs-lookup"><span data-stu-id="0b784-157">In this strategy, each partition is a data store in its own right, but all partitions have the same schema.</span></span> <span data-ttu-id="0b784-158">Cada división se conoce como *partición* y contiene un subconjunto específico de los datos, como todos los pedidos de un conjunto específico de clientes en una aplicación de comercio electrónico.</span><span class="sxs-lookup"><span data-stu-id="0b784-158">Each partition is known as a *shard* and holds a specific subset of the data, such as all the orders for a specific set of customers in an e-commerce application.</span></span>
* <span data-ttu-id="0b784-159">**Particiones verticales**.</span><span class="sxs-lookup"><span data-stu-id="0b784-159">**Vertical partitioning**.</span></span> <span data-ttu-id="0b784-160">En esta estrategia, cada partición contiene un subconjunto de los campos de elementos del almacén de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-160">In this strategy, each partition holds a subset of the fields for items in the data store.</span></span> <span data-ttu-id="0b784-161">Los campos se dividen según su patrón de uso.</span><span class="sxs-lookup"><span data-stu-id="0b784-161">The fields are divided according to their pattern of use.</span></span> <span data-ttu-id="0b784-162">Por ejemplo, los campos a los que se accede con frecuencia pueden colocarse en una partición vertical y los campos que se utilizan más raramente en otra.</span><span class="sxs-lookup"><span data-stu-id="0b784-162">For example, frequently accessed fields might be placed in one vertical partition and less frequently accessed fields in another.</span></span>
* <span data-ttu-id="0b784-163">**Creación de particiones funcional**.</span><span class="sxs-lookup"><span data-stu-id="0b784-163">**Functional partitioning**.</span></span> <span data-ttu-id="0b784-164">En esta estrategia, los datos se agregan en función de cómo los usa cada contexto limitado en el sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-164">In this strategy, data is aggregated according to how it is used by each bounded context in the system.</span></span> <span data-ttu-id="0b784-165">Por ejemplo, un sistema de comercio electrónico que implementa funciones empresariales independientes para la facturación y administración de inventarios de productos puede almacenar datos de la factura en una partición y datos del inventario de productos en la otra.</span><span class="sxs-lookup"><span data-stu-id="0b784-165">For example, an e-commerce system that implements separate business functions for invoicing and managing product inventory might store invoice data in one partition and product inventory data in another.</span></span>

<span data-ttu-id="0b784-166">Es importante tener en cuenta que se pueden combinar las tres estrategias que se describen aquí.</span><span class="sxs-lookup"><span data-stu-id="0b784-166">It’s important to note that the three strategies described here can be combined.</span></span> <span data-ttu-id="0b784-167">No son mutuamente excluyentes, y es recomendables considerarlas todas cuando se diseña un esquema de creación de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-167">They are not mutually exclusive, and we recommend that you consider them all when you design a partitioning scheme.</span></span> <span data-ttu-id="0b784-168">Por ejemplo, puede dividir los datos en particiones y, a continuación, usar particiones verticales para subdividir todavía más los datos de cada partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-168">For example, you might divide data into shards and then use vertical partitioning to further subdivide the data in each shard.</span></span> <span data-ttu-id="0b784-169">De forma similar, los datos de una partición funcional se pueden dividir en particiones (que pueden también dividirse verticalmente).</span><span class="sxs-lookup"><span data-stu-id="0b784-169">Similarly, the data in a functional partition can be split into shards (which can also be vertically partitioned).</span></span>

<span data-ttu-id="0b784-170">Sin embargo, los diferentes requisitos de cada estrategia pueden plantear una serie de problemas en conflicto.</span><span class="sxs-lookup"><span data-stu-id="0b784-170">However, the differing requirements of each strategy can raise a number of conflicting issues.</span></span> <span data-ttu-id="0b784-171">Debe evaluar y equilibrar todos ellos al diseñar un esquema de partición que cumpla los objetivos de rendimiento del procesamiento de datos global para su sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-171">You must evaluate and balance all of these when designing a partitioning scheme that meets the overall data processing performance targets for your system.</span></span> <span data-ttu-id="0b784-172">Las secciones siguientes exploran cada una de las estrategias más detalladamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-172">The following sections explore each of the strategies in more detail.</span></span>

### <a name="horizontal-partitioning-sharding"></a><span data-ttu-id="0b784-173">Creación de particiones horizontales (particionamiento)</span><span class="sxs-lookup"><span data-stu-id="0b784-173">Horizontal partitioning (sharding)</span></span>
<span data-ttu-id="0b784-174">En la figura 1 se muestra una visión general de la creación de particiones horizontales o particionamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-174">Figure 1 shows an overview of horizontal partitioning or sharding.</span></span> <span data-ttu-id="0b784-175">En este ejemplo, los datos del inventario de productos se dividen en particiones según la clave del producto.</span><span class="sxs-lookup"><span data-stu-id="0b784-175">In this example, product inventory data is divided into shards based on the product key.</span></span> <span data-ttu-id="0b784-176">Cada partición contiene los datos de un intervalo contiguo de claves de partición (A-G y H-Z), organizadas alfabéticamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-176">Each shard holds the data for a contiguous range of shard keys (A-G and H-Z), organized alphabetically.</span></span>

![Creación de particiones horizontales de datos basadas en una clave de partición](./images/data-partitioning/DataPartitioning01.png)

<span data-ttu-id="0b784-178">*Ilustración 1. Creación de particiones horizontales de datos basadas en una clave de partición*</span><span class="sxs-lookup"><span data-stu-id="0b784-178">*Figure 1. Horizontally partitioning (sharding) data based on a partition key*</span></span>

<span data-ttu-id="0b784-179">El particionamiento le ayuda a distribuir la carga entre más equipos, lo cual reduce la contención y mejora el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-179">Sharding helps you spread the load over more computers, which reduces contention and improves performance.</span></span> <span data-ttu-id="0b784-180">Puede escalar el sistema horizontalmente agregando más particiones que se ejecutan en servidores adicionales.</span><span class="sxs-lookup"><span data-stu-id="0b784-180">You can scale the system out by adding further shards that run on additional servers.</span></span>

<span data-ttu-id="0b784-181">El factor más importante al implementar esta estrategia de partición es la opción de clave de particionamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-181">The most important factor when implementing this partitioning strategy is the choice of sharding key.</span></span> <span data-ttu-id="0b784-182">Puede resultar difícil cambiar la clave después de que el sistema está en funcionamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-182">It can be difficult to change the key after the system is in operation.</span></span> <span data-ttu-id="0b784-183">La clave debe asegurarse de que los datos están divididos en particiones para que la carga de trabajo sea lo más uniforme posible entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-183">The key must ensure that data is partitioned so that the workload is as even as possible across the shards.</span></span>

<span data-ttu-id="0b784-184">Tenga en cuenta que no es necesario que las distintas particiones contengan volúmenes de datos similares.</span><span class="sxs-lookup"><span data-stu-id="0b784-184">Note that different shards do not have to contain similar volumes of data.</span></span> <span data-ttu-id="0b784-185">En realidad, lo más importante es equilibrar el número de solicitudes.</span><span class="sxs-lookup"><span data-stu-id="0b784-185">Rather, the more important consideration is to balance the number of requests.</span></span> <span data-ttu-id="0b784-186">Algunas particiones podrían ser muy grandes pero contener un número de elementos que reciben un número reducido de operaciones de acceso.</span><span class="sxs-lookup"><span data-stu-id="0b784-186">Some shards might be very large, but each item is the subject of a low number of access operations.</span></span> <span data-ttu-id="0b784-187">En el caso opuesto, otras particiones podrían ser más pequeñas pero contener un número de elementos a los que se accede con mayor frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-187">Other shards might be smaller, but each item is accessed much more frequently.</span></span> <span data-ttu-id="0b784-188">También es importante asegurarse de que una sola partición no supere los límites de escala (en términos de capacidad y recursos de procesamiento) del almacén de datos que se utiliza para hospedar esa partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-188">It is also important to ensure that a single shard does not exceed the scale limits (in terms of capacity and processing resources) of the data store that's being used to host that shard.</span></span>

<span data-ttu-id="0b784-189">Si usa un esquema de particionamiento, evite la creación de zonas muy activas (o particiones calientes) que pueden afectar al rendimiento y la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-189">If you use a sharding scheme, avoid creating hotspots (or hot partitions) that can affect performance and availability.</span></span> <span data-ttu-id="0b784-190">Por ejemplo, si usa un algoritmo hash de un identificador de cliente en lugar de la primera letra de su nombre, evitará la distribución desequilibrada que resulta del uso de letras iniciales comunes y menos comunes.</span><span class="sxs-lookup"><span data-stu-id="0b784-190">For example, if you use a hash of a customer identifier instead of the first letter of a customer’s name, you prevent the unbalanced distribution that results from common and less common initial letters.</span></span> <span data-ttu-id="0b784-191">Se trata de una técnica habitual que ayuda a distribuir los datos de forma más equitativa entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-191">This is a typical technique that helps distribute data more evenly across partitions.</span></span>

<span data-ttu-id="0b784-192">Elija una clave de particionamiento que minimice cualquier necesidad futura de dividir particiones grandes en partes más pequeñas, fusionar particiones pequeñas en particiones mayores o cambiar el esquema que describe los datos almacenados en un conjunto de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-192">Choose a sharding key that minimizes any future requirements to split large shards into smaller pieces, coalesce small shards into larger partitions, or change the schema that describes the data stored in a set of partitions.</span></span> <span data-ttu-id="0b784-193">Estas operaciones pueden llevar mucho tiempo y pueden requerir desconectar una o más particiones sin conexión mientras se llevan a cabo.</span><span class="sxs-lookup"><span data-stu-id="0b784-193">These operations can be very time consuming, and might require taking one or more shards offline while they are performed.</span></span>

<span data-ttu-id="0b784-194">Si se replican las particiones, debería ser posible conservar algunas de las réplicas en línea mientras otras se dividen, se combinan o se vuelven a configurar.</span><span class="sxs-lookup"><span data-stu-id="0b784-194">If shards are replicated, it might be possible to keep some of the replicas online while others are split, merged, or reconfigured.</span></span> <span data-ttu-id="0b784-195">Sin embargo, el sistema podría requerir la limitación de las operaciones que se pueden realizar en los datos de esas particiones mientras lleva a cabo la reconfiguración.</span><span class="sxs-lookup"><span data-stu-id="0b784-195">However, the system might need to limit the operations that can be performed on the data in these shards while the reconfiguration is taking place.</span></span> <span data-ttu-id="0b784-196">Por ejemplo, los datos de las réplicas podrían marcarse como de solo lectura para limitar el ámbito de las incoherencias que podrían producirse mientras se están reestructurando las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-196">For example, the data in the replicas can be marked as read-only to limit the scope of inconsistences that might occur while shards are being restructured.</span></span>

> <span data-ttu-id="0b784-197">Para más información e instrucciones sobre muchas de estas consideraciones y técnicas de prácticas recomendadas de diseño de almacenes de datos que implementan particiones horizontales, consulte [patrón particionamiento](Patrón de particionamiento).</span><span class="sxs-lookup"><span data-stu-id="0b784-197">For more detailed information and guidance about many of these considerations, and good practice techniques for designing data stores that implement horizontal partitioning, see [Sharding pattern].</span></span>
>
>

### <a name="vertical-partitioning"></a><span data-ttu-id="0b784-198">Particiones verticales</span><span class="sxs-lookup"><span data-stu-id="0b784-198">Vertical partitioning</span></span>
<span data-ttu-id="0b784-199">El uso más común para la partición vertical es reducir los costes de E/S y de rendimiento asociados con la recopilación de los elementos a los que se tiene acceso con más frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-199">The most common use for vertical partitioning is to reduce the I/O and performance costs associated with fetching the items that are accessed most frequently.</span></span> <span data-ttu-id="0b784-200">La ilustración 2 muestra un ejemplo de creación de particiones verticales.</span><span class="sxs-lookup"><span data-stu-id="0b784-200">Figure 2 shows an example of vertical partitioning.</span></span> <span data-ttu-id="0b784-201">En este ejemplo, se mantienen diferentes propiedades para cada elemento de datos en diferentes particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-201">In this example, different properties for each data item are held in different partitions.</span></span> <span data-ttu-id="0b784-202">Una partición contiene datos a los que se tiene acceso con mayor frecuencia, incluidos el nombre, la descripción y la información de precios de los productos.</span><span class="sxs-lookup"><span data-stu-id="0b784-202">One partition holds data that is accessed more frequently, including the name, description, and price information for products.</span></span> <span data-ttu-id="0b784-203">Otra contiene el volumen en existencias y la fecha del último pedido.</span><span class="sxs-lookup"><span data-stu-id="0b784-203">Another holds the volume in stock and the last ordered date.</span></span>

![Creación de particiones verticales de datos por su patrón de uso](./images/data-partitioning/DataPartitioning02.png)

<span data-ttu-id="0b784-205">*Ilustración 2. Creación de particiones verticales de datos por su patrón de uso*</span><span class="sxs-lookup"><span data-stu-id="0b784-205">*Figure 2. Vertically partitioning data by its pattern of use*</span></span>

<span data-ttu-id="0b784-206">En este ejemplo, la aplicación consulta periódicamente el nombre del producto, la descripción y el precio al mostrar los detalles de los productos a los clientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-206">In this example, the application regularly queries the product name, description, and price when displaying the product details to customers.</span></span> <span data-ttu-id="0b784-207">El nivel de existencias y la fecha en la que se efectuó el último pedido del producto al fabricante se mantienen en una partición independiente porque estos dos elementos se utilizan conjuntamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-207">The stock level and date when the product was last ordered from the manufacturer are held in a separate partition because these two items are commonly used together.</span></span>

<span data-ttu-id="0b784-208">Este esquema de partición tiene la ventaja agregada de que los datos de movimiento relativamente lento (nombre de producto, descripción y precio) están separados de los datos más dinámicos (nivel de existencias y fecha del último pedido).</span><span class="sxs-lookup"><span data-stu-id="0b784-208">This partitioning scheme has the added advantage that the relatively slow-moving data (product name, description, and price) is separated from the more dynamic data (stock level and last ordered date).</span></span> <span data-ttu-id="0b784-209">Una aplicación podría encontrar beneficioso almacenar en la caché los datos de movimiento lento de la memoria si se tiene acceso a ellos con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-209">An application might find it beneficial to cache the slow-moving data in memory if it is frequently accessed.</span></span>

<span data-ttu-id="0b784-210">Otro escenario típico de esta estrategia de partición es maximizar la seguridad de los datos confidenciales.</span><span class="sxs-lookup"><span data-stu-id="0b784-210">Another typical scenario for this partitioning strategy is to maximize the security of sensitive data.</span></span> <span data-ttu-id="0b784-211">Por ejemplo, puede hacerlo mediante el almacenamiento de los números de tarjetas de crédito y los números correspondientes de comprobación de la seguridad de la tarjeta correspondientes en particiones independientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-211">For example, you can do this by storing credit card numbers and the corresponding card security verification numbers in separate partitions.</span></span>

<span data-ttu-id="0b784-212">La creación de particiones verticales también puede reducir la cantidad de acceso simultáneo necesario a los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-212">Vertical partitioning can also reduce the amount of concurrent access that's needed to the data.</span></span>

> <span data-ttu-id="0b784-213">La creación de particiones verticales funciona a nivel de entidad dentro de un almacén de datos, normalizando parcialmente una entidad para dividirla de un elemento *amplio* en un conjunto de elementos *reducido*.</span><span class="sxs-lookup"><span data-stu-id="0b784-213">Vertical partitioning operates at the entity level within a data store, partially normalizing an entity to break it down from a *wide* item to a set of *narrow* items.</span></span> <span data-ttu-id="0b784-214">Es ideal para almacenes de datos orientados a columnas como HBase y Cassandra.</span><span class="sxs-lookup"><span data-stu-id="0b784-214">It is ideally suited for column-oriented data stores such as HBase and Cassandra.</span></span> <span data-ttu-id="0b784-215">Si es poco probable que los datos de una colección de columnas cambien, también puede considerar el uso de almacenes de columnas en SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0b784-215">If the data in a collection of columns is unlikely to change, you can also consider using column stores in SQL Server.</span></span>
>
>

### <a name="functional-partitioning"></a><span data-ttu-id="0b784-216">Creación de particiones funcional</span><span class="sxs-lookup"><span data-stu-id="0b784-216">Functional partitioning</span></span>
<span data-ttu-id="0b784-217">Para los sistemas en los que es posible identificar un contexto limitado para cada área de negocio o servicio independiente en la aplicación, la creación de particiones funcional proporciona una técnica para mejorar el rendimiento de acceso a datos y el aislamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-217">For systems where it is possible to identify a bounded context for each distinct business area or service in the application, functional partitioning provides a technique for improving isolation and data access performance.</span></span> <span data-ttu-id="0b784-218">Otro uso común de la creación de particiones funcional es separar los datos de lectura y escritura de los datos de solo lectura que se utilizan para elaborar informes.</span><span class="sxs-lookup"><span data-stu-id="0b784-218">Another common use of functional partitioning is to separate read-write data from read-only data that's used for reporting purposes.</span></span> <span data-ttu-id="0b784-219">En la figura 3 se muestra una visión general de la creación de particiones donde se separan los datos de inventario de los datos del cliente.</span><span class="sxs-lookup"><span data-stu-id="0b784-219">Figure 3 shows an overview of functional partitioning where inventory data is separated from customer data.</span></span>

![Creación de particiones de datos funcionalmente por contexto o subdominio vinculado](./images/data-partitioning/DataPartitioning03.png)

<span data-ttu-id="0b784-221">*Ilustración 3. Creación de particiones de datos funcionalmente por contexto o subdominio vinculado*</span><span class="sxs-lookup"><span data-stu-id="0b784-221">*Figure 3. Functionally partitioning data by bounded context or subdomain*</span></span>

<span data-ttu-id="0b784-222">Esta estrategia de creación de particiones puede ayudar a reducir la contención de acceso a datos a través de distintas partes de un sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-222">This partitioning strategy can help reduce data access contention across different parts of a system.</span></span>

## <a name="designing-partitions-for-scalability"></a><span data-ttu-id="0b784-223">Diseño de particiones para obtener escalabilidad</span><span class="sxs-lookup"><span data-stu-id="0b784-223">Designing partitions for scalability</span></span>
<span data-ttu-id="0b784-224">Es fundamental considerar el tamaño y la carga de trabajo de cada partición y equilibrarlos para que los datos se distribuyan y logren alcanzar una máxima escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-224">It's vital to consider size and workload for each partition and balance them so that data is distributed to achieve maximum scalability.</span></span> <span data-ttu-id="0b784-225">Sin embargo, también debe particionar los datos para que no superen los límites de escala de un almacén de una única partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-225">However, you must also partition the data so that it does not exceed the scaling limits of a single partition store.</span></span>

<span data-ttu-id="0b784-226">Siga estos pasos durante el diseño de particiones para obtener escalabilidad:</span><span class="sxs-lookup"><span data-stu-id="0b784-226">Follow these steps when designing partitions for scalability:</span></span>

1. <span data-ttu-id="0b784-227">Analice la aplicación para comprender los patrones de acceso a datos, como el tamaño del conjunto de resultados devuelto por cada consulta, la frecuencia de acceso, la latencia inherente y los requisitos de procesamiento del lado del servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-227">Analyze the application to understand the data access patterns, such as the size of the result set returned by each query, the frequency of access, the inherent latency, and the server-side compute processing requirements.</span></span> <span data-ttu-id="0b784-228">En muchos casos, unas cuantas entidades principales exigirán la mayoría de los recursos de procesamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-228">In many cases, a few major entities will demand most of the processing resources.</span></span>
2. <span data-ttu-id="0b784-229">Utilice este análisis para determinar los objetivos de escalabilidad actuales y futuros, como el tamaño de los datos y la carga de trabajo.</span><span class="sxs-lookup"><span data-stu-id="0b784-229">Use this analysis to determine the current and future scalability targets, such as data size and workload.</span></span> <span data-ttu-id="0b784-230">A continuación, distribuya los datos entre las particiones para cumplir el objetivo de escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-230">Then distribute the data across the partitions to meet the scalability target.</span></span> <span data-ttu-id="0b784-231">En la estrategia de creación de particiones horizontal, es importante elegir la partición adecuada para asegurarse de que la distribución es equilibrada.</span><span class="sxs-lookup"><span data-stu-id="0b784-231">In the horizontal partitioning strategy, choosing the appropriate shard key is important to make sure distribution is even.</span></span> <span data-ttu-id="0b784-232">Para más información, consulte el [patrón particionamiento].</span><span class="sxs-lookup"><span data-stu-id="0b784-232">For more information, see the [Sharding pattern].</span></span>
3. <span data-ttu-id="0b784-233">Asegúrese de que los recursos disponibles de cada partición sean suficientes para controlar los requisitos de escalabilidad en términos de rendimiento y tamaño de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-233">Make sure that the resources available to each partition are sufficient to handle the scalability requirements in terms of data size and throughput.</span></span> <span data-ttu-id="0b784-234">Por ejemplo, el nodo que hospeda una partición puede imponer un límite riguroso en la cantidad de espacio de almacenamiento, la potencia de procesamiento o el ancho de banda de red que proporciona.</span><span class="sxs-lookup"><span data-stu-id="0b784-234">For example, the node that's hosting a partition might impose a hard limit on the amount of storage space, processing power, or network bandwidth that it provides.</span></span> <span data-ttu-id="0b784-235">Si los requisitos de almacenamiento y procesamiento de datos suelen superar estos límites, podría ser necesario perfeccionar la estrategia de creación de particiones o dividir todavía más los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-235">If the data storage and processing requirements are likely to exceed these limits, it might be necessary to refine your partitioning strategy or split data out further.</span></span> <span data-ttu-id="0b784-236">Por ejemplo, un planteamiento orientado a la escalabilidad podría ser la separación de los datos de registro de las características principales de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-236">For example, one scalability approach might be to separate logging data from the core application features.</span></span> <span data-ttu-id="0b784-237">Puede hacerlo mediante el uso de almacenes de datos independientes para evitar que los requisitos de almacenamiento de datos total superen el límite de escala del nodo.</span><span class="sxs-lookup"><span data-stu-id="0b784-237">You do this by using separate data stores to prevent the total data storage requirements from exceeding the scaling limit of the node.</span></span> <span data-ttu-id="0b784-238">Si el número total de almacenes de datos supera el límite de nodos, puede ser necesario usar nodos de almacenamiento independientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-238">If the total number of data stores exceeds the node limit, it might be necessary to use separate storage nodes.</span></span>
4. <span data-ttu-id="0b784-239">Supervise el sistema en uso para comprobar que los datos se distribuyen según lo previsto y que las particiones pueden controlar la carga impuesta en ellos.</span><span class="sxs-lookup"><span data-stu-id="0b784-239">Monitor the system under use to verify that the data is distributed as expected and that the partitions can handle the load that is imposed on them.</span></span> <span data-ttu-id="0b784-240">Es posible que el uso no coincida con el uso previsto por el análisis.</span><span class="sxs-lookup"><span data-stu-id="0b784-240">It's possible that the usage does not match the usage that's anticipated by the analysis.</span></span> <span data-ttu-id="0b784-241">En ese caso, quizá se pueda volver a equilibrar las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-241">In that case, it might be possible to rebalance the partitions.</span></span> <span data-ttu-id="0b784-242">En caso contrario, puede ser necesario volver a diseñar algunas partes del sistema para obtener el equilibrio necesario.</span><span class="sxs-lookup"><span data-stu-id="0b784-242">Failing that, it might be necessary to redesign some parts of the system to gain the required balance.</span></span>

<span data-ttu-id="0b784-243">Tenga en cuenta que algunos entornos de nube asignan recursos en términos de límites de infraestructura.</span><span class="sxs-lookup"><span data-stu-id="0b784-243">Note that some cloud environments allocate resources in terms of infrastructure boundaries.</span></span> <span data-ttu-id="0b784-244">Asegúrese de que los límites seleccionados proporcionen suficiente espacio para cualquier crecimiento previsto en el volumen de datos, en términos de ancho de banda, potencia de procesamiento y almacenamiento de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-244">Ensure that the limits of your selected boundary provide enough room for any anticipated growth in the volume of data, in terms of data storage, processing power, and bandwidth.</span></span>

<span data-ttu-id="0b784-245">Por ejemplo, si usa Almacenamiento de tablas de Azure, una partición ocupada podría requerir más recursos de los que están disponibles para una sola partición a fin de dar respuesta a las solicitudes.</span><span class="sxs-lookup"><span data-stu-id="0b784-245">For example, if you use Azure table storage, a busy shard might require more resources than are available to a single partition to handle requests.</span></span> <span data-ttu-id="0b784-246">(Existe un límite en el volumen de solicitudes que pueden administrarse mediante una sola partición en un período de tiempo concreto.</span><span class="sxs-lookup"><span data-stu-id="0b784-246">(There is a limit to the volume of requests that can be handled by a single partition in a particular period of time.</span></span> <span data-ttu-id="0b784-247">Para más información, consulte la página [Objetivos de escalabilidad y rendimiento del almacenamiento de Azure] en el sitio web de Microsoft).</span><span class="sxs-lookup"><span data-stu-id="0b784-247">See the page [Azure storage scalability and performance targets] on the Microsoft website for more details.)</span></span>

 <span data-ttu-id="0b784-248">En este caso, es posible que se necesite crear una partición adicional dentro de la propia partición para repartir la carga.</span><span class="sxs-lookup"><span data-stu-id="0b784-248">If this is the case, the shard might need to be repartitioned to spread the load.</span></span> <span data-ttu-id="0b784-249">Si el tamaño total o el rendimiento de estas tablas supera la capacidad de una cuenta de almacenamiento, puede ser necesario crear cuentas de almacenamiento adicionales y repartir las tablas entre estas cuentas.</span><span class="sxs-lookup"><span data-stu-id="0b784-249">If the total size or throughput of these tables exceeds the capacity of a storage account, it might be necessary to create additional storage accounts and spread the tables across these accounts.</span></span> <span data-ttu-id="0b784-250">Si el número de cuentas de almacenamiento supera el número de cuentas que están disponibles para una suscripción, es posible que resulte necesario usar varias suscripciones.</span><span class="sxs-lookup"><span data-stu-id="0b784-250">If the number of storage accounts exceeds the number of accounts that are available to a subscription, then it might be necessary to use multiple subscriptions.</span></span>

## <a name="designing-partitions-for-query-performance"></a><span data-ttu-id="0b784-251">Diseño de particiones para aumentar el rendimiento de las consultas</span><span class="sxs-lookup"><span data-stu-id="0b784-251">Designing partitions for query performance</span></span>
<span data-ttu-id="0b784-252">El rendimiento de las consultas a menudo puede ampliarse mediante el uso de conjuntos de datos más pequeños y la ejecución de consultas en paralelo.</span><span class="sxs-lookup"><span data-stu-id="0b784-252">Query performance can often be boosted by using smaller data sets and by running parallel queries.</span></span> <span data-ttu-id="0b784-253">Cada partición debe contener una pequeña proporción de todo el conjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-253">Each partition should contain a small proportion of the entire data set.</span></span> <span data-ttu-id="0b784-254">Esta reducción en el volumen puede mejorar el rendimiento de las consultas.</span><span class="sxs-lookup"><span data-stu-id="0b784-254">This reduction in volume can improve the performance of queries.</span></span> <span data-ttu-id="0b784-255">Sin embargo, la partición no es una alternativa para diseñar y configurar una base de datos de forma adecuada.</span><span class="sxs-lookup"><span data-stu-id="0b784-255">However, partitioning is not an alternative for designing and configuring a database appropriately.</span></span> <span data-ttu-id="0b784-256">Por ejemplo, asegúrese de que tiene los índices necesarios establecidos si está usando una base de datos relacional.</span><span class="sxs-lookup"><span data-stu-id="0b784-256">For example, make sure that you have the necessary indexes in place if you are using a relational database.</span></span>

<span data-ttu-id="0b784-257">Al diseñar las particiones para aumentar el rendimiento de las consultas, siga estos pasos:</span><span class="sxs-lookup"><span data-stu-id="0b784-257">Follow these steps when designing partitions for query performance:</span></span>

1. <span data-ttu-id="0b784-258">Examine los requisitos de la aplicación y el rendimiento:</span><span class="sxs-lookup"><span data-stu-id="0b784-258">Examine the application requirements and performance:</span></span>
   * <span data-ttu-id="0b784-259">Use los requisitos empresariales para determinar las consultas más importantes que siempre deben ejecutarse rápidamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-259">Use the business requirements to determine the critical queries that must always perform quickly.</span></span>
   * <span data-ttu-id="0b784-260">Supervise el sistema para identificar las consultas que se ejecutan lentamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-260">Monitor the system to identify any queries that perform slowly.</span></span>
   * <span data-ttu-id="0b784-261">Establezca las consultas que se realizan con mayor frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-261">Establish which queries are performed most frequently.</span></span> <span data-ttu-id="0b784-262">Una sola instancia de cada consulta podría tener un coste mínimo, pero el consumo acumulado de recursos podría ser importante.</span><span class="sxs-lookup"><span data-stu-id="0b784-262">A single instance of each query might have minimal cost, but the cumulative consumption of resources could be significant.</span></span> <span data-ttu-id="0b784-263">Puede ser beneficioso separar los datos recuperados por estas consultas en una partición distinta o incluso una caché.</span><span class="sxs-lookup"><span data-stu-id="0b784-263">It might be beneficial to separate the data that's retrieved by these queries into a distinct partition, or even a cache.</span></span>
2. <span data-ttu-id="0b784-264">Para crear una partición en los datos que están provocando un rendimiento lento, haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0b784-264">Partition the data that is causing slow performance:</span></span>
   * <span data-ttu-id="0b784-265">Limitar el tamaño de cada partición para que el tiempo de respuesta de la consulta se encuentre dentro del objetivo.</span><span class="sxs-lookup"><span data-stu-id="0b784-265">Limit the size of each partition so that the query response time is within target.</span></span>
   * <span data-ttu-id="0b784-266">Diseñar la clave de partición de manera que la aplicación pueda encontrar fácilmente la partición si está implementando la creación de particiones horizontal.</span><span class="sxs-lookup"><span data-stu-id="0b784-266">Design the shard key so that the application can easily find the partition if you are implementing horizontal partitioning.</span></span> <span data-ttu-id="0b784-267">Esto evita que la consulta tenga que examinar cada partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-267">This prevents the query from having to scan through every partition.</span></span>
   * <span data-ttu-id="0b784-268">Considerar la ubicación de una partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-268">Consider the location of a partition.</span></span> <span data-ttu-id="0b784-269">Si es posible, intente mantener los datos en particiones que estén geográficamente cerca de las aplicaciones y los usuarios que acceden a ellos.</span><span class="sxs-lookup"><span data-stu-id="0b784-269">If possible, try to keep data in partitions that are geographically close to the applications and users that access it.</span></span>
3. <span data-ttu-id="0b784-270">Si una entidad tiene requisitos de rendimiento y de rendimiento de consultas, use la creación de particiones funcional basada en esa entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-270">If an entity has throughput and query performance requirements, use functional partitioning based on that entity.</span></span> <span data-ttu-id="0b784-271">Si esto todavía no logra satisfacer los requisitos, aplique también la creación de particiones horizontal.</span><span class="sxs-lookup"><span data-stu-id="0b784-271">If this still doesn't satisfy the requirements, apply horizontal partitioning as well.</span></span> <span data-ttu-id="0b784-272">En la mayoría de los casos bastará una estrategia de partición única, pero en algunos casos, resulta más eficaz combinar ambas estrategias.</span><span class="sxs-lookup"><span data-stu-id="0b784-272">In most cases a single partitioning strategy will suffice, but in some cases it is more efficient to combine both strategies.</span></span>
4. <span data-ttu-id="0b784-273">Considere utilizar consultas asincrónicas que se ejecutan en paralelo entre las particiones para mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-273">Consider using asynchronous queries that run in parallel across partitions to improve performance.</span></span>

## <a name="designing-partitions-for-availability"></a><span data-ttu-id="0b784-274">Diseño de particiones para obtener disponibilidad</span><span class="sxs-lookup"><span data-stu-id="0b784-274">Designing partitions for availability</span></span>
<span data-ttu-id="0b784-275">Crear particiones de datos puede mejorar la disponibilidad de aplicaciones asegurándose de que todo el conjunto de datos no constituye un punto de error único y que subconjuntos individuales del conjunto de datos pueden administrarse de forma independiente.</span><span class="sxs-lookup"><span data-stu-id="0b784-275">Partitioning data can improve the availability of applications by ensuring that the entire dataset does not constitute a single point of failure and that individual subsets of the dataset can be managed independently.</span></span> <span data-ttu-id="0b784-276">La replicación de las particiones que contienen datos críticos también puede mejorar la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-276">Replicating partitions that contain critical data can also improve availability.</span></span>

<span data-ttu-id="0b784-277">Al diseñar e implementar las particiones, tenga en cuenta los siguientes factores que afectan a la disponibilidad:</span><span class="sxs-lookup"><span data-stu-id="0b784-277">When designing and implementing partitions, consider the following factors that affect availability:</span></span>

* <span data-ttu-id="0b784-278">**Lo importante que son los datos para las operaciones empresariales**.</span><span class="sxs-lookup"><span data-stu-id="0b784-278">**How critical the data is to business operations**.</span></span> <span data-ttu-id="0b784-279">Algunos datos pueden contener información empresarial crítica como detalles de facturas o transacciones bancarias.</span><span class="sxs-lookup"><span data-stu-id="0b784-279">Some data might include critical business information such as invoice details or bank transactions.</span></span> <span data-ttu-id="0b784-280">Otros datos pueden ser simplemente datos operativos menos importantes, como archivos de registro, seguimientos de rendimientos, etc.</span><span class="sxs-lookup"><span data-stu-id="0b784-280">Other data might include less critical operational data, such as log files, performance traces, and so on.</span></span> <span data-ttu-id="0b784-281">Después de identificar cada tipo de datos, considere lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0b784-281">After identifying each type of data, consider:</span></span>
  * <span data-ttu-id="0b784-282">Almacenar datos críticos en las particiones de alta disponibilidad con un plan de copia de seguridad adecuado.</span><span class="sxs-lookup"><span data-stu-id="0b784-282">Storing critical data in highly-available partitions with an appropriate backup plan.</span></span>
  * <span data-ttu-id="0b784-283">Establecer mecanismos de administración y supervisión independientes o procedimientos para los diferentes elementos más importantes de cada conjunto de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-283">Establishing separate management and monitoring mechanisms or procedures for the different criticalities of each dataset.</span></span> <span data-ttu-id="0b784-284">Coloque los datos con el mismo nivel de importancia en la misma partición para que pueda efectuar una copia de seguridad de estos conjuntamente con una frecuencia adecuada.</span><span class="sxs-lookup"><span data-stu-id="0b784-284">Place data that has the same level of criticality in the same partition so that it can be backed up together at an appropriate frequency.</span></span> <span data-ttu-id="0b784-285">Por ejemplo, es posible que las particiones que contienen datos de transacciones bancarias necesiten copias de seguridad con más frecuencia que las particiones que contienen información de seguimiento o registro.</span><span class="sxs-lookup"><span data-stu-id="0b784-285">For example, partitions that hold data for bank transactions might need to be backed up more frequently than partitions that hold logging or trace information.</span></span>
* <span data-ttu-id="0b784-286">**La manera de administrar particiones individuales**.</span><span class="sxs-lookup"><span data-stu-id="0b784-286">**How individual partitions can be managed**.</span></span> <span data-ttu-id="0b784-287">Diseñar particiones para admitir el mantenimiento y administración independientes ofrece varias ventajas.</span><span class="sxs-lookup"><span data-stu-id="0b784-287">Designing partitions to support independent management and maintenance provides several advantages.</span></span> <span data-ttu-id="0b784-288">Por ejemplo:</span><span class="sxs-lookup"><span data-stu-id="0b784-288">For example:</span></span>
  * <span data-ttu-id="0b784-289">Si se produce un error en una partición, puede recuperarse de forma independiente sin afectar a las instancias de aplicaciones que tienen acceso a datos de otras particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-289">If a partition fails, it can be recovered independently without affecting instances of applications that access data in other partitions.</span></span>
  * <span data-ttu-id="0b784-290">Es posible que la creación de particiones de datos por área geográfica permita la realización de tareas de mantenimiento programadas en horas de poco tráfico para cada ubicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-290">Partitioning data by geographical area allows scheduled maintenance tasks to occur at off-peak hours for each location.</span></span> <span data-ttu-id="0b784-291">Asegúrese de que las particiones no sean demasiado grandes para evitar que se complete cualquier tarea de mantenimiento planeada durante este período.</span><span class="sxs-lookup"><span data-stu-id="0b784-291">Ensure that partitions are not too big to prevent any planned maintenance from being completed during this period.</span></span>
* <span data-ttu-id="0b784-292">**Si va a replicar datos críticos en particiones**.</span><span class="sxs-lookup"><span data-stu-id="0b784-292">**Whether to replicate critical data across partitions**.</span></span> <span data-ttu-id="0b784-293">Esta estrategia puede mejorar la disponibilidad y rendimiento, aunque también puede originar problemas de coherencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-293">This strategy can improve availability and performance, although it can also introduce consistency issues.</span></span> <span data-ttu-id="0b784-294">Los cambios realizados en los datos de una partición tardan algún tiempo en sincronizarse con cada réplica.</span><span class="sxs-lookup"><span data-stu-id="0b784-294">It takes time for changes made to data in a partition to be synchronized with every replica.</span></span> <span data-ttu-id="0b784-295">Durante este período, diferentes particiones contendrán diferentes valores de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-295">During this period, different partitions will contain different data values.</span></span>

## <a name="understanding-how-partitioning-affects-design-and-development"></a><span data-ttu-id="0b784-296">Descripción de cómo afecta la creación de particiones al diseño y el desarrollo</span><span class="sxs-lookup"><span data-stu-id="0b784-296">Understanding how partitioning affects design and development</span></span>
<span data-ttu-id="0b784-297">El uso de particiones agrega complejidad al diseño y el desarrollo del sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-297">Using partitioning adds complexity to the design and development of your system.</span></span> <span data-ttu-id="0b784-298">Considere la creación de particiones como una parte fundamental del diseño del sistema, incluso si el sistema contiene una única partición inicialmente.</span><span class="sxs-lookup"><span data-stu-id="0b784-298">Consider partitioning as a fundamental part of system design even if the system initially only contains a single partition.</span></span> <span data-ttu-id="0b784-299">Si se plantea la creación de particiones en un momento posterior, cuando el sistema empieza a sufrir problemas de rendimiento y escalabilidad, la dificultad será mayor porque ya tiene un sistema activo que mantener.</span><span class="sxs-lookup"><span data-stu-id="0b784-299">If you address partitioning as an afterthought, when the system starts to suffer performance and scalability issues, the complexity increases because you already have a live system to maintain.</span></span>

<span data-ttu-id="0b784-300">Si actualiza el sistema para incorporar la creación de particiones en este entorno, será necesario modificar la lógica de acceso a datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-300">If you update the system to incorporate partitioning in this environment, it necessitates modifying the data access logic.</span></span> <span data-ttu-id="0b784-301">También puede requerir la migración de grandes cantidades de datos existentes para distribuirlos entre las particiones, y a menudo los usuarios esperan seguir utilizando el sistema en este tiempo.</span><span class="sxs-lookup"><span data-stu-id="0b784-301">It can also involve migrating large quantities of existing data to distribute it across partitions, often while users expect to be able to continue using the system.</span></span>

<span data-ttu-id="0b784-302">En algunos casos, la creación de particiones no se considera importante porque el conjunto de datos inicial es pequeño y puede controlarse fácilmente mediante un solo servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-302">In some cases, partitioning is not considered important because the initial dataset is small and can be easily handled by a single server.</span></span> <span data-ttu-id="0b784-303">Esto puede ocurrir en un sistema que no se espera que aumente más allá de su tamaño inicial; sin embargo, muchos sistemas comerciales requieren una ampliación a medida que aumenta el número de usuarios.</span><span class="sxs-lookup"><span data-stu-id="0b784-303">This might be true in a system that is not expected to scale beyond its initial size, but many commercial systems need to expand as the number of users increases.</span></span> <span data-ttu-id="0b784-304">Esta expansión normalmente viene acompañada de un crecimiento en el volumen de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-304">This expansion is typically accompanied by a growth in the volume of data.</span></span>

<span data-ttu-id="0b784-305">También es importante entender que la creación de particiones no siempre está disponible en almacenes de datos de gran tamaño.</span><span class="sxs-lookup"><span data-stu-id="0b784-305">It's also important to understand that partitioning is not always a function of large data stores.</span></span> <span data-ttu-id="0b784-306">Por ejemplo, es posible que cientos de clientes accedan de manera intensa a un almacén de datos pequeño a la vez.</span><span class="sxs-lookup"><span data-stu-id="0b784-306">For example, a small data store might be heavily accessed by hundreds of concurrent clients.</span></span> <span data-ttu-id="0b784-307">Crear particiones de los datos en esta situación puede ayudar a reducir la contención y a mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-307">Partitioning the data in this situation can help to reduce contention and improve throughput.</span></span>

<span data-ttu-id="0b784-308">Tenga en cuenta los siguientes puntos cuando se diseña un esquema de partición de datos:</span><span class="sxs-lookup"><span data-stu-id="0b784-308">Consider the following points when you design a data partitioning scheme:</span></span>

* <span data-ttu-id="0b784-309">**Siempre que sea posible, mantenga los datos para las operaciones de base de datos más habituales juntos en cada partición para minimizar las operaciones de acceso a datos entre particiones**.</span><span class="sxs-lookup"><span data-stu-id="0b784-309">**Where possible, keep data for the most common database operations together in each partition to minimize cross-partition data access operations**.</span></span> <span data-ttu-id="0b784-310">Realizar consultas en varias particiones puede llevar más tiempo que efectuar consultas solo dentro de una sola partición, pero la optimización de las particiones para un conjunto de consultas puede afectar adversamente a otros conjuntos de consultas.</span><span class="sxs-lookup"><span data-stu-id="0b784-310">Querying across partitions can be more time-consuming than querying only within a single partition, but optimizing partitions for one set of queries might adversely affect other sets of queries.</span></span> <span data-ttu-id="0b784-311">Cuando la realización de consultas en varias particiones sea inevitable, minimice el tiempo de consulta mediante la ejecución de consultas en paralelo y la adición de los resultados en la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-311">When you can't avoid querying across partitions, minimize query time by running parallel queries and aggregating the results within the application.</span></span> <span data-ttu-id="0b784-312">Es posible que no sea posible aplicar este planteamiento en algunos casos, como cuando es necesario obtener un resultado de una consulta y usarlo en la consulta siguiente.</span><span class="sxs-lookup"><span data-stu-id="0b784-312">This approach might not be possible in some cases, such as when it's necessary to obtain a result from one query and use it in the next query.</span></span>
* <span data-ttu-id="0b784-313">**Si las consultas hacen uso de datos de referencia relativamente estáticos, como tablas de códigos postales o listas de productos, considere la posibilidad de replicar estos datos en todas las particiones para reducir la necesidad de realizar diferentes operaciones de búsqueda en las distintas particiones**.</span><span class="sxs-lookup"><span data-stu-id="0b784-313">**If queries make use of relatively static reference data, such as postal code tables or product lists, consider replicating this data in all of the partitions to reduce the requirement for separate lookup operations in different partitions**.</span></span> <span data-ttu-id="0b784-314">Este enfoque también puede reducir la probabilidad de que los datos de referencia se conviertan en un conjunto de datos excesivamente activo que soporte un tráfico intenso desde las diferentes partes del sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-314">This approach can also reduce the likelihood of the reference data becoming a "hot" dataset that is subject to heavy traffic from across the entire system.</span></span> <span data-ttu-id="0b784-315">Sin embargo, la sincronización de los cambios que pudieran producirse en estos datos de referencia conlleva un costo asociado.</span><span class="sxs-lookup"><span data-stu-id="0b784-315">However,   there is an additional cost associated with synchronizing any changes that might occur to this reference data.</span></span>
* <span data-ttu-id="0b784-316">**Siempre que sea posible, minimice los requisitos de integridad referencial en las particiones verticales y funcionales**.</span><span class="sxs-lookup"><span data-stu-id="0b784-316">**Where possible, minimize requirements for referential integrity across vertical and functional partitions**.</span></span> <span data-ttu-id="0b784-317">En estos esquemas, la propia aplicación es responsable de mantener la integridad referencial entre las particiones cuando se actualizan y consumen datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-317">In these schemes, the application itself is responsible for maintaining referential integrity across partitions when data is updated and consumed.</span></span> <span data-ttu-id="0b784-318">Las consultas que deben combinar los datos de varias particiones se ejecutan más lentamente que las consultas que solo combinan datos de la misma partición porque la aplicación normalmente necesita realizar consultas consecutivas basadas en una clave y, a continuación, en una clave externa.</span><span class="sxs-lookup"><span data-stu-id="0b784-318">Queries that must join data across multiple partitions run more slowly than queries that join data only within the same partition because the application typically needs to perform consecutive queries based on a key and then on a foreign key.</span></span> <span data-ttu-id="0b784-319">En su lugar, considere la posibilidad de replicar o anular la normalización de los datos pertinentes.</span><span class="sxs-lookup"><span data-stu-id="0b784-319">Instead, consider replicating or de-normalizing the relevant data.</span></span> <span data-ttu-id="0b784-320">Para minimizar el tiempo de consulta donde son necesarias las combinaciones entre particiones, ejecute consultas en paralelo en las particiones y combine los datos dentro de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-320">To minimize the query time where cross-partition joins are necessary, run parallel queries over the partitions and join the data within the application.</span></span>
* <span data-ttu-id="0b784-321">**Tenga en cuenta el efecto que podría tener el esquema de creación de particiones en la coherencia de los datos en las particiones.**</span><span class="sxs-lookup"><span data-stu-id="0b784-321">**Consider the effect that the partitioning scheme might have on the data consistency across partitions.**</span></span> <span data-ttu-id="0b784-322">Evalúe si realmente es necesaria una alta coherencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-322">Evaluate whether strong consistency is actually a requirement.</span></span> <span data-ttu-id="0b784-323">En su lugar, un enfoque común en la nube es implementar la coherencia eventual.</span><span class="sxs-lookup"><span data-stu-id="0b784-323">Instead, a common approach in the cloud is to implement eventual consistency.</span></span> <span data-ttu-id="0b784-324">Los datos de cada partición se actualizan por separado, y la lógica de aplicación garantiza que todas las actualizaciones se completen correctamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-324">The data in each partition is updated separately, and the application logic ensures that the updates are all completed successfully.</span></span> <span data-ttu-id="0b784-325">También controla las incoherencias que pueden surgir de la consulta de datos mientras se esté ejecutando una operación finalmente coherente.</span><span class="sxs-lookup"><span data-stu-id="0b784-325">It also handles the inconsistencies that can arise from querying data while an eventually consistent operation is running.</span></span> <span data-ttu-id="0b784-326">Para obtener más información acerca la implementación de la coherencia eventual, consulte [Data consistency primer](Información básica sobre la coherencia de datos).</span><span class="sxs-lookup"><span data-stu-id="0b784-326">For more information about implementing eventual consistency, see the [Data consistency primer].</span></span>
* <span data-ttu-id="0b784-327">**Tenga en cuenta cómo buscan las consultas la partición correcta**.</span><span class="sxs-lookup"><span data-stu-id="0b784-327">**Consider how queries locate the correct partition**.</span></span> <span data-ttu-id="0b784-328">Si una consulta debe analizar todas las particiones para localizar los datos necesarios, habrá un impacto significativo en el rendimiento, incluso cuando se ejecuten varias consultas en paralelo.</span><span class="sxs-lookup"><span data-stu-id="0b784-328">If a query must scan all partitions to locate the required data, there is a significant impact on performance, even when multiple parallel queries are running.</span></span> <span data-ttu-id="0b784-329">Las consultas utilizadas con las estrategias de creación de particiones verticales y funcionales pueden especificar las particiones de manera natural.</span><span class="sxs-lookup"><span data-stu-id="0b784-329">Queries that are used with vertical and functional partitioning strategies can naturally specify the partitions.</span></span> <span data-ttu-id="0b784-330">Sin embargo, cuando se utiliza la creación de particiones horizontal, encontrar un elemento puede resultar difícil porque cada partición tiene el mismo esquema.</span><span class="sxs-lookup"><span data-stu-id="0b784-330">However, horizontal partitioning (sharding) can make locating an item difficult because every shard has the same schema.</span></span> <span data-ttu-id="0b784-331">Una solución típica de particionamiento consiste en mantener una asignación que puede usarse para buscar la ubicación de la partición para elementos específicos de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-331">A typical solution for sharding is to maintain a map that can be used to look up the shard location for specific items of data.</span></span> <span data-ttu-id="0b784-332">Esta asignación puede implementarse en la lógica de particionamiento de la aplicación o mantenerse por el almacén de datos si admite el particionamiento transparente.</span><span class="sxs-lookup"><span data-stu-id="0b784-332">This map can be implemented in the sharding logic of the application, or maintained by the data store if it supports transparent sharding.</span></span>
* <span data-ttu-id="0b784-333">**Cuando se utiliza una estrategia de partición horizontal, considere la posibilidad de reequilibrar periódicamente las particiones**.</span><span class="sxs-lookup"><span data-stu-id="0b784-333">**When using a horizontal partitioning strategy, consider periodically rebalancing the shards**.</span></span> <span data-ttu-id="0b784-334">Esto ayuda a distribuir los datos uniformemente por tamaño y por carga de trabajo para minimizar las zonas excesivamente activas, maximizar el rendimiento de las consultas y evitar las limitaciones de almacenamiento físico.</span><span class="sxs-lookup"><span data-stu-id="0b784-334">This helps distribute the data evenly by size and by workload to minimize hotspots, maximize query performance, and work around physical storage limitations.</span></span> <span data-ttu-id="0b784-335">Sin embargo, esta es una tarea compleja que requiere a menudo el uso de una herramienta personalizada o un proceso.</span><span class="sxs-lookup"><span data-stu-id="0b784-335">However, this is a complex task that often requires the use of a custom tool or process.</span></span>
* <span data-ttu-id="0b784-336">**Si se replica cada partición, se proporciona protección adicional frente a errores**.</span><span class="sxs-lookup"><span data-stu-id="0b784-336">**If you replicate each partition, it provides additional protection against failure**.</span></span> <span data-ttu-id="0b784-337">Si se produce un error en una única réplica, las consultas se pueden dirigir hacia una copia de trabajo.</span><span class="sxs-lookup"><span data-stu-id="0b784-337">If a single replica fails, queries can be directed towards a working copy.</span></span>
* <span data-ttu-id="0b784-338">**Si se alcanzan los límites físicos de una estrategia de creación de particiones, es posible que necesite ampliar la escalabilidad a un nivel diferente**.</span><span class="sxs-lookup"><span data-stu-id="0b784-338">**If you reach the physical limits of a partitioning strategy, you might need to extend the scalability to a different level**.</span></span> <span data-ttu-id="0b784-339">Por ejemplo, si la creación de particiones se produce en el nivel de base de datos, puede que tenga que buscar o replicar las particiones en varias bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-339">For example, if partitioning is at the database level, you might need to locate or replicate partitions in multiple databases.</span></span> <span data-ttu-id="0b784-340">Si la creación de particiones ya está al nivel de la base de datos y las limitaciones físicas son un problema, quizá tenga que ubicar o replicar particiones en varias cuentas de hospedaje.</span><span class="sxs-lookup"><span data-stu-id="0b784-340">If partitioning is already at the database level, and physical limitations are an issue, it might mean that you need to locate or replicate partitions in multiple hosting accounts.</span></span>
* <span data-ttu-id="0b784-341">**Evite las transacciones que accedan a datos en varias particiones**.</span><span class="sxs-lookup"><span data-stu-id="0b784-341">**Avoid transactions that access data in multiple partitions**.</span></span> <span data-ttu-id="0b784-342">Algunos almacenes de datos implementan la coherencia transaccional y la integridad de las operaciones que modifican datos, pero solo cuando los datos se encuentran en una sola partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-342">Some data stores implement transactional consistency and integrity for operations that modify data, but only when the data is located in a single partition.</span></span> <span data-ttu-id="0b784-343">Si necesita compatibilidad transaccional en varias particiones, probablemente necesitará implementar esto como parte de la lógica de la aplicación, porque la mayoría de los sistemas de creación de particiones no proporcionan compatibilidad nativa.</span><span class="sxs-lookup"><span data-stu-id="0b784-343">If you need transactional support across multiple partitions, you will probably need to implement this as part of your application logic because most partitioning systems do not provide native support.</span></span>

<span data-ttu-id="0b784-344">Todos los almacenes de datos requieren algunas operaciones de administración operativa y de supervisión de las actividades.</span><span class="sxs-lookup"><span data-stu-id="0b784-344">All data stores require some operational management and monitoring activity.</span></span> <span data-ttu-id="0b784-345">Las tareas pueden oscilar entre la carga de datos, la realización de copias de seguridad y la restauración de datos, la reorganización de datos y asegurarse de que el sistema funciona de manera correcta y eficaz.</span><span class="sxs-lookup"><span data-stu-id="0b784-345">The tasks can range from loading data, backing up and restoring data, reorganizing data, and ensuring that the system is performing correctly and efficiently.</span></span>

<span data-ttu-id="0b784-346">Tenga en cuenta los siguientes factores que afectan a la administración operativa:</span><span class="sxs-lookup"><span data-stu-id="0b784-346">Consider the following factors that affect operational management:</span></span>

* <span data-ttu-id="0b784-347">**Cómo implementar las tareas operativas y de administración adecuadas cuando se crean particiones en los datos**.</span><span class="sxs-lookup"><span data-stu-id="0b784-347">**How to implement appropriate management and operational tasks when the data is partitioned**.</span></span> <span data-ttu-id="0b784-348">Estas tareas pueden incluir la realización de copias de seguridad y su restauración, el archivado de datos, la supervisión del sistema y otras tareas administrativas.</span><span class="sxs-lookup"><span data-stu-id="0b784-348">These tasks might include backup and restore, archiving data, monitoring the system, and other administrative tasks.</span></span> <span data-ttu-id="0b784-349">Por ejemplo, mantener la coherencia lógica durante las operaciones de copia de seguridad y restauración puede ser un desafío.</span><span class="sxs-lookup"><span data-stu-id="0b784-349">For example, maintaining logical consistency during backup and restore operations can be a challenge.</span></span>
* <span data-ttu-id="0b784-350">**Cómo cargar los datos en varias particiones y agregar datos nuevos que llegan desde otros orígenes**.</span><span class="sxs-lookup"><span data-stu-id="0b784-350">**How to load the data into multiple partitions and add new data that's arriving from other sources**.</span></span> <span data-ttu-id="0b784-351">Algunas herramientas y utilidades podrían no admitir operaciones de datos con particiones, como la carga de datos en la partición correcta.</span><span class="sxs-lookup"><span data-stu-id="0b784-351">Some tools and utilities might not support sharded data operations such as loading data into the correct partition.</span></span> <span data-ttu-id="0b784-352">Esto implica que es posible que deba crear u obtener nuevas herramientas y utilidades.</span><span class="sxs-lookup"><span data-stu-id="0b784-352">This means that you might have to create or obtain new tools and utilities.</span></span>
* <span data-ttu-id="0b784-353">**Cómo archivar y eliminar los datos de forma periódica**.</span><span class="sxs-lookup"><span data-stu-id="0b784-353">**How to archive and delete the data on a regular basis**.</span></span> <span data-ttu-id="0b784-354">Para evitar un aumento excesivo de las particiones, debe archivar y eliminar datos de forma regular (quizás mensualmente).</span><span class="sxs-lookup"><span data-stu-id="0b784-354">To prevent the excessive growth of partitions, you need to archive and delete data on a regular basis (perhaps monthly).</span></span> <span data-ttu-id="0b784-355">Puede ser necesario transformar los datos para que se adapten a un esquema de almacenamiento diferente.</span><span class="sxs-lookup"><span data-stu-id="0b784-355">It might be necessary to transform the data to match a different archive schema.</span></span>
* <span data-ttu-id="0b784-356">**Cómo localizar problemas de integridad de datos**.</span><span class="sxs-lookup"><span data-stu-id="0b784-356">**How to locate data integrity issues**.</span></span> <span data-ttu-id="0b784-357">Considere la posibilidad de ejecutar un proceso periódico para localizar cualquier problema de integridad de datos; por ejemplo, la existencia de datos en una partición que hacen referencia a una información que falta en otra.</span><span class="sxs-lookup"><span data-stu-id="0b784-357">Consider running a periodic process to locate any data integrity issues such as data in one partition that references missing information in another.</span></span> <span data-ttu-id="0b784-358">El proceso podría intentar corregir estos problemas automáticamente o generar una alerta a un operador para corregirlos manualmente.</span><span class="sxs-lookup"><span data-stu-id="0b784-358">The process can either attempt to fix these issues automatically or raise an alert to an operator to correct the problems manually.</span></span> <span data-ttu-id="0b784-359">Por ejemplo, en una aplicación de comercio electrónico, es posible que se mantenga la información de los pedidos en una partición pero que los artículos de la línea que componen cada pedido se encuentren en la otra.</span><span class="sxs-lookup"><span data-stu-id="0b784-359">For example, in an e-commerce application, order information might be held in one partition but the line items that constitute each order might be held in another.</span></span> <span data-ttu-id="0b784-360">El proceso de realización de pedidos requiere la adición de datos a ambas particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-360">The process of placing an order needs to add data to other partitions.</span></span> <span data-ttu-id="0b784-361">Si este proceso da error, podría haber elementos de línea almacenados para los que no haya ningún pedido correspondiente.</span><span class="sxs-lookup"><span data-stu-id="0b784-361">If this process fails, there might be line items stored for which there is no corresponding order.</span></span>

<span data-ttu-id="0b784-362">Las tecnologías de almacenamiento de datos diferentes suelen proporcionan sus propias características para admitir la creación de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-362">Different data storage technologies typically provide their own features to support partitioning.</span></span> <span data-ttu-id="0b784-363">Las siguientes secciones resumen las opciones que se implementan por los almacenes de datos usados habitualmente por las aplicaciones de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-363">The following sections summarize the options that are implemented by data stores commonly used by Azure applications.</span></span> <span data-ttu-id="0b784-364">También se describen aspectos que debe tener en cuenta para diseñar aplicaciones que puedan aprovechar al máximo estas características.</span><span class="sxs-lookup"><span data-stu-id="0b784-364">They also describe considerations for designing applications that can best take advantage of these features.</span></span>

## <a name="partitioning-strategies-for-azure-sql-database"></a><span data-ttu-id="0b784-365">Estrategias de creación de particiones de Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="0b784-365">Partitioning strategies for Azure SQL Database</span></span>
<span data-ttu-id="0b784-366">Azure SQL Database es una base de datos como servicio relacional que se ejecuta en la nube.</span><span class="sxs-lookup"><span data-stu-id="0b784-366">Azure SQL Database is a relational database-as-a-service that runs in the cloud.</span></span> <span data-ttu-id="0b784-367">Se basa en Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0b784-367">It is based on Microsoft SQL Server.</span></span> <span data-ttu-id="0b784-368">Una base de datos relacional divide la información en tablas y cada tabla contiene información sobre entidades como una serie de filas.</span><span class="sxs-lookup"><span data-stu-id="0b784-368">A relational database divides information into tables, and each table holds information about entities as a series of rows.</span></span> <span data-ttu-id="0b784-369">Cada fila contiene columnas que contienen los datos de los campos individuales de una entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-369">Each row contains columns that hold the data for the individual fields of an entity.</span></span> <span data-ttu-id="0b784-370">La página [¿Qué es SQL Database?] del sitio web de Microsoft ofrece documentación detallada sobre la creación y el uso de instancias de SQL Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-370">The page [What is Azure SQL Database?] on the Microsoft website provides detailed documentation about creating and using SQL databases.</span></span>

## <a name="horizontal-partitioning-with-elastic-database"></a><span data-ttu-id="0b784-371">Particiones horizontales con Elastic Database</span><span class="sxs-lookup"><span data-stu-id="0b784-371">Horizontal partitioning with Elastic Database</span></span>
<span data-ttu-id="0b784-372">Una única base de datos SQL puede contener un volumen de datos limitado.</span><span class="sxs-lookup"><span data-stu-id="0b784-372">A single SQL database has a limit to the volume of data that it can contain.</span></span> <span data-ttu-id="0b784-373">El rendimiento está restringido por factores arquitectónicos y el número de conexiones simultáneas que admite.</span><span class="sxs-lookup"><span data-stu-id="0b784-373">Throughput is constrained by architectural factors and the number of concurrent connections that it supports.</span></span> <span data-ttu-id="0b784-374">La característica Elastic Database de SQL Database admite el escalado horizontal de una base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0b784-374">The Elastic Database feature of SQL Database supports horizontal scaling for a SQL database.</span></span> <span data-ttu-id="0b784-375">Mediante Elastic Database es posible dividir los datos en particiones que se reparten en varias bases de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0b784-375">Using Elastic Database, you can partition your data into shards that are spread across multiple SQL databases.</span></span> <span data-ttu-id="0b784-376">También puede agregar o quitar particiones a medida que crezca y disminuya el volumen de datos que necesita administrar.</span><span class="sxs-lookup"><span data-stu-id="0b784-376">You can also add or remove shards as the volume of data that you need to handle grows and shrinks.</span></span> <span data-ttu-id="0b784-377">El uso de Elastic Database también puede ayudar a reducir la contención al distribuir la carga entre las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-377">Using Elastic Database can also help reduce contention by distributing the load across databases.</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-378">Elastic Database es un sustituto de la característica Federaciones de Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-378">Elastic Database is a replacement for the Federations feature of Azure SQL Database.</span></span> <span data-ttu-id="0b784-379">Las instalaciones existentes de federación de SQL Database se pueden migrar a Elastic Database mediante la utilidad de migración de federaciones.</span><span class="sxs-lookup"><span data-stu-id="0b784-379">Existing SQL Database Federation installations can be migrated to Elastic Database by using the Federations migration utility.</span></span> <span data-ttu-id="0b784-380">También puede implementar su propio mecanismo de creación de particiones si su escenario no se presta naturalmente a las características proporcionadas por Elastic Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-380">Alternatively, you can implement your own sharding mechanism if your scenario does not lend itself naturally to the features that are provided by Elastic Database.</span></span>
>
>

<span data-ttu-id="0b784-381">Cada partición se implementa como una base de datos SQL.</span><span class="sxs-lookup"><span data-stu-id="0b784-381">Each shard is implemented as a SQL database.</span></span> <span data-ttu-id="0b784-382">Una partición puede contener más de un conjunto de datos (denominado *shardlet*).</span><span class="sxs-lookup"><span data-stu-id="0b784-382">A shard can hold more than one dataset (referred to as a *shardlet*).</span></span> <span data-ttu-id="0b784-383">Cada base de datos mantiene metadatos que describen los shardlets que contiene.</span><span class="sxs-lookup"><span data-stu-id="0b784-383">Each database maintains metadata that describes the shardlets that it contains.</span></span> <span data-ttu-id="0b784-384">Un shardlet puede ser un único elemento de datos, o puede ser un grupo de elementos que comparte la misma clave de shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-384">A shardlet can be a single data item, or it can be a group of items that share the same shardlet key.</span></span> <span data-ttu-id="0b784-385">Por ejemplo, si va a particionar datos en una aplicación de varios inquilinos, la clave del shardlet podría ser el id. de inquilino y todos los datos de un inquilino determinado se mantendrían como parte del mismo shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-385">For example, if you are sharding data in a multitenant application, the shardlet key can be the tenant ID, and all data for a given tenant can be held as part of the same shardlet.</span></span> <span data-ttu-id="0b784-386">Los datos de otros inquilinos se mantendrían en shardlets diferentes.</span><span class="sxs-lookup"><span data-stu-id="0b784-386">Data for other tenants would be held in different shardlets.</span></span>

<span data-ttu-id="0b784-387">Es responsabilidad del programador asociar un conjunto de datos con una clave de shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-387">It is the programmer's responsibility to associate a dataset with a shardlet key.</span></span> <span data-ttu-id="0b784-388">Una base de datos SQL independiente actúa como administrador global de mapas de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-388">A separate SQL database acts as a global shard map manager.</span></span> <span data-ttu-id="0b784-389">Esta base de datos contiene una lista de todas las particiones y shardlets del sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-389">This database contains a list of all the shards and shardlets in the system.</span></span> <span data-ttu-id="0b784-390">Una aplicación cliente que tiene acceso a datos se conecta primero a la base de datos del administrador global del mapa de particiones para obtener una copia de este (lista de particiones y shardlets) que almacena luego en la caché localmente.</span><span class="sxs-lookup"><span data-stu-id="0b784-390">A client application that accesses data connects first to the global shard map manager database to obtain a copy of the shard map (listing shards and shardlets), which it then caches locally.</span></span>

<span data-ttu-id="0b784-391">A continuación, la aplicación usa esta información para enrutar las solicitudes de datos a la partición apropiada.</span><span class="sxs-lookup"><span data-stu-id="0b784-391">The application then uses this information to route data requests to the appropriate shard.</span></span> <span data-ttu-id="0b784-392">Esta funcionalidad se oculta detrás de una serie de API contenidas en la biblioteca de cliente de Elastic Database de Azure SQL Database, disponible como un paquete NuGet.</span><span class="sxs-lookup"><span data-stu-id="0b784-392">This functionality is hidden behind a series of APIs that are contained in the Azure SQL Database Elastic Database Client Library, which is available as a NuGet package.</span></span> <span data-ttu-id="0b784-393">En la página [Información general de las características de Elastic Database] del sitio web de Microsoft se proporciona una introducción más completa a Elastic Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-393">The page [Elastic Database features overview] on the Microsoft website provides a more comprehensive introduction to Elastic Database.</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-394">Puede replicar la base de datos de administrador global del mapa de particiones para reducir la latencia y mejorar la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-394">You can replicate the global shard map manager database to reduce latency and improve availability.</span></span> <span data-ttu-id="0b784-395">Si implementa la base de datos mediante uno de los planes de tarifa Premium, puede configurar la replicación geográfica activa para copiar continuamente datos a bases de datos de diferentes regiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-395">If you implement the database by using one of the Premium pricing tiers, you can configure active geo-replication to continuously copy data to databases in different regions.</span></span> <span data-ttu-id="0b784-396">Cree una copia de la base de datos en cada región en la que estén basados los usuarios.</span><span class="sxs-lookup"><span data-stu-id="0b784-396">Create a copy of the database in each region in which users are based.</span></span> <span data-ttu-id="0b784-397">A continuación, configure la aplicación para conectarse a esta copia a fin de obtener el mapa de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-397">Then configure your application to connect to this copy to obtain the shard map.</span></span>
>
> <span data-ttu-id="0b784-398">Un enfoque alternativo es usar SQL Data Sync de Azure o una canalización de Azure Data Factory para replicar la base de datos de administrador de mapa de particiones entre regiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-398">An alternative approach is to use Azure SQL Data Sync or an Azure Data Factory pipeline to replicate the shard map manager database across regions.</span></span> <span data-ttu-id="0b784-399">Esta forma de replicación se ejecuta periódicamente y es más adecuada si el mapa de particiones no cambia con frecuencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-399">This form of replication runs periodically and is more suitable if the shard map changes infrequently.</span></span> <span data-ttu-id="0b784-400">Además, la base de datos del administrador del mapa de particiones no debe crearse con un plan de tarifa Premium.</span><span class="sxs-lookup"><span data-stu-id="0b784-400">Additionally, the shard map manager database does not have to be created by using a Premium pricing tier.</span></span>
>
>

<span data-ttu-id="0b784-401">Elastic Database proporciona dos esquemas para asignar datos a shardlets y para almacenarlos en particiones:</span><span class="sxs-lookup"><span data-stu-id="0b784-401">Elastic Database provides two schemes for mapping data to shardlets and storing them in shards:</span></span>

* <span data-ttu-id="0b784-402">Un **mapa de particiones de lista** describe una asociación entre una clave única y un shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-402">A **list shard map** describes an association between a single key and a shardlet.</span></span> <span data-ttu-id="0b784-403">Por ejemplo, en un sistema de varios inquilinos, los datos de cada inquilino podrían asociarse a una clave única y almacenarse en su propio shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-403">For example, in a multitenant system, the data for each tenant can be associated with a unique key and stored in its own shardlet.</span></span> <span data-ttu-id="0b784-404">Para garantizar la privacidad y el aislamiento (esto es, impedir que un inquilino agote los recursos de almacenamiento de datos disponibles para otros usuarios), cada shardlet puede mantenerse dentro de su propia partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-404">To guarantee privacy and isolation (that is, to prevent one tenant from exhausting the data storage resources available to others), each shardlet can be held within its own shard.</span></span>

![Uso de un mapa de particiones de lista para almacenar datos de inquilino en particiones independientes](./images/data-partitioning/PointShardlet.png)

<span data-ttu-id="0b784-406">*Ilustración 4. Uso de un mapa de particiones de lista para almacenar datos de inquilino en particiones independientes*</span><span class="sxs-lookup"><span data-stu-id="0b784-406">*Figure 4. Using a list shard map to store tenant data in separate shards*</span></span>

* <span data-ttu-id="0b784-407">Un **mapa de particiones de intervalo** describe una asociación entre un conjunto de valores de claves contiguos y un shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-407">A **range shard map** describes an association between a set of contiguous key values and a shardlet.</span></span> <span data-ttu-id="0b784-408">En el ejemplo de varios inquilinos que se ha descrito anteriormente, una alternativa a la implementación de shardlets específicos podría ser agrupar los datos de un conjunto de inquilinos (cada uno con su propia clave) en el mismo shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-408">In the multitenant example described previously, as an alternative to implementing dedicated shardlets, you can group the data for a set of tenants (each with their own key) within the same shardlet.</span></span> <span data-ttu-id="0b784-409">Este esquema es menos costoso que el primero (los inquilinos comparten los recursos de almacenamiento de datos), pero con riesgo de reducir el aislamiento y la privacidad de los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-409">This scheme is less expensive than the first (because tenants share data storage resources), but it also creates a risk of reduced data privacy and isolation.</span></span>

![Uso de un mapa de particiones de intervalo para almacenar los datos de un intervalo de inquilinos de una partición](./images/data-partitioning/RangeShardlet.png)

<span data-ttu-id="0b784-411">*Ilustración 5. Uso de un mapa de particiones de intervalo para almacenar los datos de un intervalo de inquilinos de una partición*</span><span class="sxs-lookup"><span data-stu-id="0b784-411">*Figure 5. Using a range shard map to store data for a range of tenants in a shard*</span></span>

<span data-ttu-id="0b784-412">Tenga en cuenta que una sola partición puede contener los datos de varios shardlets.</span><span class="sxs-lookup"><span data-stu-id="0b784-412">Note that a single shard can contain the data for several shardlets.</span></span> <span data-ttu-id="0b784-413">Por ejemplo, puede utilizar shardlets de lista para almacenar datos de varios inquilinos no contiguos en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-413">For example, you can use list shardlets to store data for different non-contiguous tenants in the same shard.</span></span> <span data-ttu-id="0b784-414">También puede mezclar shardlets de intervalo y de lista en la misma partición, aunque se tratarán a través de diferentes mapas en la base de datos de administrador global del mapa de particiones</span><span class="sxs-lookup"><span data-stu-id="0b784-414">You can also mix range shardlets and list shardlets in the same shard, although they will be addressed through different maps in the global shard map manager database.</span></span> <span data-ttu-id="0b784-415">(la base de datos de administrador global del mapa de particiones puede contener varios mapas de particiones). En la Figura 6 se describe este enfoque.</span><span class="sxs-lookup"><span data-stu-id="0b784-415">(The global shard map manager database can contain multiple shard maps.) Figure 6 depicts this approach.</span></span>

![Implementación de varios mapas de particiones](./images/data-partitioning/MultipleShardMaps.png)

<span data-ttu-id="0b784-417">*Ilustración 6. Implementación de varios mapas de particiones*</span><span class="sxs-lookup"><span data-stu-id="0b784-417">*Figure 6. Implementing multiple shard maps*</span></span>

<span data-ttu-id="0b784-418">El esquema de partición que se implementa puede tener una incidencia significativa en el rendimiento del sistema.</span><span class="sxs-lookup"><span data-stu-id="0b784-418">The partitioning scheme that you implement can have a significant bearing on the performance of your system.</span></span> <span data-ttu-id="0b784-419">También puede afectar a la frecuencia con que deben agregarse o quitarse particiones, o con que se deben volver a particionar los datos entre las diferentes particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-419">It can also affect the rate at which shards have to be added or removed, or the rate at which data must be repartitioned across shards.</span></span> <span data-ttu-id="0b784-420">Al utilizar Elastic Database para particionar los datos, tenga en cuenta los aspectos siguientes:</span><span class="sxs-lookup"><span data-stu-id="0b784-420">Consider the following points when you use Elastic Database to partition data:</span></span>

* <span data-ttu-id="0b784-421">Agrupe los datos que se utilizan conjuntamente en la misma partición y evite las operaciones que necesitan tener acceso a los datos almacenados en varias particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-421">Group data that is used together in the same shard, and avoid operations that need to access data that's held in multiple shards.</span></span> <span data-ttu-id="0b784-422">Tenga en cuenta que, con Elastic Database, una partición es una base de datos SQL por derecho propio, y Azure SQL Database no admite combinaciones entre bases de datos (que tienen que realizarse en el cliente).</span><span class="sxs-lookup"><span data-stu-id="0b784-422">Keep in mind that with Elastic Database, a shard is a SQL database in its own right, and Azure SQL Database does not support cross-database joins (which have to be performed on the client side).</span></span> <span data-ttu-id="0b784-423">Recuerde también que en Azure SQL Database, las restricciones de integridad referencial, los desencadenadores y los procedimientos almacenados de una base de datos no pueden hacer referencia a objetos de otra.</span><span class="sxs-lookup"><span data-stu-id="0b784-423">Remember also that in Azure SQL Database, referential integrity constraints, triggers, and stored procedures in one database cannot reference objects in another.</span></span> <span data-ttu-id="0b784-424">Por tanto, no diseñe un sistema que tenga dependencias entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-424">Therefore, don't design a system that has dependencies between shards.</span></span> <span data-ttu-id="0b784-425">No obstante, una Base de datos SQL sí puede contener tablas que conservan copias de datos de referencia utilizados con frecuencia por consultas y otras operaciones.</span><span class="sxs-lookup"><span data-stu-id="0b784-425">A SQL database can, however, contain tables that hold copies of reference data frequently used by queries and other operations.</span></span> <span data-ttu-id="0b784-426">No es necesario que estas tablas pertenezcan a un shardlet específico.</span><span class="sxs-lookup"><span data-stu-id="0b784-426">These tables do not have to belong to any specific shardlet.</span></span> <span data-ttu-id="0b784-427">Si replica estos datos entre particiones, la combinación de datos que se encuentren en varias bases de datos puede dejar de ser necesaria.</span><span class="sxs-lookup"><span data-stu-id="0b784-427">Replicating this data across shards can help remove the need to join data that spans databases.</span></span> <span data-ttu-id="0b784-428">Lo ideal es que dichos datos sean estáticos o lentos para minimizar el esfuerzo de replicación y reducir las posibilidades de que se vuelvan obsoletos.</span><span class="sxs-lookup"><span data-stu-id="0b784-428">Ideally, such data should be static or slow-moving to minimize the replication effort and reduce the chances of it becoming stale.</span></span>

  > [!NOTE]
  > <span data-ttu-id="0b784-429">Aunque SQL Database no admite combinaciones entre bases de datos, puede realizar consultas entre particiones con la API de Elastic Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-429">Although SQL Database does not support cross-database joins, you can perform cross-shard queries with the Elastic Database API.</span></span> <span data-ttu-id="0b784-430">Estas consultas pueden recorrer de forma transparente los datos contenidos en todos los shardlets a los que se hace referencia en un mapa de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-430">These queries can transparently iterate through the data held in all the shardlets that are referenced by a shard map.</span></span> <span data-ttu-id="0b784-431">La API de Elastic Database divide las consultas efectuadas entre particiones en una serie de consultas individuales (una para cada base de datos) y luego combina los resultados.</span><span class="sxs-lookup"><span data-stu-id="0b784-431">The Elastic Database API breaks cross-shard queries down into a series of individual queries (one for each database) and then merges the results.</span></span> <span data-ttu-id="0b784-432">Para más información, consulte la página [Consultas a través de particiones múltiples] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-432">For more information, see the page [Multi-shard querying] on the Microsoft website.</span></span>
  >
  >
* <span data-ttu-id="0b784-433">Los datos almacenados en shardlets que pertenecen al mismo mapa de partición deben tener el mismo esquema.</span><span class="sxs-lookup"><span data-stu-id="0b784-433">The data stored in shardlets that belong to the same shard map should have the same schema.</span></span> <span data-ttu-id="0b784-434">Por ejemplo, no cree un mapa de particiones de lista que esté orientado a algunos shardlet que contengan datos del inquilino y otros shardlets que contengan información del producto.</span><span class="sxs-lookup"><span data-stu-id="0b784-434">For example, don't create a list shard map that points to some shardlets containing tenant data and other shardlets containing product information.</span></span> <span data-ttu-id="0b784-435">Esta regla no se aplica mediante Elastic Database, pero la administración y la consulta de datos se vuelven muy complejas si cada shardlet tiene un esquema diferente.</span><span class="sxs-lookup"><span data-stu-id="0b784-435">This rule is not enforced by Elastic Database, but data management and querying becomes very complex if each shardlet has a different schema.</span></span> <span data-ttu-id="0b784-436">En el ejemplo anteriormente citado, una buena solución es crear dos mapas de particiones de lista: uno que haga referencia a los datos de inquilinos y otro que señale a la información del producto.</span><span class="sxs-lookup"><span data-stu-id="0b784-436">In the example just cited, a good solution is to create two list shard maps: one that references tenant data and another that points to product information.</span></span> <span data-ttu-id="0b784-437">Recuerde que los datos que pertenecen a diferentes shardlets pueden almacenarse en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-437">Remember that the data belonging to different shardlets can be stored in the same shard.</span></span>

  > [!NOTE]
  > <span data-ttu-id="0b784-438">La funcionalidad de consulta entre particiones de la API de Elastic Database depende de cada shardlet en el mapa de particiones que contiene el mismo esquema.</span><span class="sxs-lookup"><span data-stu-id="0b784-438">The cross-shard query functionality of the Elastic Database API depends on each shardlet in the shard map containing the same schema.</span></span>
  >
  >
* <span data-ttu-id="0b784-439">Las operaciones transaccionales solamente se admiten para datos contenidos dentro de la misma partición y no entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-439">Transactional operations are only supported for data that's held within the same shard, and not across shards.</span></span> <span data-ttu-id="0b784-440">Las transacciones pueden abarcar shardlets siempre que formen parte de la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-440">Transactions can span shardlets as long as they are part of the same shard.</span></span> <span data-ttu-id="0b784-441">Por lo tanto, si la lógica de negocios debe realizar transacciones, almacene los datos afectados en la misma partición o implemente la coherencia eventual.</span><span class="sxs-lookup"><span data-stu-id="0b784-441">Therefore, if your business logic needs to perform transactions, either store the affected data in the same shard or implement eventual consistency.</span></span> <span data-ttu-id="0b784-442">Para más información, consulte [Data consistency primer](Información básica sobre la coherencia de datos).</span><span class="sxs-lookup"><span data-stu-id="0b784-442">For more information, see the [Data consistency primer].</span></span>
* <span data-ttu-id="0b784-443">Coloque las particiones cerca de los usuarios que tienen acceso a los datos de esas particiones (en otras palabras, ubique geográficamente las particiones).</span><span class="sxs-lookup"><span data-stu-id="0b784-443">Place shards close to the users that access the data in those shards (in other words, geo-locate the shards).</span></span> <span data-ttu-id="0b784-444">Esta estrategia ayuda a reducir la latencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-444">This strategy helps reduce latency.</span></span>
* <span data-ttu-id="0b784-445">Evite tener una mezcla de particiones muy activas (zonas activas) y relativamente inactivas.</span><span class="sxs-lookup"><span data-stu-id="0b784-445">Avoid having a mixture of highly active (hotspots) and relatively inactive shards.</span></span> <span data-ttu-id="0b784-446">Pruebe a distribuir la carga uniformemente entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-446">Try to spread the load evenly across shards.</span></span> <span data-ttu-id="0b784-447">Esto puede requerir la aplicación de algoritmos hash a las claves de shardlet.</span><span class="sxs-lookup"><span data-stu-id="0b784-447">This might require hashing the shardlet keys.</span></span>
* <span data-ttu-id="0b784-448">Si está geolocalizando las particiones, asegúrese de que las claves hash se asignan a shardlets de particiones almacenadas cerca de los usuarios que tienen acceso a esos datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-448">If you are geo-locating shards, make sure that the hashed keys map to shardlets held in shards stored close to the users that access that data.</span></span>
* <span data-ttu-id="0b784-449">Actualmente, solo se admite un conjunto limitado de tipos de datos SQL como claves de shardlet; *int, bigint, varbinary,* y *uniqueidentifier*.</span><span class="sxs-lookup"><span data-stu-id="0b784-449">Currently, only a limited set of SQL data types are supported as shardlet keys; *int, bigint, varbinary,* and *uniqueidentifier*.</span></span> <span data-ttu-id="0b784-450">Los tipos *int* y *bigint* de SQL se corresponden a los tipos de datos *int* y *long* en C#, y tienen los mismos intervalos.</span><span class="sxs-lookup"><span data-stu-id="0b784-450">The SQL *int* and *bigint* types correspond to the *int* and *long* data types in C#, and have the same ranges.</span></span> <span data-ttu-id="0b784-451">El tipo *varbinary* de SQL puede controlarse mediante el uso de una matriz *Byte* en C# y el tipo *uniqueidentier* de SQL se corresponde con la clase *Guid* de .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="0b784-451">The SQL *varbinary* type can be handled by using a *Byte* array in C#, and the SQL *uniqueidentier* type corresponds to the *Guid* class in the .NET Framework.</span></span>

<span data-ttu-id="0b784-452">Como su nombre implica, Elastic Database permite que un sistema agregue y quite particiones a medida que el volumen de datos disminuye y crece.</span><span class="sxs-lookup"><span data-stu-id="0b784-452">As the name implies, Elastic Database makes it possible for a system to add and remove shards as the volume of data shrinks and grows.</span></span> <span data-ttu-id="0b784-453">Las API de la biblioteca de cliente de Elastic Database de Azure SQL Database permiten a una aplicación crear y eliminar particiones de forma dinámica (y actualizar el administrador del mapa de la particiones de forma transparente);</span><span class="sxs-lookup"><span data-stu-id="0b784-453">The APIs in the Azure SQL Database Elastic Database client library enable an application to create and delete shards dynamically (and transparently update the shard map manager).</span></span> <span data-ttu-id="0b784-454">sin embargo, eliminar una partición es una operación destructiva que también requiere la eliminación de todos los datos de esa partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-454">However, removing a shard is a destructive operation that also requires deleting all the data in that shard.</span></span>

<span data-ttu-id="0b784-455">Si una aplicación necesita dividir una partición en dos particiones independientes o combinar particiones, Elastic Database proporciona un servicio independiente de división y combinación.</span><span class="sxs-lookup"><span data-stu-id="0b784-455">If an application needs to split a shard into two separate shards or combine shards, Elastic Database provides a separate split-merge service.</span></span> <span data-ttu-id="0b784-456">Este servicio se ejecuta en un servicio hospedado en la nube (que debe crearse el desarrollador) y migra los datos de forma segura entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-456">This service runs in a cloud-hosted service (which must be created by the developer) and migrates data safely between shards.</span></span> <span data-ttu-id="0b784-457">Para más información, consulte el tema [Escalado con la herramienta de división y combinación de bases de datos elásticas] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-457">For more information, see the topic [Scaling using the Elastic Database split-merge tool] on the Microsoft website.</span></span>

## <a name="partitioning-strategies-for-azure-storage"></a><span data-ttu-id="0b784-458">Estrategias de creación de particiones para Azure Storage</span><span class="sxs-lookup"><span data-stu-id="0b784-458">Partitioning strategies for Azure Storage</span></span>
<span data-ttu-id="0b784-459">Azure Storage proporciona cuatro abstracciones para administrar los datos:</span><span class="sxs-lookup"><span data-stu-id="0b784-459">Azure storage provides four abstractions for managing data:</span></span>

* <span data-ttu-id="0b784-460">Blob Storage almacena datos de objetos no estructurados.</span><span class="sxs-lookup"><span data-stu-id="0b784-460">Blob Storage stores unstructured object data.</span></span> <span data-ttu-id="0b784-461">Un blob puede ser un tipo cualquiera de datos binarios o texto, como un documento, un archivo multimedia o un instalador de aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-461">A blob can be any type of text or binary data, such as a document, media file, or application installer.</span></span> <span data-ttu-id="0b784-462">El almacenamiento de blobs a veces se conoce también como almacenamiento de objetos.</span><span class="sxs-lookup"><span data-stu-id="0b784-462">Blob storage is also referred to as Object storage.</span></span>
* <span data-ttu-id="0b784-463">Table Storage almacena conjuntos de datos estructurados.</span><span class="sxs-lookup"><span data-stu-id="0b784-463">Table Storage stores structured datasets.</span></span> <span data-ttu-id="0b784-464">Se trata de un almacén de datos de clave-atributo NoSQL, que permite el desarrollo rápido de grandes cantidades de datos y el acceso inmediato a los mismos.</span><span class="sxs-lookup"><span data-stu-id="0b784-464">Table storage is a NoSQL key-attribute data store, which allows for rapid development and fast access to large quantities of data.</span></span>
* <span data-ttu-id="0b784-465">Queue Storage ofrece una solución de mensajería confiable para el procesamiento de flujos de trabajo y para la comunicación entre los componentes de los servicios en la nube.</span><span class="sxs-lookup"><span data-stu-id="0b784-465">Queue Storage provides reliable messaging for workflow processing and for communication between components of cloud services.</span></span>
* <span data-ttu-id="0b784-466">File Storage ofrece almacenamiento compartido para aplicaciones heredadas que usan el protocolo SMB estándar.</span><span class="sxs-lookup"><span data-stu-id="0b784-466">File Storage offers shared storage for legacy applications using the standard SMB protocol.</span></span> <span data-ttu-id="0b784-467">Las máquinas virtuales y los servicios en la nube de Azure pueden compartir datos de archivos entre componentes de aplicaciones a través de recursos compartidos montados, y las aplicaciones locales pueden tener acceso a datos de archivos de un recurso compartido a través de la API REST del servicio Archivo.</span><span class="sxs-lookup"><span data-stu-id="0b784-467">Azure virtual machines and cloud services can share file data across application components via mounted shares, and on-premises applications can access file data in a share via the File service REST API.</span></span>

<span data-ttu-id="0b784-468">Almacenamiento de tablas y Almacenamiento de blobs son esencialmente almacenes de clave-valor optimizados para almacenar datos estructurados y no estructurados, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-468">Table storage and blob storage are essentially key-value stores that are optimized to hold structured and unstructured data respectively.</span></span> <span data-ttu-id="0b784-469">Las Colas de almacenamiento proporcionan un mecanismo para crear aplicaciones de acoplamiento flexible y escalables.</span><span class="sxs-lookup"><span data-stu-id="0b784-469">Storage queues provide a mechanism for building loosely coupled, scalable applications.</span></span> <span data-ttu-id="0b784-470">Table Storage, File Storage, Blob Storage y Queue Storage se crean dentro del contexto de una cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-470">Table storage, file storage, blob storage, and storage queues are created within the context of an Azure storage account.</span></span> <span data-ttu-id="0b784-471">Las cuentas de Azure Storage admiten tres formas de redundancia:</span><span class="sxs-lookup"><span data-stu-id="0b784-471">Storage accounts support three forms of redundancy:</span></span>

* <span data-ttu-id="0b784-472">**Almacenamiento con redundancia local**, que mantiene tres copias de datos dentro de un único centro de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-472">**Locally redundant storage**, which maintains three copies of data within a single datacenter.</span></span> <span data-ttu-id="0b784-473">Esta forma de redundancia protege contra fallos de hardware, pero no frente a un desastre que abarca todo el centro de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-473">This form of redundancy protects against hardware failure but not against a disaster that encompasses the entire datacenter.</span></span>
* <span data-ttu-id="0b784-474">**Almacenamiento con redundancia de zona**, que mantiene tres copias de los datos repartidas entre diferentes centros de datos de la misma región (o entre dos regiones cercanas geográficamente).</span><span class="sxs-lookup"><span data-stu-id="0b784-474">**Zone-redundant storage**, which maintains three copies of data spread across different datacenters within the same region (or across two geographically close regions).</span></span> <span data-ttu-id="0b784-475">Esta forma de redundancia puede proteger frente a desastres que se producen dentro de un único centro de datos, pero no puede proteger frente a las desconexiones de red a gran escala que afectan a toda una región.</span><span class="sxs-lookup"><span data-stu-id="0b784-475">This form of redundancy can protect against disasters that occur within a single datacenter, but cannot protect against large-scale network disconnects that affect an entire region.</span></span> <span data-ttu-id="0b784-476">Tenga en cuenta que el almacenamiento con redundancia de zona solo está disponible para blobs en bloques.</span><span class="sxs-lookup"><span data-stu-id="0b784-476">Note that zone-redundant storage is currently only available for block blobs.</span></span>
* <span data-ttu-id="0b784-477">**Almacenamiento con redundancia geográfica**, que mantiene seis copias de datos: tres copias en una región (su región local) y otras tres copias en una región remota.</span><span class="sxs-lookup"><span data-stu-id="0b784-477">**Geo-redundant storage**, which maintains six copies of data: three copies in one region (your local region), and another three copies in a remote region.</span></span> <span data-ttu-id="0b784-478">Esta forma de redundancia proporciona el máximo nivel de protección ante desastres.</span><span class="sxs-lookup"><span data-stu-id="0b784-478">This form of redundancy provides the highest level of disaster protection.</span></span>

<span data-ttu-id="0b784-479">Microsoft ha publicado los objetivos de escalabilidad para Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="0b784-479">Microsoft has published scalability targets for Azure Storage.</span></span> <span data-ttu-id="0b784-480">Para más información, consulte la página [Azure Storage scalability and performance targets] (Acceso a datos para soluciones altamente escalables: uso de SQL, NoSQL y persistencia políglota) en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-480">For more information, see the page [Azure Storage scalability and performance targets] on the Microsoft website.</span></span> <span data-ttu-id="0b784-481">Actualmente, la capacidad total de la cuenta de almacenamiento no puede superar los 500 TB</span><span class="sxs-lookup"><span data-stu-id="0b784-481">Currently, the total storage account capacity cannot exceed 500 TB.</span></span> <span data-ttu-id="0b784-482">(esto incluye el tamaño de los datos que se mantienen en Tabler Storage, File Storage y Blob Storage, así como los mensajes pendientes que se encuentran en la cola de almacenamiento).</span><span class="sxs-lookup"><span data-stu-id="0b784-482">(This includes the size of data that's held in table storage, file storage and blob storage, as well as outstanding messages that are held in storage queue).</span></span>

<span data-ttu-id="0b784-483">La tasa de solicitud máxima para una cuenta de almacenamiento (suponiendo un tamaño de entidad, blob o mensaje de 1 KB) es de 20 000 solicitudes por segundo.</span><span class="sxs-lookup"><span data-stu-id="0b784-483">The maximum request rate for a storage account (assuming a 1-KB entity, blob, or message size) is 20,000 requests per second.</span></span> <span data-ttu-id="0b784-484">Una cuenta de almacenamiento tiene un IOPS máximo de 1000 (8 KB de tamaño) por recurso compartido de archivos.</span><span class="sxs-lookup"><span data-stu-id="0b784-484">A storage account has a maximum of 1000 IOPS (8 KB in size) per file share.</span></span> <span data-ttu-id="0b784-485">Si es probable que su sistema supere estos límites, considere la posibilidad de crear particiones en la carga entre varias cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-485">If your system is likely to exceed these limits, consider partitioning the load across multiple storage accounts.</span></span> <span data-ttu-id="0b784-486">Una sola suscripción de Azure puede crear hasta 200 cuentas de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-486">A single Azure subscription can create up to 200 storage accounts.</span></span> <span data-ttu-id="0b784-487">Sin embargo, tenga en cuenta que estos límites pueden cambiar con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="0b784-487">However, note that these limits might change over time.</span></span>

## <a name="partitioning-azure-table-storage"></a><span data-ttu-id="0b784-488">Creación de particiones en el almacenamiento de tablas de Azure</span><span class="sxs-lookup"><span data-stu-id="0b784-488">Partitioning Azure table storage</span></span>
<span data-ttu-id="0b784-489">El Almacenamiento de tablas de Azure es un almacén del par clave-valor diseñado en torno a la creación de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-489">Azure table storage is a key-value store that's designed around partitioning.</span></span> <span data-ttu-id="0b784-490">Todas las entidades se almacenan en una partición y las particiones son administradas internamente por el almacenamiento de tablas de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-490">All entities are stored in a partition, and partitions are managed internally by Azure table storage.</span></span> <span data-ttu-id="0b784-491">Cada entidad que se almacena en una tabla debe proporcionar una clave de dos partes que incluye lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="0b784-491">Each entity that's stored in a table must provide a two-part key that includes:</span></span>

* <span data-ttu-id="0b784-492">**La clave de la partición**.</span><span class="sxs-lookup"><span data-stu-id="0b784-492">**The partition key**.</span></span> <span data-ttu-id="0b784-493">Se trata de un valor de cadena que determina en qué partición el Almacenamiento de tablas de Azure colocará la entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-493">This is a string value that determines in which partition Azure table storage will place the entity.</span></span> <span data-ttu-id="0b784-494">Todas las entidades con la misma clave de partición se almacenarán en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-494">All entities with the same partition key will be stored in the same partition.</span></span>
* <span data-ttu-id="0b784-495">**La clave de la fila**.</span><span class="sxs-lookup"><span data-stu-id="0b784-495">**The row key**.</span></span> <span data-ttu-id="0b784-496">Se trata de otro valor de cadena que identifica la entidad dentro de la partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-496">This is another string value that identifies the entity within the partition.</span></span> <span data-ttu-id="0b784-497">Todas las entidades dentro de una partición se ordenan léxicamente, en orden ascendente, por parte de esta clave.</span><span class="sxs-lookup"><span data-stu-id="0b784-497">All entities within a partition are sorted lexically, in ascending order, by this key.</span></span> <span data-ttu-id="0b784-498">La combinación de clave de fila/partición debe ser única para cada entidad y no puede superar 1 KB de longitud.</span><span class="sxs-lookup"><span data-stu-id="0b784-498">The partition key/row key combination must be unique for each entity and cannot exceed 1 KB in length.</span></span>

<span data-ttu-id="0b784-499">El resto de los datos de una entidad se compone de campos definidos por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-499">The remainder of the data for an entity consists of application-defined fields.</span></span> <span data-ttu-id="0b784-500">No se aplica ningún esquema concreto, y cada fila puede contener un conjunto diferente de campos definidos por la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-500">No particular schemas are enforced, and each row can contain a different set of application-defined fields.</span></span> <span data-ttu-id="0b784-501">La única limitación es que el tamaño máximo de una entidad (incluidas las claves de partición y fila) actualmente es de 1 MB.</span><span class="sxs-lookup"><span data-stu-id="0b784-501">The only limitation is that the maximum size of an entity (including the partition and row keys) is currently 1 MB.</span></span> <span data-ttu-id="0b784-502">El tamaño máximo de una tabla es de 200 TB, aunque estas cifras podrían cambiar en el futuro</span><span class="sxs-lookup"><span data-stu-id="0b784-502">The maximum size of a table is 200 TB, although these figures might change in the future.</span></span> <span data-ttu-id="0b784-503">(Consulte la página [Objetivos de escalabilidad y rendimiento de Azure Storage] en el sitio web de Microsoft para conocer la información más reciente sobre estos límites).</span><span class="sxs-lookup"><span data-stu-id="0b784-503">(Check the page [Azure Storage scalability and performance targets] on the Microsoft website for the most recent information about these limits.)</span></span>

<span data-ttu-id="0b784-504">Si intenta almacenar entidades que superen esta capacidad, considere la posibilidad de dividirlas en varias tablas.</span><span class="sxs-lookup"><span data-stu-id="0b784-504">If you are attempting to store entities that exceed this capacity, then consider splitting them into multiple tables.</span></span> <span data-ttu-id="0b784-505">Utilice particiones verticales para dividir los campos en los grupos a los que se vaya a acceder en conjunto con mayor probabilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-505">Use vertical partitioning to divide the fields into the groups that are most likely to be accessed together.</span></span>

<span data-ttu-id="0b784-506">En la ilustración 7 se muestra la estructura lógica de una cuenta de almacenamiento de ejemplo (Contoso Data) para una aplicación de comercio electrónico ficticia.</span><span class="sxs-lookup"><span data-stu-id="0b784-506">Figure 7 shows the logical structure of an example storage account (Contoso Data) for a fictitious e-commerce application.</span></span> <span data-ttu-id="0b784-507">La cuenta de almacenamiento contiene tres tablas: información del cliente, información del producto e información del pedido.</span><span class="sxs-lookup"><span data-stu-id="0b784-507">The storage account contains three tables: Customer Info, Product Info, and Order Info.</span></span> <span data-ttu-id="0b784-508">Cada tabla tiene varias particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-508">Each table has multiple partitions.</span></span>

<span data-ttu-id="0b784-509">En la tabla de información del cliente, se particionan los datos según la ciudad en la que está ubicado el cliente y la clave de fila contiene el identificador de cliente.</span><span class="sxs-lookup"><span data-stu-id="0b784-509">In the Customer Info table, the data is partitioned according to the city in which the customer is located, and the row key contains the customer ID.</span></span> <span data-ttu-id="0b784-510">En la tabla de información del producto, se particionan los productos por categoría de producto y la clave de fila contiene el número de producto.</span><span class="sxs-lookup"><span data-stu-id="0b784-510">In the Product Info table, the products are partitioned by product category, and the row key contains the product number.</span></span> <span data-ttu-id="0b784-511">En la tabla de información del pedido, se particionan los pedidos por la fecha en la que se efectuaron y la clave de fila especifica el momento en el que se ha recibido el pedido.</span><span class="sxs-lookup"><span data-stu-id="0b784-511">In the Order Info table, the orders are partitioned by the date on which they were placed, and the row key specifies the time the order was received.</span></span> <span data-ttu-id="0b784-512">Tenga en cuenta que todos los datos se ordenan por la clave de fila de cada partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-512">Note that all data is ordered by the row key in each partition.</span></span>

![Las tablas y las particiones de una cuenta de almacenamiento de ejemplo](./images/data-partitioning/TableStorage.png)

<span data-ttu-id="0b784-514">*Ilustración 7. Las tablas y las particiones de una cuenta de almacenamiento de ejemplo*</span><span class="sxs-lookup"><span data-stu-id="0b784-514">*Figure 7. The tables and partitions in an example storage account*</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-515">Almacenamiento de tablas de Azure también agrega un campo de marca de tiempo a cada entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-515">Azure table storage also adds a timestamp field to each entity.</span></span> <span data-ttu-id="0b784-516">El campo de marca de tiempo es mantenido por el almacenamiento de tablas y se actualiza cada vez que la entidad se modifica y se escribe de nuevo en una partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-516">The timestamp field is maintained by table storage and is updated each time the entity is modified and written back to a partition.</span></span> <span data-ttu-id="0b784-517">El servicio Almacenamiento de tablas utiliza este campo para implementar simultaneidad optimista</span><span class="sxs-lookup"><span data-stu-id="0b784-517">The table storage service uses this field to implement optimistic concurrency.</span></span> <span data-ttu-id="0b784-518">(cada vez que una aplicación vuelve a escribir una entidad en el almacenamiento de tablas, este servicio compara el valor de la marca de tiempo de la entidad que se está escribiendo con el valor conservado en el almacenamiento de tablas).</span><span class="sxs-lookup"><span data-stu-id="0b784-518">(Each time an application writes an entity back to table storage, the table storage service compares the value of the timestamp in the entity that's being written with the value that's held in table storage.</span></span> <span data-ttu-id="0b784-519">Si los valores son distintos, otra aplicación debe haber modificado la entidad desde que se recuperó por última vez y se produce un error en la operación de escritura.</span><span class="sxs-lookup"><span data-stu-id="0b784-519">If the values are different, it means that another application must have modified the entity since it was last retrieved, and the write operation fails.</span></span> <span data-ttu-id="0b784-520">No modifique este campo en su propio código y no especifique un valor para este campo cuando se cree una nueva entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-520">Don't modify this field in your own code, and don't specify a value for this field when you create a new entity.</span></span>
>
>

<span data-ttu-id="0b784-521">Almacenamiento de tablas de Azure usa la clave de partición para determinar cómo almacenar los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-521">Azure table storage uses the partition key to determine how to store the data.</span></span> <span data-ttu-id="0b784-522">Si se agrega una entidad a una tabla con una clave de partición no usada anteriormente, Almacenamiento de tablas de Azure crea una nueva partición para esta entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-522">If an entity is added to a table with a previously unused partition key, Azure table storage creates a new partition for this entity.</span></span> <span data-ttu-id="0b784-523">Otras entidades con la misma clave de partición se almacenarán en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-523">Other entities with the same partition key will be stored in the same partition.</span></span>

<span data-ttu-id="0b784-524">Este mecanismo implementa de forma efectiva una estrategia de escalado automático.</span><span class="sxs-lookup"><span data-stu-id="0b784-524">This mechanism effectively implements an automatic scale-out strategy.</span></span> <span data-ttu-id="0b784-525">Cada partición se almacena en un servidor único en un centro de datos de Azure para ayudar a garantizar que las consultas que recuperan datos de una sola partición se ejecutan rápidamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-525">Each partition is stored on a single server in an Azure datacenter to help ensure that queries that retrieve data from a single partition run quickly.</span></span> <span data-ttu-id="0b784-526">Sin embargo, las distintas particiones pueden distribuirse entre varios servidores.</span><span class="sxs-lookup"><span data-stu-id="0b784-526">However, different partitions can be distributed across multiple servers.</span></span> <span data-ttu-id="0b784-527">Además, un único servidor puede alojar varias particiones si estas particiones tienen un tamaño limitado.</span><span class="sxs-lookup"><span data-stu-id="0b784-527">Additionally, a single server can host multiple partitions if these partitions are limited in size.</span></span>

<span data-ttu-id="0b784-528">Considere los siguientes puntos cuando diseñe las entidades para el almacenamiento de tablas de Azure:</span><span class="sxs-lookup"><span data-stu-id="0b784-528">Consider the following points when you design your entities for Azure table storage:</span></span>

* <span data-ttu-id="0b784-529">La selección de valores de claves de fila y de partición debe basarse en la forma en que la que se accede a los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-529">The selection of partition key and row key values should be driven by the way in which the data is accessed.</span></span> <span data-ttu-id="0b784-530">Elija una combinación de claves de partición y fila que admita la mayoría de las consultas.</span><span class="sxs-lookup"><span data-stu-id="0b784-530">Choose a partition key/row key combination that supports the majority of your queries.</span></span> <span data-ttu-id="0b784-531">Las consultas más eficaces recuperan los datos especificando la clave de partición y la clave de fila.</span><span class="sxs-lookup"><span data-stu-id="0b784-531">The most efficient queries retrieve data by specifying the partition key and the row key.</span></span> <span data-ttu-id="0b784-532">Las consultas que especifican una clave de partición y un intervalo de claves de fila pueden completarse mediante el análisis de una sola partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-532">Queries that specify a partition key and a range of row keys can be completed by scanning a single partition.</span></span> <span data-ttu-id="0b784-533">Esto es relativamente rápido porque los datos se mantienen en el orden de la clave de fila.</span><span class="sxs-lookup"><span data-stu-id="0b784-533">This is relatively fast because the data is held in row key order.</span></span> <span data-ttu-id="0b784-534">Si las consultas no especifican qué partición se debe analizar, la clave de partición puede requerir que Almacenamiento de tablas de Azure busque los datos en todas las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-534">If queries don't specify which partition to scan, the partition key might require Azure table storage to scan every partition for your data.</span></span>

  > [!TIP]
  > <span data-ttu-id="0b784-535">Si una entidad tiene una clave natural, a continuación, úsela como clave de partición y especifique una cadena vacía como clave de fila.</span><span class="sxs-lookup"><span data-stu-id="0b784-535">If an entity has one natural key, then use it as the partition key and specify an empty string as the row key.</span></span> <span data-ttu-id="0b784-536">Si una entidad tiene una clave compuesta que incluye dos propiedades, seleccione la propiedad que cambie más despacio como clave de partición y la otra como clave de fila.</span><span class="sxs-lookup"><span data-stu-id="0b784-536">If an entity has a composite key comprising two properties, select the slowest changing property as the partition key and the other as the row key.</span></span> <span data-ttu-id="0b784-537">Si una entidad tiene más de dos propiedades de clave, use una concatenación de propiedades para proporcionar las claves de partición y fila.</span><span class="sxs-lookup"><span data-stu-id="0b784-537">If an entity has more than two key properties, use a concatenation of properties to provide the partition and row keys.</span></span>
  >
  >
* <span data-ttu-id="0b784-538">Si realiza regularmente consultas que buscan datos con campos que no sean las claves de partición y fila, considere la posibilidad de implementar el [patrón de tabla de índice].</span><span class="sxs-lookup"><span data-stu-id="0b784-538">If you regularly perform queries that look up data by using fields other than the partition and row keys, consider implementing the [index table pattern].</span></span>
* <span data-ttu-id="0b784-539">Si se generan claves de partición mediante una secuencia monotónica creciente o decreciente (por ejemplo, "0001", "0002", "0003",...) y cada partición contiene solo una cantidad limitada de datos, es posible que el almacenamiento de tablas de Azure agrupe físicamente estas particiones en el mismo servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-539">If you generate partition keys by using a monotonic increasing or decreasing sequence (such as "0001", "0002", "0003", and so on) and each partition only contains a limited amount of data, then Azure table storage can physically group these partitions together on the same server.</span></span> <span data-ttu-id="0b784-540">Este mecanismo supone que es más probable que la aplicación realice consultas en un intervalo contiguo de particiones (consultas por rango) y está optimizada para este caso.</span><span class="sxs-lookup"><span data-stu-id="0b784-540">This mechanism assumes that the application is most likely to perform queries across a contiguous range of partitions (range queries) and is optimized for this case.</span></span> <span data-ttu-id="0b784-541">Sin embargo, este enfoque puede provocar la aparición de puntos con mucho tráfico centrados en un solo servidor, ya que es probable que todas las inserciones de nuevas entidades se concentren en uno u otro extremo de los intervalos contiguos.</span><span class="sxs-lookup"><span data-stu-id="0b784-541">However, this approach can lead to hotspots focused on a single server because all insertions of new entities are likely to be concentrated at one end or the other of the contiguous ranges.</span></span> <span data-ttu-id="0b784-542">También puede reducir la escalabilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-542">It can also reduce scalability.</span></span> <span data-ttu-id="0b784-543">Para distribuir la carga más uniformemente entre servidores, considere la posibilidad de aplicar un algoritmo hash a la clave de partición para que la secuencia sea más aleatoria.</span><span class="sxs-lookup"><span data-stu-id="0b784-543">To spread the load more evenly across servers, consider hashing the partition key to make the sequence more random.</span></span>
* <span data-ttu-id="0b784-544">El almacenamiento de tablas de Azure admite operaciones transaccionales para entidades que pertenecen a la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-544">Azure table storage supports transactional operations for entities that belong to the same partition.</span></span> <span data-ttu-id="0b784-545">Esto significa que una aplicación puede realizar varias operaciones de inserción, actualización, eliminación, sustitución o combinación como una unidad atómica (siempre que la transacción no incluya más de 100 entidades y que la carga de la solicitud no supere los 4 MB de tamaño).</span><span class="sxs-lookup"><span data-stu-id="0b784-545">This means that an application can perform multiple insert, update, delete, replace, or merge operations as an atomic unit (as long as the transaction doesn't include more than 100 entities and the payload of the request doesn't exceed 4 MB).</span></span> <span data-ttu-id="0b784-546">Las operaciones que abarcan varias particiones no son transaccionales y pueden requerir la implementación de la coherencia eventual, tal y como se describe en [Data consistency primer](Información básica sobre la coherencia de datos).</span><span class="sxs-lookup"><span data-stu-id="0b784-546">Operations that span multiple partitions are not transactional, and might require you to implement eventual consistency as described by the [Data consistency primer].</span></span> <span data-ttu-id="0b784-547">Para más información sobre el almacenamiento y las transacciones de tablas, visite la página [Realizar transacciones con grupos de entidades] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-547">For more information about table storage and transactions, go to the page [Performing entity group transactions] on the Microsoft website.</span></span>
* <span data-ttu-id="0b784-548">Preste mucha atención a la granularidad de la clave de partición por los siguientes motivos:</span><span class="sxs-lookup"><span data-stu-id="0b784-548">Give careful attention to the granularity of the partition key because of the following reasons:</span></span>
  * <span data-ttu-id="0b784-549">El uso de la misma clave de partición para todas las entidades hace que el servicio Almacenamiento de tablas cree una sola partición de gran tamaño que se conserva en un servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-549">Using the same partition key for every entity causes the table storage service to create a single large partition that's held on one server.</span></span> <span data-ttu-id="0b784-550">Esto impide el escalado horizontal y centra la carga en un único servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-550">This prevents it from scaling out and instead focuses the load on a single server.</span></span> <span data-ttu-id="0b784-551">Como resultado, este enfoque solo es adecuado para sistemas que administran un pequeño número de entidades.</span><span class="sxs-lookup"><span data-stu-id="0b784-551">As a result, this approach is only suitable for systems that manage a small number of entities.</span></span> <span data-ttu-id="0b784-552">Sin embargo, este enfoque garantiza que todas las entidades puedan participar en transacciones de grupo de entidades.</span><span class="sxs-lookup"><span data-stu-id="0b784-552">However, this approach does ensure that all entities can participate in entity group transactions.</span></span>
  * <span data-ttu-id="0b784-553">El uso de una clave de partición única para cada entidad provoca que el servicio Almacenamiento de tablas cree una partición independiente para cada entidad, lo cual puede dar lugar a un número elevado de particiones pequeñas (dependiendo del tamaño de las entidades).</span><span class="sxs-lookup"><span data-stu-id="0b784-553">Using a unique partition key for every entity causes the table storage service to create a separate partition for each entity, possibly resulting in a large number of small partitions (depending on the size of the entities).</span></span> <span data-ttu-id="0b784-554">Este enfoque es más escalable que el uso de una clave de partición única, pero no es posible realizar transacciones de grupo de entidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-554">This approach is more scalable than using a single partition key, but entity group transactions are not possible.</span></span> <span data-ttu-id="0b784-555">Además, las consultas que capturan más de una entidad podrían implicar lecturas desde más de un servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-555">Also, queries that fetch more than one entity might involve reading from more than one server.</span></span> <span data-ttu-id="0b784-556">Sin embargo, si la aplicación realiza consultas por rango, el uso de una secuencia monotónica para generar las claves de partición puede ayudarle a optimizar estas consultas.</span><span class="sxs-lookup"><span data-stu-id="0b784-556">However, if the application performs range queries, then using a monotonic sequence to generate the partition keys might help to optimize these queries.</span></span>
  * <span data-ttu-id="0b784-557">Compartir la clave de partición en un subconjunto de entidades permite agrupar entidades relacionadas en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-557">Sharing the partition key across a subset of entities makes it possible for you to group related entities in the same partition.</span></span> <span data-ttu-id="0b784-558">Se pueden realizar operaciones que implican entidades relacionadas con transacciones de grupo de entidades, y es posible dar respuesta a las consultas que capturan un conjunto de entidades relacionadas mediante el acceso a un único servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-558">Operations that involve related entities can be performed by using entity group transactions, and queries that fetch a set of related entities can be satisfied by accessing a single server.</span></span>

<span data-ttu-id="0b784-559">Para obtener información adicional sobre la creación de particiones de datos en Almacenamiento de tablas de Azure, consulte el artículo [Guía de diseño de la tabla de almacenamiento de Azure: diseño escalable y tablas de rendimiento] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-559">For additional information about partitioning data in Azure table storage, see the article [Azure storage table design guide] on the Microsoft website.</span></span>

## <a name="partitioning-azure-blob-storage"></a><span data-ttu-id="0b784-560">Creación de particiones en el almacenamiento de blobs de Azure</span><span class="sxs-lookup"><span data-stu-id="0b784-560">Partitioning Azure blob storage</span></span>
<span data-ttu-id="0b784-561">Azure Blob Storage permite almacenar objetos binarios grandes: actualmente hasta 5 GB de tamaño para los blobs en bloques o 1 TB para los blobs en páginas.</span><span class="sxs-lookup"><span data-stu-id="0b784-561">Azure blob storage makes it possible to hold large binary objects--currently up to 5 TB in size for block blobs or 1 TB for page blobs.</span></span> <span data-ttu-id="0b784-562">(Para obtener la información más actualizada, vaya a la página [Objetivos de escalabilidad y rendimiento de Azure Storage] en el sitio web de Microsoft). Use blobs en bloques en escenarios como los de transmisión por secuencias donde sea necesario cargar o descargar grandes volúmenes de datos rápidamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-562">(For the most recent information, go to the page [Azure Storage scalability and performance targets] on the Microsoft website.) Use block blobs in scenarios such as streaming where you need to upload or download large volumes of data quickly.</span></span> <span data-ttu-id="0b784-563">Use blobs en páginas para aplicaciones que requieran acceso aleatorio en lugar de acceso de serie a partes de los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-563">Use page blobs for applications that require random rather than serial access to parts of the data.</span></span>

<span data-ttu-id="0b784-564">Cada blob (en bloque o en página) se mantiene en un contenedor de una cuenta de almacenamiento de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-564">Each blob (either block or page) is held in a container in an Azure storage account.</span></span> <span data-ttu-id="0b784-565">Puede usar contenedores para agrupar los blobs relacionados que tengan los mismos requisitos de seguridad.</span><span class="sxs-lookup"><span data-stu-id="0b784-565">You can use containers to group related blobs that have the same security requirements.</span></span> <span data-ttu-id="0b784-566">Esta agrupación es más lógica que física.</span><span class="sxs-lookup"><span data-stu-id="0b784-566">This grouping is logical rather than physical.</span></span> <span data-ttu-id="0b784-567">Dentro de un contenedor, cada blob tiene un nombre único.</span><span class="sxs-lookup"><span data-stu-id="0b784-567">Inside a container, each blob has a unique name.</span></span>

<span data-ttu-id="0b784-568">La clave de partición de un blob es el nombre de la cuenta más el nombre del contenedor y el nombre del blob.</span><span class="sxs-lookup"><span data-stu-id="0b784-568">The partition key for a blob is account name + container name + blob name.</span></span> <span data-ttu-id="0b784-569">Es decir, cada blob puede tener su propia partición si así lo exige la carga en el blob.</span><span class="sxs-lookup"><span data-stu-id="0b784-569">This means each blob can have its own partition if load on the blob demands it.</span></span> <span data-ttu-id="0b784-570">Los blobs se pueden distribuir en varios servidores para escalar horizontalmente el acceso a ellos, pero los blobs únicos solo pueden proporcionarse mediante servidores únicos.</span><span class="sxs-lookup"><span data-stu-id="0b784-570">Blobs can be distributed across many servers in order to scale out access to them, but a single blob can only be served by a single server.</span></span> 

<span data-ttu-id="0b784-571">Las acciones de escritura de un solo bloque (blob en bloques) o página (blob en páginas) son atómicas, pero no las operaciones que abarcan bloques, páginas o blobs.</span><span class="sxs-lookup"><span data-stu-id="0b784-571">The actions of writing a single block (block blob) or page (page blob) are atomic, but operations that span blocks, pages, or blobs are not.</span></span> <span data-ttu-id="0b784-572">Si necesita asegurar la coherencia cuando se realizan operaciones de escritura en bloques, páginas y blobs, realice un bloqueo de escritura mediante el uso de una concesión de blob.</span><span class="sxs-lookup"><span data-stu-id="0b784-572">If you need to ensure consistency when performing write operations across blocks, pages, and blobs, take out a write lock by using a blob lease.</span></span>

<span data-ttu-id="0b784-573">Azure Blob Storage admite velocidades de transferencia de hasta 60 MB por segundo o hasta 500 solicitudes por segundo para cada blob.</span><span class="sxs-lookup"><span data-stu-id="0b784-573">Azure blob storage targets transfer rates of up to 60 MB per second or 500 requests per second for each blob.</span></span> <span data-ttu-id="0b784-574">Si prevé que va a superar estos límites y los datos de blob están relativamente estáticos, considere la posibilidad de replicar blobs mediante el uso de Azure Content Delivery Network (CDN).</span><span class="sxs-lookup"><span data-stu-id="0b784-574">If you anticipate surpassing these limits, and the blob data is relatively static, then consider replicating blobs by using the Azure Content Delivery Network.</span></span> <span data-ttu-id="0b784-575">Para más información, consulte la página [Azure Content Delivery Network] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-575">For more information, see the page [Azure Content Delivery Network] on the Microsoft website.</span></span> <span data-ttu-id="0b784-576">Para obtener más instrucciones y otras consideraciones, consulte el artículo [Uso de Azure Content Delivery Network].</span><span class="sxs-lookup"><span data-stu-id="0b784-576">For additional guidance and considerations, see [Using Azure Content Delivery Network].</span></span>

## <a name="partitioning-azure-storage-queues"></a><span data-ttu-id="0b784-577">Creación de particiones en colas de almacenamiento de Azure</span><span class="sxs-lookup"><span data-stu-id="0b784-577">Partitioning Azure storage queues</span></span>
<span data-ttu-id="0b784-578">Las colas de almacenamiento de Azure le permiten implementar mensajería asincrónica entre procesos.</span><span class="sxs-lookup"><span data-stu-id="0b784-578">Azure storage queues enable you to implement asynchronous messaging between processes.</span></span> <span data-ttu-id="0b784-579">Una cuenta de almacenamiento de Azure puede contener cualquier número de colas y cada una de ellas puede contener cualquier número de mensajes.</span><span class="sxs-lookup"><span data-stu-id="0b784-579">An Azure storage account can contain any number of queues, and each queue can contain any number of messages.</span></span> <span data-ttu-id="0b784-580">La única limitación es el espacio disponible en la cuenta de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-580">The only limitation is the space that's available in the storage account.</span></span> <span data-ttu-id="0b784-581">El tamaño máximo de un mensaje individual es de 64 KB.</span><span class="sxs-lookup"><span data-stu-id="0b784-581">The maximum size of an individual message is 64 KB.</span></span> <span data-ttu-id="0b784-582">Si necesita mensajes de mayor tamaño, considere la posibilidad de usar colas de Azure Service Bus en su lugar.</span><span class="sxs-lookup"><span data-stu-id="0b784-582">If you require messages bigger than this, then consider using Azure Service Bus queues instead.</span></span>

<span data-ttu-id="0b784-583">Cada cola de almacenamiento tiene un nombre único dentro de la cuenta de almacenamiento en la que se encuentra.</span><span class="sxs-lookup"><span data-stu-id="0b784-583">Each storage queue has a unique name within the storage account that contains it.</span></span> <span data-ttu-id="0b784-584">Azure crea colas de particiones basadas en el nombre.</span><span class="sxs-lookup"><span data-stu-id="0b784-584">Azure partitions queues based on the name.</span></span> <span data-ttu-id="0b784-585">Todos los mensajes de la misma cola se almacenan en la misma partición, que se controla mediante un solo servidor.</span><span class="sxs-lookup"><span data-stu-id="0b784-585">All messages for the same queue are stored in the same partition, which is controlled by a single server.</span></span> <span data-ttu-id="0b784-586">Distintas colas pueden ser administradas por distintos servidores para ayudar a equilibrar la carga.</span><span class="sxs-lookup"><span data-stu-id="0b784-586">Different queues can be managed by different servers to help balance the load.</span></span> <span data-ttu-id="0b784-587">La asignación de colas a servidores es transparente para las aplicaciones y usuarios.</span><span class="sxs-lookup"><span data-stu-id="0b784-587">The allocation of queues to servers is transparent to applications and users.</span></span>

 <span data-ttu-id="0b784-588">En una aplicación a gran escala, no utilice la misma cola de almacenamiento para todas las instancias de la aplicación porque esto puede provocar que el servidor que hospeda la cola soporte una carga excesiva.</span><span class="sxs-lookup"><span data-stu-id="0b784-588">In a large-scale application, don't use the same storage queue for all instances of the application because this approach might cause the server that's hosting the queue to become a hotspot.</span></span> <span data-ttu-id="0b784-589">En su lugar, use colas diferentes para distintas áreas funcionales de la aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-589">Instead, use different queues for different functional areas of the application.</span></span> <span data-ttu-id="0b784-590">Las colas de almacenamiento de Azure no admiten transacciones, por lo que dirigir los mensajes a distintas colas debería tener poco impacto en la coherencia de los mensajes.</span><span class="sxs-lookup"><span data-stu-id="0b784-590">Azure storage queues do not support transactions, so directing messages to different queues should have little impact on messaging consistency.</span></span>

<span data-ttu-id="0b784-591">Una cola de almacenamiento de Azure puede controlar hasta 2000 mensajes por segundo.</span><span class="sxs-lookup"><span data-stu-id="0b784-591">An Azure storage queue can handle up to 2,000 messages per second.</span></span>  <span data-ttu-id="0b784-592">Si necesita procesar los mensajes a una velocidad mayor, puede crear varias colas.</span><span class="sxs-lookup"><span data-stu-id="0b784-592">If you need to process messages at a greater rate than this, consider creating multiple queues.</span></span> <span data-ttu-id="0b784-593">Por ejemplo, en una aplicación global, cree colas de almacenamiento independientes en cuentas de almacenamiento separadas para controlar las instancias de aplicación que se ejecutan en cada región.</span><span class="sxs-lookup"><span data-stu-id="0b784-593">For example, in a global application, create separate storage queues in separate storage accounts to handle application instances that are running in each region.</span></span>

## <a name="partitioning-strategies-for-azure-service-bus"></a><span data-ttu-id="0b784-594">Estrategias de creación de particiones para Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="0b784-594">Partitioning strategies for Azure Service Bus</span></span>
<span data-ttu-id="0b784-595">Azure Service Bus usa un agente de mensajes para controlar los mensajes enviados a una cola o un tema de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="0b784-595">Azure Service Bus uses a message broker to handle messages that are sent to a Service Bus queue or topic.</span></span> <span data-ttu-id="0b784-596">De forma predeterminada, todos los mensajes enviados a una cola o tema se controlan mediante el mismo proceso de agente de mensaje.</span><span class="sxs-lookup"><span data-stu-id="0b784-596">By default, all messages that are sent to a queue or topic are handled by the same message broker process.</span></span> <span data-ttu-id="0b784-597">Esta arquitectura puede colocar una limitación en el rendimiento general de la cola de mensajes.</span><span class="sxs-lookup"><span data-stu-id="0b784-597">This architecture can place a limitation on the overall throughput of the message queue.</span></span> <span data-ttu-id="0b784-598">Sin embargo, también puede dividir una cola o tema cuando se crea.</span><span class="sxs-lookup"><span data-stu-id="0b784-598">However, you can also partition a queue or topic when it is created.</span></span> <span data-ttu-id="0b784-599">Para ello, establezca la propiedad *EnablePartitioning* de la descripción de la cola o el tema en *true*.</span><span class="sxs-lookup"><span data-stu-id="0b784-599">You do this by setting the *EnablePartitioning* property of the queue or topic description to *true*.</span></span>

<span data-ttu-id="0b784-600">Una cola o tema con particiones se divide en varios fragmentos, cada uno de ellos respaldado por un almacén de mensajes y un agente de mensajes independientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-600">A partitioned queue or topic is divided into multiple fragments, each of which is backed by a separate message store and message broker.</span></span> <span data-ttu-id="0b784-601">Service Bus asume la responsabilidad de crear y administrar estos fragmentos.</span><span class="sxs-lookup"><span data-stu-id="0b784-601">Service Bus takes responsibility for creating and managing these fragments.</span></span> <span data-ttu-id="0b784-602">Cuando una aplicación envía un mensaje a una cola o tema particionado, Service Bus asigna el mensaje a un fragmento de esa cola o tema.</span><span class="sxs-lookup"><span data-stu-id="0b784-602">When an application posts a message to a partitioned queue or topic, Service Bus assigns the message to a fragment for that queue or topic.</span></span> <span data-ttu-id="0b784-603">Cuando una aplicación recibe un mensaje de una cola o suscripción, Service Bus comprueba cada fragmento para detectar el siguiente mensaje disponible y, a continuación, lo pasa a la aplicación para su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-603">When an application receives a message from a queue or subscription, Service Bus checks each fragment for the next available message and then passes it to the application for processing.</span></span>

<span data-ttu-id="0b784-604">Esta estructura le ayuda a distribuir la carga entre los agentes de mensajes y los almacenes de mensajes, aumentando la escalabilidad y mejorando la disponibilidad.</span><span class="sxs-lookup"><span data-stu-id="0b784-604">This structure helps distribute the load across message brokers and message stores, increasing scalability and improving availability.</span></span> <span data-ttu-id="0b784-605">Si el almacén de mensajes o el agente de mensajes de un fragmento no está disponible temporalmente, Service Bus puede recuperar mensajes de uno de los demás fragmentos disponibles.</span><span class="sxs-lookup"><span data-stu-id="0b784-605">If the message broker or message store for one fragment is temporarily unavailable, Service Bus can retrieve messages from one of the remaining available fragments.</span></span>

<span data-ttu-id="0b784-606">Service Bus asigna un mensaje a un fragmento de la siguiente manera:</span><span class="sxs-lookup"><span data-stu-id="0b784-606">Service Bus assigns a message to a fragment as follows:</span></span>

* <span data-ttu-id="0b784-607">Si el mensaje pertenece a una sesión, se envían todos los mensajes con el mismo valor para la propiedad *SessionId* al mismo fragmento.</span><span class="sxs-lookup"><span data-stu-id="0b784-607">If the message belongs to a session, all messages with the same value for the * SessionId*  property are sent to the same fragment.</span></span>
* <span data-ttu-id="0b784-608">Si el mensaje no pertenece a una sesión pero el remitente ha especificado un valor para la propiedad *PartitionKey*, todos los mensajes con el mismo valor *PartitionKey* se enviarán al mismo fragmento.</span><span class="sxs-lookup"><span data-stu-id="0b784-608">If the message does not belong to a session, but the sender has specified a value for the *PartitionKey* property, then all messages with the same *PartitionKey* value are sent to the same fragment.</span></span>

  > [!NOTE]
  > <span data-ttu-id="0b784-609">Si se especifican las propiedades *SessionId* y *PartitionKey*, se deben establecer en el mismo valor; de lo contrario, se rechazará el mensaje.</span><span class="sxs-lookup"><span data-stu-id="0b784-609">If the *SessionId* and *PartitionKey* properties are both specified, then they must be set to the same value or the message will be rejected.</span></span>
  >
  >
* <span data-ttu-id="0b784-610">Si las propiedades *SessionId* y *PartitionKey* de un mensaje no se han especificado pero se habilita la detección de duplicados, se usará la propiedad *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="0b784-610">If the *SessionId* and *PartitionKey* properties for a message are not specified, but duplicate detection is enabled, the *MessageId* property will be used.</span></span> <span data-ttu-id="0b784-611">Todos los mensajes con el mismo *MessageId* se dirigirán al mismo fragmento.</span><span class="sxs-lookup"><span data-stu-id="0b784-611">All messages with the same *MessageId* will be directed to the same fragment.</span></span>
* <span data-ttu-id="0b784-612">Si los mensajes no incluyen una propiedad *SessionId, PartitionKey,* o *MessageId*, Service Bus asigna los mensajes a los fragmentos de manera secuencial.</span><span class="sxs-lookup"><span data-stu-id="0b784-612">If messages do not include a *SessionId, PartitionKey,* or *MessageId* property, then Service Bus assigns messages to fragments sequentially.</span></span> <span data-ttu-id="0b784-613">Si un fragmento no está disponible, Service Bus pasará al siguiente.</span><span class="sxs-lookup"><span data-stu-id="0b784-613">If a fragment is unavailable, Service Bus will move on to the next.</span></span> <span data-ttu-id="0b784-614">Esto significa que un error temporal de la infraestructura de mensajería no provoca un error en la operación de envío de mensajes.</span><span class="sxs-lookup"><span data-stu-id="0b784-614">This means that a temporary fault in the messaging infrastructure does not cause the message-send operation to fail.</span></span>

<span data-ttu-id="0b784-615">Debe tener en cuenta los siguientes puntos cuando decida si crear una partición en un tema o una cola de mensajes de Service Bus o un tema, y cómo realizarla:</span><span class="sxs-lookup"><span data-stu-id="0b784-615">Consider the following points when deciding if or how to partition a Service Bus message queue or topic:</span></span>

* <span data-ttu-id="0b784-616">Los temas y colas de Service Bus se crean dentro del ámbito de un espacio de nombres de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="0b784-616">Service Bus queues and topics are created within the scope of a Service Bus namespace.</span></span> <span data-ttu-id="0b784-617">Actualmente Service Bus permite hasta 100 colas o temas particionados por espacio de nombres.</span><span class="sxs-lookup"><span data-stu-id="0b784-617">Service Bus currently allows up to 100 partitioned queues or topics per namespace.</span></span>
* <span data-ttu-id="0b784-618">Cada espacio de nombres de Service Bus impone cuotas en los recursos disponibles, como el número de suscripciones por tema, el número de solicitudes de envío y recepción simultáneas por segundo y el número máximo de conexiones simultáneas que pueden establecerse.</span><span class="sxs-lookup"><span data-stu-id="0b784-618">Each Service Bus namespace imposes quotas on the available resources, such as the number of subscriptions per topic, the number of concurrent send and receive requests per second, and the maximum number of concurrent connections that can be established.</span></span> <span data-ttu-id="0b784-619">Estas cuotas se documentan en el sitio web de Microsoft en la página [Cuotas de Service Bus].</span><span class="sxs-lookup"><span data-stu-id="0b784-619">These quotas are documented on the Microsoft website on the page [Service Bus quotas].</span></span> <span data-ttu-id="0b784-620">Si espera que superar estos valores, cree espacios de nombres adicionales con sus propios temas y colas y distribuya el trabajo en estos espacios de nombres.</span><span class="sxs-lookup"><span data-stu-id="0b784-620">If you expect to exceed these values, then create additional namespaces with their own queues and topics, and spread the work across these namespaces.</span></span> <span data-ttu-id="0b784-621">Por ejemplo, en una aplicación global, cree espacios de nombres independientes en cada región y configure instancias de la aplicación para usar las colas y temas en el espacio de nombres más cercano.</span><span class="sxs-lookup"><span data-stu-id="0b784-621">For example, in a global application, create separate namespaces in each region and configure application instances to use the queues and topics in the nearest namespace.</span></span>
* <span data-ttu-id="0b784-622">Los mensajes que se envían como parte de una transacción deben especificar una clave de partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-622">Messages that are sent as part of a transaction must specify a partition key.</span></span> <span data-ttu-id="0b784-623">Esta puede ser una propiedad *SessionId*, *PartitionKey* o *MessageId*.</span><span class="sxs-lookup"><span data-stu-id="0b784-623">This can be a *SessionId*, *PartitionKey*, or *MessageId* property.</span></span> <span data-ttu-id="0b784-624">Todos los mensajes que se envían como parte de la misma transacción deben especificar la misma clave de partición porque deben tratarse mediante el mismo proceso de agente de mensaje.</span><span class="sxs-lookup"><span data-stu-id="0b784-624">All messages that are sent as part of the same transaction must specify the same partition key because they must be handled by the same message broker process.</span></span> <span data-ttu-id="0b784-625">No se pueden enviar mensajes a diferentes colas o temas de dentro de la misma transacción.</span><span class="sxs-lookup"><span data-stu-id="0b784-625">You cannot send messages to different queues or topics within the same transaction.</span></span>
* <span data-ttu-id="0b784-626">Temas y colas con particiones no pueden configurarse para eliminarse automáticamente cuando se queden inactivas.</span><span class="sxs-lookup"><span data-stu-id="0b784-626">Partitioned queues and topics can't be configured to be automatically deleted when they become idle.</span></span>
* <span data-ttu-id="0b784-627">Si está creando soluciones multiplataforma o híbridas, en este momento no podrá utilizar colas o temas con particiones con el protocolo Advanced Message Queuing Protocol (AMQP).</span><span class="sxs-lookup"><span data-stu-id="0b784-627">Partitioned queues and topics can't currently be used with the Advanced Message Queuing Protocol (AMQP) if you are building cross-platform or hybrid solutions.</span></span>

## <a name="partitioning-strategies-for-documentdb-api"></a><span data-ttu-id="0b784-628">Estrategias de creación de particiones para Document DB API</span><span class="sxs-lookup"><span data-stu-id="0b784-628">Partitioning strategies for DocumentDB API</span></span>
<span data-ttu-id="0b784-629">Azure Cosmos DB es una base de datos NoSQL que puede almacenar documentos con [Document API][documentdb-api].</span><span class="sxs-lookup"><span data-stu-id="0b784-629">Azure Cosmos DB is a NoSQL database that can store documents using the [DocumentDB API][documentdb-api].</span></span> <span data-ttu-id="0b784-630">En una base de datos de Cosmos DB, un documento es una representación serializada de un objeto o de otro elemento de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-630">A document in a Cosmos DB database is a JSON-serialized representation of an object or other piece of data.</span></span> <span data-ttu-id="0b784-631">No se aplican esquemas fijos, excepto que cada documento debe contener un identificador único.</span><span class="sxs-lookup"><span data-stu-id="0b784-631">No fixed schemas are enforced except that every document must contain a unique ID.</span></span>

<span data-ttu-id="0b784-632">Los documentos se organizan en colecciones.</span><span class="sxs-lookup"><span data-stu-id="0b784-632">Documents are organized into collections.</span></span> <span data-ttu-id="0b784-633">Puede agrupar documentos relacionados entre sí en una colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-633">You can group related documents together in a collection.</span></span> <span data-ttu-id="0b784-634">Por ejemplo, en un sistema que mantiene las entradas de un blog, puede almacenar el contenido de cada entrada como un documento de una colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-634">For example, in a system that maintains blog postings, you can store the contents of each blog post as a document in a collection.</span></span> <span data-ttu-id="0b784-635">También puede crear colecciones para cada tipo de asunto.</span><span class="sxs-lookup"><span data-stu-id="0b784-635">You can also create collections for each subject type.</span></span> <span data-ttu-id="0b784-636">O bien, en una aplicación para varios inquilinos, como un sistema donde diferentes autores controlan y administran sus propias publicaciones de blog, podría crear particiones en los blogs por autor y crear una colección independiente para cada autor.</span><span class="sxs-lookup"><span data-stu-id="0b784-636">Alternatively, in a multitenant application, such as a system where different authors control and manage their own blog posts, you can partition blogs by author and create separate collections for each author.</span></span> <span data-ttu-id="0b784-637">El espacio de almacenamiento asignado a las colecciones es elástico y puede reducirse o ampliarse según sea necesario.</span><span class="sxs-lookup"><span data-stu-id="0b784-637">The storage space that's allocated to collections is elastic and can shrink or grow as needed.</span></span>

<span data-ttu-id="0b784-638">Las colecciones de documentos proporcionan un mecanismo natural para dividir los datos de una base de datos única.</span><span class="sxs-lookup"><span data-stu-id="0b784-638">Document collections provide a natural mechanism for partitioning data within a single database.</span></span> <span data-ttu-id="0b784-639">Internamente, una base de datos de Cosmos DB puede abarcar varios servidores e intentar distribuir la carga al distribuir colecciones entre servidores.</span><span class="sxs-lookup"><span data-stu-id="0b784-639">Internally, a Cosmos DB database can span several servers and might attempt to spread the load by distributing collections across servers.</span></span> <span data-ttu-id="0b784-640">La manera más sencilla de implementar las particiones es crear una colección para cada partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-640">The simplest way to implement sharding is to create a collection for each shard.</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-641">Cada base de datos de Cosmos DB tiene un *nivel de rendimiento* que determina la cantidad de recursos que obtiene.</span><span class="sxs-lookup"><span data-stu-id="0b784-641">Each Cosmos DB database has a *performance level* that determines the amount of resources it gets.</span></span> <span data-ttu-id="0b784-642">Los niveles de rendimiento están asociados a un límite de velocidad de *unidad de solicitud*.</span><span class="sxs-lookup"><span data-stu-id="0b784-642">A performance level is associated with a *request unit* (RU) rate limit.</span></span> <span data-ttu-id="0b784-643">El límite de velocidad de unidad de solicitud especifica el volumen de los recursos reservados y disponibles para el uso exclusivo de esa colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-643">The RU rate limit specifies the volume of resources that's reserved and available for exclusive use by that collection.</span></span> <span data-ttu-id="0b784-644">El costo de una colección depende del nivel de rendimiento seleccionado para esa colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-644">The cost of a collection depends on the performance level that's selected for that collection.</span></span> <span data-ttu-id="0b784-645">Cuanto mayor sea el nivel re rendimiento (y el límite de velocidad de la unidad de solicitud), mayor será el costo.</span><span class="sxs-lookup"><span data-stu-id="0b784-645">The higher the performance level (and RU rate limit) the higher the charge.</span></span> <span data-ttu-id="0b784-646">Puede ajustar el nivel de rendimiento de una colección mediante el Portal de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-646">You can adjust the performance level of a collection by using the Azure portal.</span></span> <span data-ttu-id="0b784-647">Para más información, consulte la página [Niveles de rendimiento en Cosmos DB] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-647">For more information, see the page [Performance levels in Cosmos DB] on the Microsoft website.</span></span>
>
>

<span data-ttu-id="0b784-648">Todas las bases de datos se crean en el contexto de una cuenta de base de datos de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b784-648">All databases are created in the context of a Cosmos DB database account.</span></span> <span data-ttu-id="0b784-649">Una sola cuenta puede contener varias bases de datos, y especifica en qué regiones se crean las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-649">A single account can contain several databases, and it specifies in which regions the databases are created.</span></span> <span data-ttu-id="0b784-650">Cada cuenta también impone su propio control de acceso.</span><span class="sxs-lookup"><span data-stu-id="0b784-650">Each account also enforces its own access control.</span></span> <span data-ttu-id="0b784-651">Puede utilizar cuentas de Cosmos DB para localizar geográficamente particiones (colecciones dentro de bases de datos) cerca de los usuarios que necesitan tener acceso a ellas y aplicar restricciones de modo que solo esos usuarios puedan conectarse.</span><span class="sxs-lookup"><span data-stu-id="0b784-651">You can use Cosmos DB accounts to geo-locate shards (collections within databases) close to the users who need to access them, and enforce restrictions so that only those users can connect to them.</span></span>

<span data-ttu-id="0b784-652">Cada cuenta de Cosmos DB tiene una cuota que limita el número de bases de datos, las colecciones que puede contener y la cantidad de almacenamiento de documentos disponible.</span><span class="sxs-lookup"><span data-stu-id="0b784-652">Each Cosmos DB account has a quota that limits the number of databases and collections that it can contain and the amount of document storage that's available.</span></span> <span data-ttu-id="0b784-653">Para más información, consulte [Límites, cuotas y restricciones de suscripción y servicios de Microsoft Azure][azure-limits].</span><span class="sxs-lookup"><span data-stu-id="0b784-653">For more information, see [Azure subscription and service limits, quotas, and constraints][azure-limits].</span></span> <span data-ttu-id="0b784-654">Teóricamente, es posible que si se implementa un sistema donde todas las particiones pertenecen a la misma base de datos, se podría alcanzar el límite de capacidad de almacenamiento de información de la cuenta.</span><span class="sxs-lookup"><span data-stu-id="0b784-654">It is theoretically possible that if you implement a system where all shards belong to the same database, you might reach the storage capacity limit of the account.</span></span>

<span data-ttu-id="0b784-655">En este caso, puede que necesite crear bases de datos y cuentas de Cosmos DB adicionales y distribuir las particiones en estas bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-655">In this case, you might need to create additional accounts and databases, and distribute the shards across these databases.</span></span> <span data-ttu-id="0b784-656">Sin embargo, aunque es poco probable que alcance la capacidad de almacenamiento de una base de datos, es recomendable utilizar varias bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-656">However, even if you are unlikely to reach the storage capacity of a database, it's a good practice to use multiple databases.</span></span> <span data-ttu-id="0b784-657">El motivo es que cada base de datos tiene su propio conjunto de usuarios y permisos, y puede utilizar este mecanismo para aislar el acceso a las colecciones en función de cada una de las bases de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-657">That's because each database has its own set of users and permissions, and you can use this mechanism to isolate access to collections on a per-database basis.</span></span>

<span data-ttu-id="0b784-658">La figura 8 muestra la estructura de alto nivel de DocumentDB API.</span><span class="sxs-lookup"><span data-stu-id="0b784-658">Figure 8 illustrates the high-level structure of the DocumentDB API.</span></span>

![Estructura de DocumentDB API](./images/data-partitioning/DocumentDBStructure.png)

<span data-ttu-id="0b784-660">*Ilustración 8.  Estructura de la arquitectura de DocumentDB API*</span><span class="sxs-lookup"><span data-stu-id="0b784-660">*Figure 8.  The structure of the DocumentDB API architecture*</span></span>

<span data-ttu-id="0b784-661">Es responsabilidad de la aplicación cliente dirigir las solicitudes a la partición apropiada, normalmente mediante la implementación de su propio mecanismo de asignación en función de algunos atributos de los datos que definen la clave de partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-661">It is the task of the client application to direct requests to the appropriate shard, usually by implementing its own mapping mechanism based on some attributes of the data that define the shard key.</span></span> <span data-ttu-id="0b784-662">La figura 9 muestra dos bases de datos de DocumentDB API, cada una con dos colecciones que actúan como particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-662">Figure 9 shows two DocumentDB API databases, each containing two collections that are acting as shards.</span></span> <span data-ttu-id="0b784-663">Los datos se particionan por identificador de inquilino y contienen los datos de un inquilino específico.</span><span class="sxs-lookup"><span data-stu-id="0b784-663">The data is sharded by a tenant ID and contains the data for a specific tenant.</span></span> <span data-ttu-id="0b784-664">Las bases de datos se crean en cuentas de Cosmos DB independientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-664">The databases are created in separate Cosmos DB accounts.</span></span> <span data-ttu-id="0b784-665">Estas cuentas se encuentran en la misma región que los inquilinos para los que contienen los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-665">These accounts are located in the same region as the tenants for which they contain data.</span></span> <span data-ttu-id="0b784-666">La lógica de enrutamiento de la aplicación cliente usa el Id. de inquilino como la clave de partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-666">The routing logic in the client application uses the tenant ID as the shard key.</span></span>

![Implementación de particionamiento con DocumentDB API](./images/data-partitioning/DocumentDBPartitions.png)

<span data-ttu-id="0b784-668">*Ilustración 9. Implementación de particionamiento con DocumentDB API*</span><span class="sxs-lookup"><span data-stu-id="0b784-668">*Figure 9. Implementing sharding using the DocumentDB API*</span></span>

<span data-ttu-id="0b784-669">A la hora de decidir cómo particionar los datos con DocumentDB API, tenga en cuenta los siguientes puntos:</span><span class="sxs-lookup"><span data-stu-id="0b784-669">Consider the following points when deciding how to partition data with the DocumentDB API:</span></span>

* <span data-ttu-id="0b784-670">**Los recursos disponibles para una base de datos de DocumentDB API están sujetos a las limitaciones de cuota de la cuenta**.</span><span class="sxs-lookup"><span data-stu-id="0b784-670">**The resources available to a DocumentDB API database are subject to the quota limitations of the account**.</span></span> <span data-ttu-id="0b784-671">Cada base de datos puede contener un número de colecciones (de nuevo, hay un límite) y cada colección está asociada a un nivel de rendimiento que rige el límite de velocidad de RU (rendimiento reservado) para esa colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-671">Each database can hold a number of collections (again, there is a limit), and each collection is associated with a performance level that governs the RU rate limit (reserved throughput) for that collection.</span></span> <span data-ttu-id="0b784-672">Para más información, consulte [Límites, cuotas y restricciones de suscripción y servicios de Microsoft Azure].</span><span class="sxs-lookup"><span data-stu-id="0b784-672">For more information, see [Azure subscription and service limits, quotas, and constraints].</span></span>
* <span data-ttu-id="0b784-673">**Cada documento debe tener un atributo que pueda usarse para identificar de manera única dicho documento dentro de la colección en la que se encuentra**.</span><span class="sxs-lookup"><span data-stu-id="0b784-673">**Each document must have an attribute that can be used to uniquely identify that document within the collection in which it is held**.</span></span> <span data-ttu-id="0b784-674">Este atributo es diferente de la clave de partición, que define en qué colección se encuentra el documento.</span><span class="sxs-lookup"><span data-stu-id="0b784-674">This attribute is different from the shard key, which defines which collection holds the document.</span></span> <span data-ttu-id="0b784-675">Una colección puede contener un gran número de documentos.</span><span class="sxs-lookup"><span data-stu-id="0b784-675">A collection can contain a large number of documents.</span></span> <span data-ttu-id="0b784-676">En teoría, solo está limitada por la longitud máxima del identificador del documento.</span><span class="sxs-lookup"><span data-stu-id="0b784-676">In theory, it's limited only by the maximum length of the document ID.</span></span> <span data-ttu-id="0b784-677">El identificador del documento puede contener hasta 255 caracteres.</span><span class="sxs-lookup"><span data-stu-id="0b784-677">The document ID can be up to 255 characters.</span></span>
* <span data-ttu-id="0b784-678">**Todas las operaciones de un documento se realizan en el contexto de una transacción. Las transacciones se limitan a la colección que contiene el documento.**</span><span class="sxs-lookup"><span data-stu-id="0b784-678">**All operations against a document are performed within the context of a transaction. Transactions are scoped to the collection in which the document is contained.**</span></span> <span data-ttu-id="0b784-679">Si se produce un error en una operación, se revierte el trabajo que ha realizado.</span><span class="sxs-lookup"><span data-stu-id="0b784-679">If an operation fails, the work that it has performed is rolled back.</span></span> <span data-ttu-id="0b784-680">Mientras se realiza una operación sobre un documento, los cambios realizados están sujetos a aislamiento a nivel de instantánea.</span><span class="sxs-lookup"><span data-stu-id="0b784-680">While a document is subject to an operation, any changes that are made are subject to snapshot-level isolation.</span></span> <span data-ttu-id="0b784-681">Este mecanismo garantiza que si, por ejemplo, se produce un error en una solicitud para crear un nuevo documento, otro usuario que consulte la base de datos al mismo tiempo no verá un documento parcial que luego se elimine.</span><span class="sxs-lookup"><span data-stu-id="0b784-681">This mechanism guarantees that if, for example, a request to create a new document fails, another user who's querying the database simultaneously will not see a partial document that is then removed.</span></span>
* <span data-ttu-id="0b784-682">**Las consultas de base de datos también se limitan al nivel de colección**.</span><span class="sxs-lookup"><span data-stu-id="0b784-682">**Database queries are also scoped to the collection level**.</span></span> <span data-ttu-id="0b784-683">Una sola consulta solo puede recuperar datos de una colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-683">A single query can retrieve data from only one collection.</span></span> <span data-ttu-id="0b784-684">Si necesita recuperar datos de varias colecciones, debe consultar cada colección individualmente y combinar los resultados en el código de aplicación.</span><span class="sxs-lookup"><span data-stu-id="0b784-684">If you need to retrieve data from multiple collections, you must query each collection individually and merge the results in your application code.</span></span>
* <span data-ttu-id="0b784-685">**Las bases de datos de DocumentDB API admiten elementos programables que pueden almacenarse en una colección junto con los documentos**.</span><span class="sxs-lookup"><span data-stu-id="0b784-685">**DocumentDB API databases supports programmable items that can all be stored in a collection alongside documents**.</span></span> <span data-ttu-id="0b784-686">Estos incluyen procedimientos almacenados, funciones definidas por el usuario y desencadenadores (escritos en JavaScript).</span><span class="sxs-lookup"><span data-stu-id="0b784-686">These include stored procedures, user-defined functions, and triggers (written in JavaScript).</span></span> <span data-ttu-id="0b784-687">Estos elementos pueden tener acceso a cualquier documento en la misma colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-687">These items can access any document within the same collection.</span></span> <span data-ttu-id="0b784-688">Además, estos elementos se ejecutan dentro del ámbito de la transacción de ambiente (en el caso de un desencadenador que se activa como resultado de una operación de crear, eliminar o reemplazar realizada en un documento), o iniciando una nueva transacción (en el caso de un procedimiento almacenado que se ejecuta como resultado de una solicitud de cliente explícita).</span><span class="sxs-lookup"><span data-stu-id="0b784-688">Furthermore, these items run either inside the scope of the ambient transaction (in the case of a trigger that fires as the result of a create, delete, or replace operation performed against a document), or by starting a new transaction (in the case of a stored procedure that is run as the result of an explicit client request).</span></span> <span data-ttu-id="0b784-689">Si el código de un elemento programable produce una excepción, la transacción se revierte.</span><span class="sxs-lookup"><span data-stu-id="0b784-689">If the code in a programmable item throws an exception, the transaction is rolled back.</span></span> <span data-ttu-id="0b784-690">Puede usar procedimientos almacenados y desencadenadores para mantener la integridad y la coherencia entre los documentos, pero estos documentos deben formar parte de la misma colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-690">You can use stored procedures and triggers to maintain integrity and consistency between documents, but these documents must all be part of the same collection.</span></span>
* <span data-ttu-id="0b784-691">**Debe procurar que las colecciones que desea almacenar en las bases de datos no superen los límites de rendimiento definidos por los niveles de rendimiento de las colecciones**.</span><span class="sxs-lookup"><span data-stu-id="0b784-691">**The collections that you intend to hold in the databases should be unlikely to exceed the throughput limits defined by the performance levels of the collections**.</span></span> <span data-ttu-id="0b784-692">Para más información, consulte Unidades de solicitud en Azure Cosmos DB[cosmos-db-ru].</span><span class="sxs-lookup"><span data-stu-id="0b784-692">For more informationm, see Request Units in Azure Cosmos DB][cosmos-db-ru].</span></span> <span data-ttu-id="0b784-693">Si prevé alcanzar estos límites, considere la posibilidad de dividir las colecciones entre bases de datos en diferentes cuentas para reducir la carga de cada colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-693">If you anticipate reaching these limits, consider splitting collections across databases in different accounts to reduce the load per collection.</span></span>

## <a name="partitioning-strategies-for-azure-search"></a><span data-ttu-id="0b784-694">Estrategias de creación de particiones para Azure Search</span><span class="sxs-lookup"><span data-stu-id="0b784-694">Partitioning strategies for Azure Search</span></span>
<span data-ttu-id="0b784-695">La función de búsqueda de datos suele ser el método principal de navegación y exploración proporcionado por muchas aplicaciones web.</span><span class="sxs-lookup"><span data-stu-id="0b784-695">The ability to search for data is often the primary method of navigation and exploration that's provided by many web applications.</span></span> <span data-ttu-id="0b784-696">Permite a los usuarios encontrar recursos rápidamente (por ejemplo, los productos de una aplicación de comercio electrónico) según determinadas combinaciones de criterios de búsqueda.</span><span class="sxs-lookup"><span data-stu-id="0b784-696">It helps users find resources quickly (for example, products in an e-commerce application) based on combinations of search criteria.</span></span> <span data-ttu-id="0b784-697">El servicio Azure Search proporciona capacidades de búsqueda de texto completo a través de contenido web e incluye características como las consultas sugeridas de escritura anticipada basadas en coincidencias cercanas y en la navegación por facetas.</span><span class="sxs-lookup"><span data-stu-id="0b784-697">The Azure Search service provides full-text search capabilities over web content, and includes features such as type-ahead, suggested queries based on near matches, and faceted navigation.</span></span> <span data-ttu-id="0b784-698">Se puede encontrar una descripción completa de estas funciones en la página [¿Qué es Azure Search?] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-698">A full description of these capabilities is available on the page [What is Azure Search?] on the Microsoft website.</span></span>

<span data-ttu-id="0b784-699">Azure Search almacena contenido en el que es posible realizar búsquedas como documentos JSON en una base de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-699">Azure Search stores searchable content as JSON documents in a database.</span></span> <span data-ttu-id="0b784-700">El usuario es quien define los índices que especifican los campos de búsqueda de estos documentos y proporciona estas definiciones al servicio Azure Search.</span><span class="sxs-lookup"><span data-stu-id="0b784-700">You define indexes that specify the searchable fields in these documents and provide these definitions to Azure Search.</span></span> <span data-ttu-id="0b784-701">Cuando se emite una solicitud de búsqueda, Azure Search usa los índices adecuados para buscar los elementos coincidentes.</span><span class="sxs-lookup"><span data-stu-id="0b784-701">When a user submits a search request, Azure Search uses the appropriate indexes to find matching items.</span></span>

<span data-ttu-id="0b784-702">Para reducir la contención, es posible dividir el almacenamiento utilizado por Azure Search en 1, 2, 3, 4, 6 o 12 particiones, y cada partición se puede replicar hasta 6 veces.</span><span class="sxs-lookup"><span data-stu-id="0b784-702">To reduce contention, the storage that's used by Azure Search can be divided into 1, 2, 3, 4, 6, or 12 partitions, and each partition can be replicated up to 6 times.</span></span> <span data-ttu-id="0b784-703">El producto del número de particiones multiplicado por el número de réplicas se denomina *unidad de búsqueda*.</span><span class="sxs-lookup"><span data-stu-id="0b784-703">The product of the number of partitions multiplied by the number of replicas is called the *search unit* (SU).</span></span> <span data-ttu-id="0b784-704">Una única instancia de Azure Search puede contener un máximo de 36 unidades de búsqueda (una base de datos con 12 particiones solo admite un máximo de 3 réplicas).</span><span class="sxs-lookup"><span data-stu-id="0b784-704">A single instance of Azure Search can contain a maximum of 36 SUs (a database with 12 partitions only supports a maximum of 3 replicas).</span></span>

<span data-ttu-id="0b784-705">Se le facturará cada SU que se asigne a su servicio.</span><span class="sxs-lookup"><span data-stu-id="0b784-705">You are billed for each SU that is allocated to your service.</span></span> <span data-ttu-id="0b784-706">A medida que crezca el volumen de contenido sobre el que es posible realizar búsquedas o la tasa de solicitudes de búsqueda, puede agregar unidades de búsqueda a una instancia existente de Azure Search para administrar la carga adicional.</span><span class="sxs-lookup"><span data-stu-id="0b784-706">As the volume of searchable content increases or the rate of search requests grows, you can add SUs to an existing instance of Azure Search to handle the extra load.</span></span> <span data-ttu-id="0b784-707">El propio servicio Azure Search distribuye los documentos uniformemente entre las particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-707">Azure Search itself distributes the documents evenly across the partitions.</span></span> <span data-ttu-id="0b784-708">Actualmente no se admite la aplicación de ninguna estrategia de partición manual.</span><span class="sxs-lookup"><span data-stu-id="0b784-708">No manual partitioning strategies are currently supported.</span></span>

<span data-ttu-id="0b784-709">Cada partición puede contener un máximo de 15 millones de documentos u ocupar 300 GB de espacio de almacenamiento (lo que sea menor).</span><span class="sxs-lookup"><span data-stu-id="0b784-709">Each partition can contain a maximum of 15 million documents or occupy 300 GB of storage space (whichever is smaller).</span></span> <span data-ttu-id="0b784-710">Puede crear hasta 50 índices.</span><span class="sxs-lookup"><span data-stu-id="0b784-710">You can create up to 50 indexes.</span></span> <span data-ttu-id="0b784-711">El rendimiento del servicio varía y depende de la complejidad de los documentos, los índices disponibles y los efectos de la latencia de la red.</span><span class="sxs-lookup"><span data-stu-id="0b784-711">The performance of the service varies and depends on the complexity of the documents, the available indexes, and the effects of network latency.</span></span> <span data-ttu-id="0b784-712">De media, una única réplica (1 unidad de búsqueda) debe ser capaz de administrar 15 consultas por segundo, aunque es recomendable realizar pruebas comparativas realizadas con sus propios datos para obtener una medida más precisa del rendimiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-712">On average, a single replica (1 SU) should be able to handle 15 queries per second (QPS), although we recommend performing benchmarking with your own data to obtain a more precise measure of throughput.</span></span> <span data-ttu-id="0b784-713">Para obtener más información, consulte la página [Límites de servicio en Azure Search] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-713">For more information, see the page [Service limits in Azure Search] on the Microsoft website.</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-714">Puede almacenar un conjunto limitado de tipos de datos en documentos que se pueden buscar, incluidas cadenas, valores booleanos, datos numéricos, datos de fecha y hora y algunos datos geográficos.</span><span class="sxs-lookup"><span data-stu-id="0b784-714">You can store a limited set of data types in searchable documents, including strings, Booleans, numeric data, datetime data, and some geographical data.</span></span> <span data-ttu-id="0b784-715">Para obtener más detalles, consulte la página [Tipos de datos admitidos (Azure Search)] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-715">For more details, see the page [Supported data types (Azure Search)] on the Microsoft website.</span></span>
>
>

<span data-ttu-id="0b784-716">Tiene control limitado sobre cómo divide en particiones el servicio Azure Search los datos de cada instancia del servicio.</span><span class="sxs-lookup"><span data-stu-id="0b784-716">You have limited control over how Azure Search partitions data for each instance of the service.</span></span> <span data-ttu-id="0b784-717">Sin embargo, en un entorno global puede mejorar el rendimiento y reducir la latencia y la contención aún más mediante la partición del propio servicio; para ello, aplique alguna de las estrategias siguientes:</span><span class="sxs-lookup"><span data-stu-id="0b784-717">However, in a global environment you might be able to improve performance and reduce latency and contention further by partitioning the service itself using either of the following strategies:</span></span>

* <span data-ttu-id="0b784-718">Cree una instancia de Azure Search en cada región geográfica y asegúrese de que las aplicaciones cliente se dirigen hacia la instancia disponible más cercana.</span><span class="sxs-lookup"><span data-stu-id="0b784-718">Create an instance of Azure Search in each geographic region, and ensure that client applications are directed towards the nearest available instance.</span></span> <span data-ttu-id="0b784-719">Esta estrategia requiere la replicación de las actualizaciones de contenido de búsqueda de manera oportuna en todas las instancias del servicio.</span><span class="sxs-lookup"><span data-stu-id="0b784-719">This strategy requires that any updates to searchable content are replicated in a timely manner across all instances of the service.</span></span>
* <span data-ttu-id="0b784-720">Cree dos niveles en Azure Search:</span><span class="sxs-lookup"><span data-stu-id="0b784-720">Create two tiers of Azure Search:</span></span>

  * <span data-ttu-id="0b784-721">Un servicio local en cada región que contenga los datos a los que se accede con mayor frecuencia por parte de los usuarios de esa región.</span><span class="sxs-lookup"><span data-stu-id="0b784-721">A local service in each region that contains the data that's most frequently accessed by users in that region.</span></span> <span data-ttu-id="0b784-722">Los usuarios podrá dirigir solicitudes aquí para obtener resultados rápidos pero limitados.</span><span class="sxs-lookup"><span data-stu-id="0b784-722">Users can direct requests here for fast but limited results.</span></span>
  * <span data-ttu-id="0b784-723">Un servicio global que abarque todos los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-723">A global service that encompasses all the data.</span></span> <span data-ttu-id="0b784-724">Los usuarios podrán dirigir solicitudes aquí para obtener resultados más lentos pero más completos.</span><span class="sxs-lookup"><span data-stu-id="0b784-724">Users can direct requests here for slower but more complete results.</span></span>

<span data-ttu-id="0b784-725">Este enfoque es más adecuado cuando existe una variación regional considerable en los datos que se están buscando.</span><span class="sxs-lookup"><span data-stu-id="0b784-725">This approach is most suitable when there is a significant regional variation in the data that's being searched.</span></span>

## <a name="partitioning-strategies-for-azure-redis-cache"></a><span data-ttu-id="0b784-726">Estrategias de creación de particiones para Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="0b784-726">Partitioning strategies for Azure Redis Cache</span></span>
<span data-ttu-id="0b784-727">Azure Redis Cache proporciona un servicio de almacenamiento en caché compartido en la nube que se basa en el almacén de datos de clave-valor de Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-727">Azure Redis Cache provides a shared caching service in the cloud that's based on the Redis key-value data store.</span></span> <span data-ttu-id="0b784-728">Como su nombre implica, el servicio Azure Redis Cache está concebido como una solución de almacenamiento en caché.</span><span class="sxs-lookup"><span data-stu-id="0b784-728">As its name implies, Azure Redis Cache is intended as a caching solution.</span></span> <span data-ttu-id="0b784-729">Úselo solo para almacenar datos provisionales y no como un almacén de datos permanentes.</span><span class="sxs-lookup"><span data-stu-id="0b784-729">Use it only for holding transient data and not as a permanent data store.</span></span> <span data-ttu-id="0b784-730">Las aplicaciones que usan Azure Redis Cache podrán seguir funcionando si la caché no está disponible.</span><span class="sxs-lookup"><span data-stu-id="0b784-730">Applications that utilize Azure Redis Cache should be able to continue functioning if the cache is unavailable.</span></span> <span data-ttu-id="0b784-731">Azure Redis Cache admite la replicación principal y secundaria para proporcionar alta disponibilidad, pero actualmente limita el tamaño de caché máximo a 53 GB.</span><span class="sxs-lookup"><span data-stu-id="0b784-731">Azure Redis Cache supports primary/secondary replication to provide high availability, but currently limits the maximum cache size to 53 GB.</span></span> <span data-ttu-id="0b784-732">Si necesita más espacio que este, deberá crear cachés adicionales.</span><span class="sxs-lookup"><span data-stu-id="0b784-732">If you need more space than this, you must create additional caches.</span></span> <span data-ttu-id="0b784-733">Para más información, visite la página [Azure Redis Cache] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-733">For more information, go to the page [Azure Redis Cache] on the Microsoft website.</span></span>

<span data-ttu-id="0b784-734">Crear particiones en un almacén de datos Redis implica dividir los datos entre instancias del servicio Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-734">Partitioning a Redis data store involves splitting the data across instances of the Redis service.</span></span> <span data-ttu-id="0b784-735">Cada instancia constituye una sola partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-735">Each instance constitutes a single partition.</span></span> <span data-ttu-id="0b784-736">Azure Redis Cache abstrae los servicios de Redis detrás de una fachada y no los expone directamente.</span><span class="sxs-lookup"><span data-stu-id="0b784-736">Azure Redis Cache abstracts the Redis services behind a façade and does not expose them directly.</span></span> <span data-ttu-id="0b784-737">La manera más sencilla de implementar la creación de particiones es crear varias instancias de Azure Redis Cache y repartir los datos entre ellas.</span><span class="sxs-lookup"><span data-stu-id="0b784-737">The simplest way to implement partitioning is to create multiple Azure Redis Cache instances and spread the data across them.</span></span>

<span data-ttu-id="0b784-738">Puede asociar cada uno de los elementos de datos con un identificador (una clave de partición) que especifica en qué caché se almacenan.</span><span class="sxs-lookup"><span data-stu-id="0b784-738">You can associate each data item with an identifier (a partition key) that specifies which cache stores the data item.</span></span> <span data-ttu-id="0b784-739">La lógica de la aplicación cliente puede usar luego este identificador para enrutar las solicitudes a la partición apropiada.</span><span class="sxs-lookup"><span data-stu-id="0b784-739">The client application logic can then use this identifier to route requests to the appropriate partition.</span></span> <span data-ttu-id="0b784-740">Este esquema es muy sencillo, pero si cambia el esquema de creación de particiones (por ejemplo, si se crean instancias de Azure Redis Cache adicionales), es posible que las aplicaciones cliente deban volver a configurarse.</span><span class="sxs-lookup"><span data-stu-id="0b784-740">This scheme is very simple, but if the partitioning scheme changes (for example, if additional Azure Redis Cache instances are created), client applications might need to be reconfigured.</span></span>

<span data-ttu-id="0b784-741">Redis nativo (no Azure Redis Cache) admite particiones de servidor basadas en la agrupación en clústeres de Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-741">Native Redis (not Azure Redis Cache) supports server-side partitioning based on Redis clustering.</span></span> <span data-ttu-id="0b784-742">En este enfoque, los datos se dividen uniformemente entre servidores mediante un mecanismo hash.</span><span class="sxs-lookup"><span data-stu-id="0b784-742">In this approach, you can divide the data evenly across servers by using a hashing mechanism.</span></span> <span data-ttu-id="0b784-743">Cada servidor Redis almacena metadatos que describen el intervalo de claves hash que contiene la partición, y también contiene información acerca de qué claves hash se encuentran en las particiones de otros servidores.</span><span class="sxs-lookup"><span data-stu-id="0b784-743">Each Redis server stores metadata that describes the range of hash keys that the partition holds, and also contains information about which hash keys are located in the partitions on other servers.</span></span>

<span data-ttu-id="0b784-744">Las aplicaciones cliente simplemente envían solicitudes a cualquiera de los servidores Redis participantes (probablemente el más cercano).</span><span class="sxs-lookup"><span data-stu-id="0b784-744">Client applications simply send requests to any of the participating Redis servers (probably the closest one).</span></span> <span data-ttu-id="0b784-745">El servidor Redis examina la solicitud del cliente.</span><span class="sxs-lookup"><span data-stu-id="0b784-745">The Redis server examines the client request.</span></span> <span data-ttu-id="0b784-746">Si se puede resolver localmente, este realiza la operación solicitada.</span><span class="sxs-lookup"><span data-stu-id="0b784-746">If it can be resolved locally, it performs the requested operation.</span></span> <span data-ttu-id="0b784-747">De lo contrario, reenvía la solicitud al servidor apropiado.</span><span class="sxs-lookup"><span data-stu-id="0b784-747">Otherwise it forwards the request on to the appropriate server.</span></span>

<span data-ttu-id="0b784-748">Este modelo se implementa mediante el uso de clústeres de Redis y se describe con más detalle en la página [Tutorial de clúster Redis] en el sitio web de Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-748">This model is implemented by using Redis clustering, and is described in more detail on the [Redis cluster tutorial] page on the Redis website.</span></span> <span data-ttu-id="0b784-749">La agrupación en clústeres de Redis es transparente para las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="0b784-749">Redis clustering is transparent to client applications.</span></span> <span data-ttu-id="0b784-750">Es posible agregar servidores Redis adicionales al clúster (y es posible volver a crear particiones en los datos) sin necesidad de volver a configurar los clientes.</span><span class="sxs-lookup"><span data-stu-id="0b784-750">Additional Redis servers can be added to the cluster (and the data can be re-partitioned) without requiring that you reconfigure the clients.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0b784-751">Actualmente Azure Redis Cache no admite la agrupación en clústeres Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-751">Azure Redis Cache does not currently support Redis clustering.</span></span> <span data-ttu-id="0b784-752">Si desea implementar este enfoque con Azure, deberá implementar entonces sus propios servidores Redis instalando Redis en un conjunto de máquinas virtuales de Azure y configurándolas manualmente.</span><span class="sxs-lookup"><span data-stu-id="0b784-752">If you want to implement this approach with Azure, then you must implement your own Redis servers by installing Redis on a set of Azure virtual machines and configuring them manually.</span></span> <span data-ttu-id="0b784-753">La página [Running Redis on a CentOS Linux VM in Windows Azure] (Ejecución de Redis en una máquina virtual Linux de CentOS en Azure) del sitio web de Microsoft le guía a través de un ejemplo que muestra cómo crear y configurar un nodo Redis que se ejecuta como una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-753">The page [Running Redis on a CentOS Linux VM in Azure] on the Microsoft website walks through an example that shows you how to build and configure a Redis node running as an Azure VM.</span></span>
>
>

<span data-ttu-id="0b784-754">La página [Partitioning: how to split data among multiple Redis instances] (Creación de particiones: cómo dividir los datos entre varias instancias de Redis) del sitio web de Redis ofrece más información acerca de cómo implementar la creación de particiones con Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-754">The page [Partitioning: how to split data among multiple Redis instances] on the Redis website provides more information about implementing partitioning with Redis.</span></span> <span data-ttu-id="0b784-755">En el resto de esta sección se supone que se está implementando las particiones del lado cliente o asistidas por el proxy.</span><span class="sxs-lookup"><span data-stu-id="0b784-755">The remainder of this section assumes that you are implementing client-side or proxy-assisted partitioning.</span></span>

<span data-ttu-id="0b784-756">Deberá tener en cuenta los siguientes puntos a la hora de decidir cómo crear particiones en los datos con Azure Redis Cache:</span><span class="sxs-lookup"><span data-stu-id="0b784-756">Consider the following points when deciding how to partition data with Azure Redis Cache:</span></span>

* <span data-ttu-id="0b784-757">El servicio Azure Redis Cache no está pensado para actuar como un almacén de datos permanentes, por lo que, independientemente del esquema de particiones que implemente, el código de la aplicación debe estar preparado para recuperar datos desde una ubicación distinta de la caché.</span><span class="sxs-lookup"><span data-stu-id="0b784-757">Azure Redis Cache is not intended to act as a permanent data store, so whatever partitioning scheme you implement, your application code must be able to retrieve data from a location that's not the cache.</span></span>
* <span data-ttu-id="0b784-758">Los datos a los que se suele acceder en conjunto deben mantenerse en la misma partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-758">Data that is frequently accessed together should be kept in the same partition.</span></span> <span data-ttu-id="0b784-759">Redis es un eficaz almacén de clave-valor que proporciona varios mecanismos enormemente optimizados para estructurar los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-759">Redis is a powerful key-value store that provides several highly optimized mechanisms for structuring data.</span></span> <span data-ttu-id="0b784-760">Estos mecanismos pueden ser uno de los siguientes elementos:</span><span class="sxs-lookup"><span data-stu-id="0b784-760">These mechanisms can be one of the following:</span></span>

  * <span data-ttu-id="0b784-761">Cadenas simples (datos binarios de hasta 512 MB)</span><span class="sxs-lookup"><span data-stu-id="0b784-761">Simple strings (binary data up to 512 MB in length)</span></span>
  * <span data-ttu-id="0b784-762">Tipos de agregado como listas (que pueden actuar como colas y pilas)</span><span class="sxs-lookup"><span data-stu-id="0b784-762">Aggregate types such as lists (which can act as queues and stacks)</span></span>
  * <span data-ttu-id="0b784-763">Conjuntos (ordenados y desordenados)</span><span class="sxs-lookup"><span data-stu-id="0b784-763">Sets (ordered and unordered)</span></span>
  * <span data-ttu-id="0b784-764">Algoritmos hash (que pueden agrupar campos relacionados, como los elementos que representan los campos de un objeto)</span><span class="sxs-lookup"><span data-stu-id="0b784-764">Hashes (which can group related fields together, such as the items that represent the fields in an object)</span></span>
* <span data-ttu-id="0b784-765">Los tipos de agregado permiten asociar muchos valores relacionados con la misma clave.</span><span class="sxs-lookup"><span data-stu-id="0b784-765">The aggregate types enable you to associate many related values with the same key.</span></span> <span data-ttu-id="0b784-766">Una clave de Redis identifica una lista, un conjunto o un valor hash en lugar de los elementos de datos que contiene.</span><span class="sxs-lookup"><span data-stu-id="0b784-766">A Redis key identifies a list, set, or hash rather than the data items that it contains.</span></span> <span data-ttu-id="0b784-767">Estos tipos están disponibles con Azure Redis Cache y se describen en la página [Data types] (Tipos de datos) del sitio web de Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-767">These types are all available with Azure Redis Cache and are described by the [Data types] page on the Redis website.</span></span> <span data-ttu-id="0b784-768">Por ejemplo, en la parte de un sistema de comercio electrónico que realiza el seguimiento de los pedidos realizados por los clientes, los detalles de cada cliente podrían almacenarse en un hash de Redis con clave utilizando el identificador de cliente.</span><span class="sxs-lookup"><span data-stu-id="0b784-768">For example, in part of an e-commerce system that tracks the orders that are placed by customers, the details of each customer can be stored in a Redis hash that is keyed by using the customer ID.</span></span> <span data-ttu-id="0b784-769">Cada valor hash puede contener una colección de identificadores de pedido para el cliente.</span><span class="sxs-lookup"><span data-stu-id="0b784-769">Each hash can hold a collection of order IDs for the customer.</span></span> <span data-ttu-id="0b784-770">Un conjunto Redis independiente podría contener los pedidos, estructurados como algoritmos hash y codificados por medio del identificador de pedido.</span><span class="sxs-lookup"><span data-stu-id="0b784-770">A separate Redis set can hold the orders, again structured as hashes, and keyed by using the order ID.</span></span> <span data-ttu-id="0b784-771">La figura 10 muestra esta estructura.</span><span class="sxs-lookup"><span data-stu-id="0b784-771">Figure 10 shows this structure.</span></span> <span data-ttu-id="0b784-772">Tenga en cuenta que Redis no implementa ningún tipo de integridad referencial, por lo que es responsabilidad del desarrollador mantener las relaciones entre clientes y pedidos.</span><span class="sxs-lookup"><span data-stu-id="0b784-772">Note that Redis does not implement any form of referential integrity, so it is the developer's responsibility to maintain the relationships between customers and orders.</span></span>

![Estructura sugerida en el almacenamiento de Redis para registrar los pedidos de clientes y sus detalles](./images/data-partitioning/RedisCustomersandOrders.png)

<span data-ttu-id="0b784-774">*Ilustración 10. Estructura sugerida en el almacenamiento de Redis para registrar los pedidos de clientes y sus detalles*</span><span class="sxs-lookup"><span data-stu-id="0b784-774">*Figure 10. Suggested structure in Redis storage for recording customer orders and their details*</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-775">En Redis, todas las claves son valores de datos binarios (como cadenas Redis) y pueden contener hasta 512 MB de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-775">In Redis, all keys are binary data values (like Redis strings) and can contain up to 512 MB of data.</span></span> <span data-ttu-id="0b784-776">En teoría, una clave puede contener casi cualquier información.</span><span class="sxs-lookup"><span data-stu-id="0b784-776">In theory, a key can contain almost any information.</span></span> <span data-ttu-id="0b784-777">No obstante, debe adoptar una convención de nomenclatura coherente para las claves que sea descriptiva del tipo de datos y que identifique la entidad, pero que no sea demasiado larga.</span><span class="sxs-lookup"><span data-stu-id="0b784-777">However, we recommend adopting a consistent naming convention for keys that is descriptive of the type of data and that identifies the entity, but is not excessively long.</span></span> <span data-ttu-id="0b784-778">Es habitual utilizar claves con el formato "tipo_entidad: ID".</span><span class="sxs-lookup"><span data-stu-id="0b784-778">A common approach is to use keys of the form "entity_type:ID".</span></span> <span data-ttu-id="0b784-779">Por ejemplo, puede usar "cliente: 99" para indicar la clave de un cliente con el identificador 99.</span><span class="sxs-lookup"><span data-stu-id="0b784-779">For example, you can use "customer:99" to indicate the key for a customer with the ID 99.</span></span>
>
>

* <span data-ttu-id="0b784-780">Puede implementar las particiones verticales almacenando información relacionada en agregaciones diferentes en la misma base de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-780">You can implement vertical partitioning by storing related information in different aggregations in the same database.</span></span> <span data-ttu-id="0b784-781">Por ejemplo, en una aplicación de comercio electrónico podría almacenar información a la que accede frecuentemente acerca de los productos en un hash de Redis y la información detallada usada con menos frecuencia en otro.</span><span class="sxs-lookup"><span data-stu-id="0b784-781">For example, in an e-commerce application, you can store commonly accessed information about products in one Redis hash and less frequently used detailed information in another.</span></span>
  <span data-ttu-id="0b784-782">Ambos valores hash pueden utilizar el mismo identificador de producto como parte de la clave.</span><span class="sxs-lookup"><span data-stu-id="0b784-782">Both hashes can use the same product ID as part of the key.</span></span> <span data-ttu-id="0b784-783">Por ejemplo, puede utilizar "producto: *nn*" (donde *nn* es el identificador del producto) para la información del producto y "detalles_producto: *nn*" para los datos detallados.</span><span class="sxs-lookup"><span data-stu-id="0b784-783">For example, you can use "product: *nn*" (where *nn* is the product ID) for the product information and "product_details: *nn*" for the detailed data.</span></span> <span data-ttu-id="0b784-784">Esta estrategia puede ayudar a reducir el volumen de datos que es probable que recuperen la mayoría de las consultas.</span><span class="sxs-lookup"><span data-stu-id="0b784-784">This strategy can help reduce the volume of data that most queries are likely to retrieve.</span></span>
* <span data-ttu-id="0b784-785">Puede volver a particionar un almacén de datos de Redis, pero tenga en cuenta que es una tarea compleja y lenta.</span><span class="sxs-lookup"><span data-stu-id="0b784-785">You can repartition a Redis data store, but keep in mind that it's a complex and time-consuming task.</span></span> <span data-ttu-id="0b784-786">La agrupación en clústeres de Redis puede volver a crear particiones de datos automáticamente, pero esta función no está disponible con Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="0b784-786">Redis clustering can repartition data automatically, but this capability is not available with Azure Redis Cache.</span></span> <span data-ttu-id="0b784-787">Por lo tanto, al diseñar el esquema de partición, deje suficiente espacio libre en cada partición para permitir el crecimiento de datos que se espera con el tiempo.</span><span class="sxs-lookup"><span data-stu-id="0b784-787">Therefore, when you design your partitioning scheme, try to leave sufficient free space in each partition to allow for expected data growth over time.</span></span> <span data-ttu-id="0b784-788">Sin embargo, recuerde que Azure Redis Cache está diseñado para almacenar datos en la caché temporalmente y que los datos que se mantienen en la memoria caché pueden tener una duración limitada especificada como valor de período de vida (TTL).</span><span class="sxs-lookup"><span data-stu-id="0b784-788">However, remember that Azure Redis Cache is intended to cache data temporarily, and that data held in the cache can have a limited lifetime specified as a time-to-live (TTL) value.</span></span> <span data-ttu-id="0b784-789">En el caso de los datos relativamente volátiles, el período de vida debe ser corto; sin embargo, para datos estáticos, el período de vida puede ser mucho más largo.</span><span class="sxs-lookup"><span data-stu-id="0b784-789">For relatively volatile data, the TTL can be short, but for static data the TTL can be a lot longer.</span></span> <span data-ttu-id="0b784-790">Evite almacenar grandes cantidades de datos de larga duración en la caché si el volumen de estos datos es probable que llene la caché.</span><span class="sxs-lookup"><span data-stu-id="0b784-790">Avoid storing large amounts of long-lived data in the cache if the volume of this data is likely to fill the cache.</span></span> <span data-ttu-id="0b784-791">Puede especificar una directiva de expulsión que provoque que Azure Redis Cache elimine datos si el espacio es crítico.</span><span class="sxs-lookup"><span data-stu-id="0b784-791">You can specify an eviction policy that causes Azure Redis Cache to remove data if space is at a premium.</span></span>

  > [!NOTE]
  > <span data-ttu-id="0b784-792">Cuando utiliza Caché en Redis de Azure, puede especificar el tamaño máximo de caché (de 250 MB a 53 GB) seleccionando el plan de tarifa adecuado.</span><span class="sxs-lookup"><span data-stu-id="0b784-792">When you use Azure Redis cache, you specify the maximum size of the cache (from 250 MB to 53 GB) by selecting the appropriate pricing tier.</span></span> <span data-ttu-id="0b784-793">Sin embargo, una vez que se ha creado Azure Redis Cache, no podrá aumentar (ni reducir) su tamaño.</span><span class="sxs-lookup"><span data-stu-id="0b784-793">However, after an Azure Redis Cache has been created, you cannot increase (or decrease) its size.</span></span>
  >
  >
* <span data-ttu-id="0b784-794">Los lotes y las transacciones de Redis no pueden abarcar varias conexiones, por lo que todos los datos afectados por un lote o transacción deben permanecer en la misma base de datos (partición).</span><span class="sxs-lookup"><span data-stu-id="0b784-794">Redis batches and transactions cannot span multiple connections, so all data that is affected by a batch or transaction should be held in the same database (shard).</span></span>

  > [!NOTE]
  > <span data-ttu-id="0b784-795">Una secuencia de operaciones en una transacción Redis no es necesariamente atómica.</span><span class="sxs-lookup"><span data-stu-id="0b784-795">A sequence of operations in a Redis transaction is not necessarily atomic.</span></span> <span data-ttu-id="0b784-796">Los comandos que componen una transacción se comprueban y se ponen en cola antes de ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="0b784-796">The commands that compose a transaction are verified and queued before they run.</span></span> <span data-ttu-id="0b784-797">Si se produce un error durante esta fase, se descarta toda la cola.</span><span class="sxs-lookup"><span data-stu-id="0b784-797">If an error occurs during this phase, the entire queue is discarded.</span></span> <span data-ttu-id="0b784-798">Sin embargo, una vez que la transacción se haya enviado correctamente, se ejecutarán los comandos en cola en secuencia.</span><span class="sxs-lookup"><span data-stu-id="0b784-798">However, after the transaction has been successfully submitted, the queued commands run in sequence.</span></span> <span data-ttu-id="0b784-799">Si se produce un error en algún comando, únicamente ese comando deja de ejecutarse.</span><span class="sxs-lookup"><span data-stu-id="0b784-799">If any command fails, only that command stops running.</span></span> <span data-ttu-id="0b784-800">Se ejecutarán todos los comandos situados delante y detrás en la cola.</span><span class="sxs-lookup"><span data-stu-id="0b784-800">All previous and subsequent commands in the queue are performed.</span></span> <span data-ttu-id="0b784-801">Para obtener más información, visite la página [Transactions] (Transacciones) en el sitio web de Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-801">For more information, go to the [Transactions] page on the Redis website.</span></span>
  >
  >
* <span data-ttu-id="0b784-802">Redis admite un número limitado de operaciones atómicas.</span><span class="sxs-lookup"><span data-stu-id="0b784-802">Redis supports a limited number of atomic operations.</span></span> <span data-ttu-id="0b784-803">Las únicas operaciones de este tipo que admiten varias claves y valores son operaciones MGET y MSET.</span><span class="sxs-lookup"><span data-stu-id="0b784-803">The only operations of this type that support multiple keys and values are MGET and MSET operations.</span></span> <span data-ttu-id="0b784-804">Las operaciones MGET devuelven una colección de valores para una lista especificada de claves, y las operaciones MSET almacenan una colección de valores para una lista especificada de claves.</span><span class="sxs-lookup"><span data-stu-id="0b784-804">MGET operations return a collection of values for a specified list of keys, and MSET operations store a collection of values for a specified list of keys.</span></span> <span data-ttu-id="0b784-805">Si necesita usar estas operaciones, los pares clave-valor a los que hacen referencia los comandos MSET y MGET deben almacenarse en la misma base de datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-805">If you need to use these operations, the key-value pairs that are referenced by the MSET and MGET commands must be stored within the same database.</span></span>

## <a name="partitioning-strategies-for-azure-service-fabric"></a><span data-ttu-id="0b784-806">Estrategias de creación de particiones para Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="0b784-806">Partitioning Strategies for Azure Service Fabric</span></span>
<span data-ttu-id="0b784-807">Azure Service Fabric es una plataforma de microservicios que proporciona un sistema de tiempo de ejecución para las aplicaciones distribuidas en la nube.</span><span class="sxs-lookup"><span data-stu-id="0b784-807">Azure Service Fabric is a microservices platform that provides a runtime for distributed applications in the cloud.</span></span> <span data-ttu-id="0b784-808">Service Fabric admite archivos ejecutables de invitado de .NET, servicios con y sin estado, y contenedores.</span><span class="sxs-lookup"><span data-stu-id="0b784-808">Service Fabric supports .Net guest executables, stateful and stateless services, and containers.</span></span> <span data-ttu-id="0b784-809">Los servicios con estado proporcionan una [colección confiable] [ service-fabric-reliable-collections] para almacenar datos de forma persistente en una colección de pares clave-valor en el clúster de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0b784-809">Stateful services provide a [reliable collection][service-fabric-reliable-collections] to persistently store data in a key-value collection within the Service Fabric cluster.</span></span> <span data-ttu-id="0b784-810">Para más información acerca de las estrategias de las claves de creación de particiones en una colección confiable, consulte las [directrices y recomendaciones para las colecciones confiables en Azure Service Fabric].</span><span class="sxs-lookup"><span data-stu-id="0b784-810">For more information about strategies for partioning keys in a reliable collection, see [guidelines and recommendations for reliable collections in Azure Service Fabric].</span></span>

### <a name="more-information"></a><span data-ttu-id="0b784-811">Más información</span><span class="sxs-lookup"><span data-stu-id="0b784-811">More information</span></span>
* <span data-ttu-id="0b784-812">[Información general de Azure Service Fabric] es una introducción a Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0b784-812">[Overview of Azure Service Fabric] is an introduction to Azure Service Fabric.</span></span>
* <span data-ttu-id="0b784-813">[Partición de los servicios confiables de Service Fabric] proporciona más información acerca de los servicios confiables en Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0b784-813">[Partition Service Fabric reliable services] provides more information about reliable services in Azure Service Fabric.</span></span>

## <a name="partitioning-strategies-for-azure-event-hubs"></a><span data-ttu-id="0b784-814">Estrategias de creación de particiones para Azure Event Hubs</span><span class="sxs-lookup"><span data-stu-id="0b784-814">Partitioning strategies for Azure Event Hubs</span></span>

<span data-ttu-id="0b784-815">[Azure Event Hubs][event-hubs] está diseñado para la trasmisión de datos a escala masiva, y la creación de particiones está integrada en el servicio para habilitar el escalado horizontal.</span><span class="sxs-lookup"><span data-stu-id="0b784-815">[Azure Event Hubs][event-hubs] is designed for data streaming at massive scale, and partitioning is built into the service to enable horizontal scaling.</span></span> <span data-ttu-id="0b784-816">Cada consumidor lee únicamente una partición específica del flujo de mensajes.</span><span class="sxs-lookup"><span data-stu-id="0b784-816">Each consumer only reads a specific partition of the message stream.</span></span> 

<span data-ttu-id="0b784-817">El publicador de eventos solo conoce su clave de partición, no la partición en la que se publican los eventos.</span><span class="sxs-lookup"><span data-stu-id="0b784-817">The event publisher is only aware of its partition key, not the partition to which the events are published.</span></span> <span data-ttu-id="0b784-818">Este desacoplamiento de la clave y la partición evita al remitente la necesidad de conocer demasiado sobre el procesamiento de bajada.</span><span class="sxs-lookup"><span data-stu-id="0b784-818">This decoupling of key and partition insulates the sender from needing to know too much about the downstream processing.</span></span> <span data-ttu-id="0b784-819">(También se puede enviar eventos directamente a una partición determinada, pero generalmente no se recomienda).</span><span class="sxs-lookup"><span data-stu-id="0b784-819">(It's also possible send events directly to a given partition, but generally that's not recommended.)</span></span>  

<span data-ttu-id="0b784-820">Considere la posibilidad de escalar a largo plazo cuando seleccione el número de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-820">Consider long-term scale when you select the partition count.</span></span> <span data-ttu-id="0b784-821">Después de crear un centro de eventos, no se puede cambiar el número de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-821">After an event hub is created, you can't change the number of partitions.</span></span> 

<span data-ttu-id="0b784-822">Para más información sobre el uso de particiones en Event Hubs, consulte [¿Qué es Event Hubs?].</span><span class="sxs-lookup"><span data-stu-id="0b784-822">For more information about using partitions in Event Hubs, see [What is Event Hubs?].</span></span>

<span data-ttu-id="0b784-823">Para ver otras consideraciones sobre el equilibrio entre la disponibilidad y la coherencia, consulte [Disponibilidad y coherencia en Event Hubs].</span><span class="sxs-lookup"><span data-stu-id="0b784-823">For considerations about trade-offs between availability and consistency, see [Availability and consistency in Event Hubs].</span></span>

## <a name="rebalancing-partitions"></a><span data-ttu-id="0b784-824">Reequilibrio de particiones</span><span class="sxs-lookup"><span data-stu-id="0b784-824">Rebalancing partitions</span></span>
<span data-ttu-id="0b784-825">A medida que un sistema empieza a crecer y se empiezan a entender mejor los patrones de uso, es posible que se deba ajustar el esquema de partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-825">As a system matures and you understand the usage patterns better, you might have to adjust the partitioning scheme.</span></span> <span data-ttu-id="0b784-826">Por ejemplo, es posible que algunas particiones individuales atraigan un volumen de tráfico desproporcionado y se conviertan en populares, dando lugar a una contención excesiva.</span><span class="sxs-lookup"><span data-stu-id="0b784-826">For example, individual partitions might start attracting a disproportionate volume of traffic and become hot, leading to excessive contention.</span></span> <span data-ttu-id="0b784-827">Además, es posible que haya subestimado el volumen de datos de algunas particiones y se esté acercando a los límites de la capacidad de almacenamiento en estas particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-827">Additionally, you might have underestimated the volume of data in some partitions, causing you to approach the limits of the storage capacity in these partitions.</span></span> <span data-ttu-id="0b784-828">Independientemente de la causa, a veces es necesario volver a equilibrar las particiones para distribuir la carga uniformemente.</span><span class="sxs-lookup"><span data-stu-id="0b784-828">Whatever the cause, it is sometimes necessary to rebalance partitions to spread the load more evenly.</span></span>

<span data-ttu-id="0b784-829">En algunos casos, los sistemas de almacenamiento de datos que no exponen públicamente la manera en que los datos se asignan a los servidores pueden reequilibrar automáticamente las particiones dentro de los límites de los recursos disponibles.</span><span class="sxs-lookup"><span data-stu-id="0b784-829">In some cases, data storage systems that don't publicly expose how data is allocated to servers can automatically rebalance partitions within the limits of the resources available.</span></span> <span data-ttu-id="0b784-830">En otras situaciones, el reequilibrio es una tarea administrativa que consta de dos fases:</span><span class="sxs-lookup"><span data-stu-id="0b784-830">In other situations, rebalancing is an administrative task that consists of two stages:</span></span>

1. <span data-ttu-id="0b784-831">Determinación de la nueva estrategia de partición para determinar:</span><span class="sxs-lookup"><span data-stu-id="0b784-831">Determining the new partitioning strategy to ascertain:</span></span>
   * <span data-ttu-id="0b784-832">Qué particiones es necesario dividir (o posiblemente combinar).</span><span class="sxs-lookup"><span data-stu-id="0b784-832">Which partitions might need to be split (or possibly combined).</span></span>
   * <span data-ttu-id="0b784-833">Cómo asignar datos a estas nuevas particiones mediante el diseño de nuevas claves de partición.</span><span class="sxs-lookup"><span data-stu-id="0b784-833">How to allocate data to these new partitions by designing new partition keys.</span></span>
2. <span data-ttu-id="0b784-834">Migrar los datos afectados desde el esquema de partición antiguo al nuevo conjunto de particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-834">Migrating the affected data from the old partitioning scheme to the new set of partitions.</span></span>

> [!NOTE]
> <span data-ttu-id="0b784-835">Aunque la asignación de colecciones de base de datos a los servidores es transparente, aún podría alcanzar los límites de capacidad y rendimiento de almacenamiento de una cuenta de Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="0b784-835">The mapping of database collections to servers is transparent, but you can still reach the storage capacity and throughput limits of a Cosmos DB account.</span></span> <span data-ttu-id="0b784-836">Si esto ocurriera, puede que necesite volver a diseñar su esquema de partición y migrar los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-836">If this happens, you might need to redesign your partitioning scheme and migrate the data.</span></span>
>
>

<span data-ttu-id="0b784-837">Dependiendo de la tecnología de almacenamiento de datos y del diseño de su sistema de almacenamiento de datos, es posible que pueda migrar datos entre particiones mientras están en uso (migración en línea).</span><span class="sxs-lookup"><span data-stu-id="0b784-837">Depending on the data storage technology and the design of your data storage system, you might be able to migrate data between partitions while they are in use (online migration).</span></span> <span data-ttu-id="0b784-838">Si esto no es posible, puede que necesite establecer las particiones afectadas como no disponibles temporalmente mientras se cambia la ubicación de los datos (migración sin conexión).</span><span class="sxs-lookup"><span data-stu-id="0b784-838">If this isn't possible, you might need to make the affected partitions temporarily unavailable while the data is relocated (offline migration).</span></span>

## <a name="offline-migration"></a><span data-ttu-id="0b784-839">Migración sin conexión</span><span class="sxs-lookup"><span data-stu-id="0b784-839">Offline migration</span></span>
<span data-ttu-id="0b784-840">Se podría afirmar que la migración sin conexión es el planteamiento más sencillo porque reduce las posibilidades de que se produzca contención.</span><span class="sxs-lookup"><span data-stu-id="0b784-840">Offline migration is arguably the simplest approach because it reduces the chances of contention occurring.</span></span> <span data-ttu-id="0b784-841">No realice ningún cambio en los datos mientras se mueven y reestructuran.</span><span class="sxs-lookup"><span data-stu-id="0b784-841">Don't make any changes to the data while it is being moved and restructured.</span></span>

<span data-ttu-id="0b784-842">Conceptualmente, este proceso consta de los siguientes pasos:</span><span class="sxs-lookup"><span data-stu-id="0b784-842">Conceptually, this process includes the following steps:</span></span>

1. <span data-ttu-id="0b784-843">Marcar la partición sin conexión.</span><span class="sxs-lookup"><span data-stu-id="0b784-843">Mark the shard offline.</span></span>
2. <span data-ttu-id="0b784-844">Dividir y combinar y mover los datos a las nuevas particiones.</span><span class="sxs-lookup"><span data-stu-id="0b784-844">Split-merge and move the data to the new shards.</span></span>
3. <span data-ttu-id="0b784-845">Comprobar los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-845">Verify the data.</span></span>
4. <span data-ttu-id="0b784-846">Establecer las nuevas particiones en línea.</span><span class="sxs-lookup"><span data-stu-id="0b784-846">Bring the new shards online.</span></span>
5. <span data-ttu-id="0b784-847">Quitar la partición antigua.</span><span class="sxs-lookup"><span data-stu-id="0b784-847">Remove the old shard.</span></span>

<span data-ttu-id="0b784-848">Para conservar algo de disponibilidad, puede marcar la partición original como de solo lectura en el paso 1 en lugar de establecerla como no disponible.</span><span class="sxs-lookup"><span data-stu-id="0b784-848">To retain some availability, you can mark the original shard as read-only in step 1 rather than making it unavailable.</span></span> <span data-ttu-id="0b784-849">Esto permite a las aplicaciones leer los datos mientras se mueven, pero no cambiarlos.</span><span class="sxs-lookup"><span data-stu-id="0b784-849">This allows applications to read the data while it is being moved but not to change it.</span></span>

## <a name="online-migration"></a><span data-ttu-id="0b784-850">Migración en línea</span><span class="sxs-lookup"><span data-stu-id="0b784-850">Online migration</span></span>
<span data-ttu-id="0b784-851">La migración en línea es más difícil de realizar, pero es menos problemática para los usuarios, ya que los datos permanecen disponibles durante todo el procedimiento.</span><span class="sxs-lookup"><span data-stu-id="0b784-851">Online migration is more complex to perform but less disruptive to users because data remains available during the entire procedure.</span></span> <span data-ttu-id="0b784-852">El proceso es similar al usado por la migración sin conexión, salvo que la partición original no está marcada como sin conexión (paso 1).</span><span class="sxs-lookup"><span data-stu-id="0b784-852">The process is similar to that used by offline migration, except that the original shard is not marked offline (step 1).</span></span> <span data-ttu-id="0b784-853">Según la granularidad del proceso de migración (por ejemplo, si se hace elemento por elemento o partición por partición), es posible que el código de acceso a datos de las aplicaciones cliente tenga que controlar la lectura y escritura de los datos que se encuentran en dos ubicaciones (la partición original y la nueva partición)</span><span class="sxs-lookup"><span data-stu-id="0b784-853">Depending on the granularity of the migration process (for example, whether it's done item by item or shard by shard), the data access code in the client applications might have to handle reading and writing data that's held in two locations (the original shard and the new shard).</span></span>

<span data-ttu-id="0b784-854">Para obtener un ejemplo de una solución que admita la migración en línea, consulte [Escalado con la herramienta de división y combinación de bases de datos elásticas] en el sitio web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="0b784-854">For an example of a solution that supports online migration, see the article [Scaling using the Elastic Database split-merge tool] on the Microsoft website.</span></span>

## <a name="related-patterns-and-guidance"></a><span data-ttu-id="0b784-855">Orientación y patrones relacionados</span><span class="sxs-lookup"><span data-stu-id="0b784-855">Related patterns and guidance</span></span>
<span data-ttu-id="0b784-856">Es posible que los siguientes modelos también resulten pertinentes para su escenario al considerar las estrategias para implementar la coherencia de los datos:</span><span class="sxs-lookup"><span data-stu-id="0b784-856">When considering strategies for implementing data consistency, the following patterns might also be relevant to your scenario:</span></span>

* <span data-ttu-id="0b784-857">En la página [Data consistency primer] (Información básica sobre la coherencia de datos) se describen las estrategias para mantener la coherencia en un entorno distribuido, como la nube.</span><span class="sxs-lookup"><span data-stu-id="0b784-857">The [Data consistency primer] page on the Microsoft website describes strategies for maintaining consistency in a distributed environment such as the cloud.</span></span>
* <span data-ttu-id="0b784-858">La página [Data partitioning guidance] (Guía de creación de particiones de datos) proporciona una visión general de cómo diseñar particiones para cumplir varios criterios en una solución distribuida.</span><span class="sxs-lookup"><span data-stu-id="0b784-858">The [Data partitioning guidance] page on the Microsoft website provides a general overview of how to design partitions to meet various criteria in a distributed solution.</span></span>
* <span data-ttu-id="0b784-859">En [Sharding Pattern] (Patrón de particionamiento), descrito en el sitio web de Microsoft, se resumen algunas estrategias comunes para el particionamiento de los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-859">The [sharding pattern] as described on the Microsoft website summarizes some common strategies for sharding data.</span></span>
* <span data-ttu-id="0b784-860">En [Index Table Pattern] (Patrón de la tabla de índice), descrito en el sitio web de Microsoft, se ilustra cómo crear índices secundarios sobre los datos.</span><span class="sxs-lookup"><span data-stu-id="0b784-860">The [index table pattern] as described on the Microsoft website illustrates how to create secondary indexes over data.</span></span> <span data-ttu-id="0b784-861">Con este enfoque, una aplicación puede recuperar rápidamente los datos mediante el uso de consultas que no hacen referencia a la clave principal de una colección.</span><span class="sxs-lookup"><span data-stu-id="0b784-861">An application can quickly retrieve data with this approach, by using queries that do not reference the primary key of a collection.</span></span>
* <span data-ttu-id="0b784-862">En [Materialized View Pattern] (Patrón de vista materializada), descrito en el sitio web de Microsoft, se describe cómo generar vistas rellenadas previamente que resuman los datos para admitir las operaciones de consulta rápida.</span><span class="sxs-lookup"><span data-stu-id="0b784-862">The [materialized view pattern] as described on the Microsoft website describes how to generate pre-populated views that summarize data to support fast query operations.</span></span> <span data-ttu-id="0b784-863">Este enfoque puede ser útil en un almacén de datos con particiones si las particiones que contienen los datos que se resumen se distribuyen entre varios sitios.</span><span class="sxs-lookup"><span data-stu-id="0b784-863">This approach can be useful in a partitioned data store if the partitions that contain the data being summarized are distributed across multiple sites.</span></span>
* <span data-ttu-id="0b784-864">En el artículo [Uso de Azure Content Delivery Network] del sitio web de Microsoft se ofrecen instrucciones adicionales sobre cómo configurar y usar Content Delivery Network con Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-864">The [Using Azure Content Delivery Network] article on the Microsoft website provides additional guidance on configuring and using Content Delivery Network with Azure.</span></span>

## <a name="more-information"></a><span data-ttu-id="0b784-865">Más información</span><span class="sxs-lookup"><span data-stu-id="0b784-865">More information</span></span>
* <span data-ttu-id="0b784-866">La página [¿Qué es SQL Database?] del sitio web de Microsoft ofrece documentación detallada en la que se describe la creación y el uso de SQL Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-866">The page [What is Azure SQL Database?] on the Microsoft website provides detailed documentation that describes how to create and use SQL databases.</span></span>
* <span data-ttu-id="0b784-867">En la página [Información general de las características de Elastic Database] del sitio web de Microsoft se proporciona una introducción completa a Elastic Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-867">The page [Elastic Database features overview] on the Microsoft website provides a comprehensive introduction to Elastic Database.</span></span>
* <span data-ttu-id="0b784-868">La página [Escalado con la herramienta de división y combinación de bases de datos elásticas] del sitio web de Microsoft contiene información sobre el uso del servicio de división y combinación para administrar particiones de Elastic Database.</span><span class="sxs-lookup"><span data-stu-id="0b784-868">The page [Scaling using the Elastic Database split-merge tool] on the Microsoft website contains information about using the split-merge service to manage Elastic Database shards.</span></span>
* <span data-ttu-id="0b784-869">La página [Objetivos de escalabilidad y rendimiento del almacenamiento de Azure](https://msdn.microsoft.com/library/azure/dn249410.aspx) del sitio web de Microsoft documenta los límites de tamaño y rendimiento actuales de Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="0b784-869">The page [Azure storage scalability and performance targets](https://msdn.microsoft.com/library/azure/dn249410.aspx) on the Microsoft website documents the current sizing and throughput limits of Azure Storage.</span></span>
* <span data-ttu-id="0b784-870">La página [Realizar transacciones con grupos de entidades] del sitio web de Microsoft proporciona información detallada sobre la implementación de operaciones transaccionales sobre las entidades almacenadas en Almacenamiento de tablas de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-870">The page [Performing entity group transactions] on the Microsoft website provides detailed information about implementing transactional operations over entities that are stored in Azure table storage.</span></span>
* <span data-ttu-id="0b784-871">El artículo [Guía de diseño de Table Storage] del sitio web de Microsoft contiene información detallada sobre la creación de particiones de datos en Azure Table Storage.</span><span class="sxs-lookup"><span data-stu-id="0b784-871">The article [Azure Storage table design guide] on the Microsoft website contains detailed information about partitioning data in Azure table storage.</span></span>
* <span data-ttu-id="0b784-872">La página [Uso de Azure Content Delivery Network] del sitio web de Microsoft describe cómo replicar los datos almacenados en Azure Blob Storage mediante el uso de Azure Content Delivery Network.</span><span class="sxs-lookup"><span data-stu-id="0b784-872">The page [Using Azure Content Delivery Network] on the Microsoft website describes how to replicate data that's held in Azure blob storage by using the Azure Content Delivery Network.</span></span>
* <span data-ttu-id="0b784-873">La página [¿Qué es Azure Search?] del sitio web de Microsoft proporciona una descripción completa de las funciones disponibles con el servicio Azure Search.</span><span class="sxs-lookup"><span data-stu-id="0b784-873">The page [What is Azure Search?] on the Microsoft website provides a full description of the capabilities that are available in Azure Search.</span></span>
* <span data-ttu-id="0b784-874">La página [Límites de servicio en Azure Search] del sitio web de Microsoft contiene información sobre la capacidad de cada instancia del servicio Azure Search.</span><span class="sxs-lookup"><span data-stu-id="0b784-874">The page [Service limits in Azure Search] on the Microsoft website contains information about the capacity of each instance of Azure Search.</span></span>
* <span data-ttu-id="0b784-875">La página [Tipos de datos admitidos (Azure Search)] del sitio web de Microsoft resume los tipos de datos que puede usar en los documentos y los índices en los que se pueden hacer búsquedas.</span><span class="sxs-lookup"><span data-stu-id="0b784-875">The page [Supported data types (Azure Search)] on the Microsoft website summarizes the data types that you can use in searchable documents and indexes.</span></span>
* <span data-ttu-id="0b784-876">La página [Azure Redis Cache] del sitio web de Microsoft proporciona una introducción a Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="0b784-876">The page [Azure Redis Cache] on the Microsoft website provides an introduction to Azure Redis Cache.</span></span>
* <span data-ttu-id="0b784-877">La página [Partitioning: how to split data among multiple Redis instances] (Creación de particiones: cómo dividir los datos entre varias instancias de Redis) del sitio web de Redis proporciona información acerca de cómo implementar las particiones con Redis.</span><span class="sxs-lookup"><span data-stu-id="0b784-877">The [Partitioning: how to split data among multiple Redis instances] page on the Redis website provides information about how to implement partitioning with Redis.</span></span>
* <span data-ttu-id="0b784-878">La página [Running Redis on a CentOS Linux VM in Windows Azure] (Ejecución de Redis en una máquina virtual Linux de CentOS en Azure) del sitio web de Microsoft le guía a través de un ejemplo que muestra cómo crear y configurar un nodo Redis que se ejecuta como una máquina virtual de Azure.</span><span class="sxs-lookup"><span data-stu-id="0b784-878">The page [Running Redis on a CentOS Linux VM in Azure] on the Microsoft website walks through an example that shows you how to build and configure a Redis node running as an Azure VM.</span></span>
* <span data-ttu-id="0b784-879">La página [Data types] (Tipos de datos) del sitio web de Redis describe los tipos de datos que están disponibles con Redis y Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="0b784-879">The [Data types] page on the Redis website describes the data types that are available with Redis and Azure Redis Cache.</span></span>

[Disponibilidad y coherencia en Event Hubs]: /azure/event-hubs/event-hubs-availability-and-consistency
[azure-limits]: /azure/azure-subscription-service-limit
[Azure Content Delivery Network]: /azure/cdn/cdn-overview
[Azure Redis Cache]: http://azure.microsoft.com/services/cache/
[Azure Storage Scalability and Performance Targets]: /azure/storage/storage-scalability-targets
[Azure Storage Table Design Guide]: /azure/storage/storage-table-design-guide
[Creación de una solución de Polyglot]: https://msdn.microsoft.com/library/dn313279.aspx
[cosmos-db-ru]: /azure/documentdb/documentdb-request-units
[Data Access for Highly-Scalable Solutions: Using SQL, NoSQL, and Polyglot Persistence]: https://msdn.microsoft.com/library/dn271399.aspx
[Data consistency primer]: http://aka.ms/Data-Consistency-Primer
[Data Partitioning Guidance]: https://msdn.microsoft.com/library/dn589795.aspx
[Data Types]: http://redis.io/topics/data-types
[documentdb-api]: /azure/documentdb/documentdb-introduction
[Información general de las características de Elastic Database]: /azure/sql-database/sql-database-elastic-scale-introduction
[event-hubs]: /azure/event-hubs
[Federations Migration Utility]: https://code.msdn.microsoft.com/vstudio/Federations-Migration-ce61e9c1
[directrices y recomendaciones para las colecciones confiables en Azure Service Fabric]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections-guidelines
[Index Table Pattern]: http://aka.ms/Index-Table-Pattern
[Materialized View Pattern]: http://aka.ms/Materialized-View-Pattern
[Consultas a través de particiones múltiples]: /azure/sql-database/sql-database-elastic-scale-multishard-querying
[Información general de Azure Service Fabric]: /azure/service-fabric/service-fabric-overview
[Partición de los servicios confiables de Service Fabric]: /azure/service-fabric/service-fabric-concepts-partitioning
[Partitioning: how to split data among multiple Redis instances]: http://redis.io/topics/partitioning
[Performing Entity Group Transactions]: https://msdn.microsoft.com/library/azure/dd894038.aspx
[Tutorial de clúster Redis]: http://redis.io/topics/cluster-tutorial
[Running Redis on a CentOS Linux VM in Windows Azure]: http://blogs.msdn.com/b/tconte/archive/2012/06/08/running-redis-on-a-centos-linux-vm-in-windows-azure.aspx
[Escalado con la herramienta de división y combinación de bases de datos elásticas]: /azure/sql-database/sql-database-elastic-scale-overview-split-and-merge
[Uso de Azure Content Delivery Network]: /azure/cdn/cdn-create-new-endpoint
[Cuotas de Service Bus]: /azure/service-bus-messaging/service-bus-quotas
[service-fabric-reliable-collections]: /azure/service-fabric/service-fabric-reliable-services-reliable-collections
[Límites de servicio en Azure Search]:  /azure/search/search-limits-quotas-capacity
[patrón particionamiento]: http://aka.ms/Sharding-Pattern
[Tipos de datos admitidos (Azure Search)]:  https://msdn.microsoft.com/library/azure/dn798938.aspx
[Transactions]: http://redis.io/topics/transactions
[¿Qué es Event Hubs?]: /azure/event-hubs/event-hubs-what-is-event-hubs
[¿Qué es Azure Search?]: /azure/search/search-what-is-azure-search
[¿Qué es SQL Database?]: /azure/sql-database/sql-database-technical-overview
